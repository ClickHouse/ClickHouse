-- Case 1: UInt64 both >= 2^53, query value = 2^53+5, should NOT prune part 1
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20089, 20089])
            Parts: 1/1
            Granules: 1/1
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250101, 20250101])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 1: UInt64 both >= 2^53, query value < 2^53, should prune part 1
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20089, 20089])
            Parts: 1/1
            Granules: 1/1
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250101, 20250101])
            Parts: 1/1
            Granules: 1/1
          Statistics
            Keys:
              dt
              val_uint64
            Parts: 0/1
            Granules: 0/1
          Ranges: 0
0
-- Case 2: Int64 min in range, max >= 2^53, query < min, should prune part 2
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20090, 20090])
            Parts: 1/2
            Granules: 1/2
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250102, 20250102])
            Parts: 1/1
            Granules: 1/1
          Statistics
            Keys:
              dt
              val_int64
            Parts: 0/1
            Granules: 0/1
          Ranges: 0
0
-- Case 2: Int64 min in range, max >= 2^53, query > 2^53, should NOT prune part 2
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20090, 20090])
            Parts: 1/2
            Granules: 1/2
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250102, 20250102])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 3: Int64 min <= -2^53, max in range, query > max, should prune part 3
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20091, 20091])
            Parts: 1/3
            Granules: 1/3
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250103, 20250103])
            Parts: 1/1
            Granules: 1/1
          Statistics
            Keys:
              dt
              val_int64
            Parts: 0/1
            Granules: 0/1
          Ranges: 0
0
-- Case 3: Int64 min <= -2^53, max in range, query = max, should NOT prune part 3
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20091, 20091])
            Parts: 1/3
            Granules: 1/3
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250103, 20250103])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 3: Int64 min <= -2^53, max in range, query < -2^53, should NOT prune part 3
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20091, 20091])
            Parts: 1/3
            Granules: 1/3
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250103, 20250103])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 4: Int64 min <= -2^53 and max >= 2^53, cannot prune
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20092, 20092])
            Parts: 1/4
            Granules: 1/4
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250104, 20250104])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 5: Decimal128 precision=38 > 15, should NOT prune (skips statistics)
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20093, 20093])
            Parts: 1/5
            Granules: 1/5
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250105, 20250105])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
0
-- Case 6.1: Decimal32(0) precision=9 <= 15 with extreme value, query at max limit 999999999, should NOT prune part 6
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20094, 20094])
            Parts: 1/6
            Granules: 1/6
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250106, 20250106])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 6.2: Decimal32(0) precision=9 <= 15 with extreme value, query < min, should prune part 6
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20094, 20094])
            Parts: 1/6
            Granules: 1/6
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250106, 20250106])
            Parts: 1/1
            Granules: 1/1
          Statistics
            Keys:
              dt
              val_decimal32
            Parts: 0/1
            Granules: 0/1
          Ranges: 0
0
-- Case 6.3: Decimal32(9) precision=9 <= 15 with extreme value, query at max limit 0.999999999, should NOT prune part 6
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20095, 20095])
            Parts: 1/7
            Granules: 1/7
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250107, 20250107])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 7: Int64 both <= -2^53, query value = -2^53-5, should NOT prune part 7
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20096, 20096])
            Parts: 1/8
            Granules: 1/8
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250108, 20250108])
            Parts: 1/1
            Granules: 1/1
          Ranges: 1
1
-- Case 7: Int64 both <= -2^53, query value > -2^53, should prune part 7
Expression ((Project names + Projection))
  Aggregating
    Expression (Before GROUP BY)
      Expression ((WHERE + Change column names to column identifiers))
        ReadFromMergeTree (default.test_stats_exceeds)
        Indexes:
          MinMax
            Keys:
              dt
            Condition: (dt in [20096, 20096])
            Parts: 1/8
            Granules: 1/8
          Partition
            Keys:
              toYYYYMMDD(dt)
            Condition: (toYYYYMMDD(dt) in [20250108, 20250108])
            Parts: 1/1
            Granules: 1/1
          Statistics
            Keys:
              dt
              val_int64
            Parts: 0/1
            Granules: 0/1
          Ranges: 0
0
