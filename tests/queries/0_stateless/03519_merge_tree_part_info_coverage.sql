SET enable_analyzer = 1;

create table mt (names Array(String)) engine = MergeTree order by names;
insert into mt values (['0_1_1_0', '0_1_9_1', '0_3_3_0', '0_5_5_0', '0_7_7_0', '0_9_9_0', '0_11_11_0', '0_11_19_1', '0_13_13_0', '0_15_15_0', '0_17_17_0', '0_19_19_0', '0_21_21_0', '0_21_29_2', '0_23_23_0', '0_23_29_1', '0_24_24_0', '0_25_25_0', '0_28_28_0', '0_29_29_0', '0_33_33_0', '0_33_41_1', '0_34_34_0', '0_36_36_0', '0_38_38_0', '0_41_41_0', '0_43_43_0', '0_43_51_1', '0_44_44_0', '0_47_47_0', '0_49_49_0', '0_51_51_0', '0_53_53_0', '0_53_62_2', '0_54_54_0', '0_54_62_1', '0_56_56_0', '0_59_59_0', '0_61_61_0', '0_62_62_0', '0_65_65_0', '0_65_73_1', '0_66_66_0', '0_68_68_0', '0_70_70_0', '0_73_73_0', '0_74_74_0', '0_74_83_1', '0_77_77_0', '0_79_79_0', '0_81_81_0', '0_83_83_0', '0_85_85_0', '0_85_93_1', '0_87_87_0', '0_89_89_0', '0_91_91_0', '0_93_93_0', '0_95_95_0', '0_95_104_2', '0_97_97_0', '0_97_104_1', '0_99_99_0', '0_101_101_0', '0_102_102_0', '0_104_104_0', '0_106_106_0', '0_106_119_2', '0_109_109_0', '0_109_116_1', '0_111_111_0', '0_113_113_0', '0_115_115_0', '0_116_116_0', '0_119_119_0', '0_121_121_0', '0_121_129_1', '0_123_123_0', '0_125_125_0', '0_127_127_0', '0_129_129_0', '0_131_131_0', '0_131_137_1', '0_133_133_0', '0_135_135_0', '0_136_136_0', '0_137_137_0', '0_141_141_0', '0_141_148_1', '0_143_143_0', '0_145_145_0', '0_146_146_0', '0_148_148_0', '0_151_151_0', '0_151_159_1', '0_152_152_0', '0_155_155_0', '0_156_156_0', '0_159_159_0', '0_161_161_0', '0_161_166_1', '0_163_163_0', '0_164_164_0', '0_166_166_0', '0_169_169_0', '0_169_176_1', '0_171_171_0', '0_173_173_0', '0_175_175_0', '0_176_176_0', '0_178_178_0', '0_178_186_2', '0_180_180_0', '0_180_186_1', '0_182_182_0', '0_184_184_0', '0_185_185_0', '0_186_186_0', '0_189_189_0', '0_189_197_1', '0_189_201_2', '0_193_193_0', '0_195_195_0', '0_197_197_0', '0_199_199_0', '0_201_201_0', '0_203_203_0', '0_203_211_1', '0_203_213_2', '0_205_205_0', '0_207_207_0', '0_209_209_0', '0_211_211_0', '0_213_213_0', '0_215_215_0', '0_215_222_1', '0_217_217_0', '0_219_219_0', '0_221_221_0', '0_222_222_0', '0_224_224_0', '0_224_232_1', '0_227_227_0', '0_229_229_0', '0_230_230_0', '0_232_232_0', '0_235_235_0', '0_235_242_1', '0_237_237_0', '0_239_239_0', '0_241_241_0', '0_242_242_0', '0_245_245_0', '0_245_253_1', '0_247_247_0', '0_249_249_0', '0_251_251_0', '0_253_253_0', '0_255_255_0', '0_255_261_1', '0_255_263_2', '0_257_257_0', '0_259_259_0', '0_261_261_0', '0_263_263_0', '0_265_265_0', '0_265_271_1', '0_267_267_0', '0_268_268_0', '0_269_269_0', '0_271_271_0', '0_274_274_0', '0_274_277_1', '0_274_289_2', '0_275_275_0', '0_277_277_0', '0_278_278_0', '0_278_289_1', '0_283_283_0', '0_285_285_0', '0_286_286_0', '0_289_289_0', '0_291_291_0', '0_291_299_1', '0_293_293_0', '0_295_295_0', '0_297_297_0', '0_299_299_0', '0_301_301_0', '0_301_310_2', '0_303_303_0', '0_303_310_1', '0_305_305_0', '0_307_307_0', '0_309_309_0', '0_310_310_0', '0_312_312_0', '0_312_324_2', '0_313_313_0', '0_315_315_0', '0_315_324_1', '0_319_319_0', '0_320_320_0', '0_322_322_0', '0_324_324_0', '0_327_327_0', '0_327_335_1', '0_328_328_0', '0_329_329_0', '0_330_330_0', '0_335_335_0', '0_337_337_0', '0_337_345_1', '0_339_339_0', '0_341_341_0', '0_343_343_0', '0_345_345_0', '0_347_347_0', '0_347_355_1', '0_349_349_0', '0_351_351_0', '0_353_353_0', '0_355_355_0', '0_357_357_0', '0_357_367_2', '0_359_359_0', '0_359_367_1', '0_361_361_0', '0_363_363_0', '0_365_365_0', '0_367_367_0', '0_369_369_0', '0_369_377_1', '0_369_381_2', '0_371_371_0', '0_372_372_0', '0_375_375_0', '0_377_377_0', '0_379_379_0', '0_381_381_0', '0_383_383_0', '0_383_387_1', '0_383_391_2', '0_383_395_3', '0_385_385_0', '0_387_387_0', '0_389_389_0', '0_391_391_0', '0_393_393_0', '0_395_395_0', '0_397_397_0', '0_397_399_1', '0_399_399_0', '1_2_2_0', '1_2_10_1', '1_4_4_0', '1_6_6_0', '1_8_8_0', '1_10_10_0', '1_12_12_0', '1_12_20_1', '1_14_14_0', '1_16_16_0', '1_18_18_0', '1_20_20_0', '1_22_22_0', '1_22_27_1', '1_26_26_0', '1_27_27_0', '1_30_30_0', '1_30_37_1', '1_31_31_0', '1_32_32_0', '1_35_35_0', '1_37_37_0', '1_39_39_0', '1_39_46_1', '1_40_40_0', '1_42_42_0', '1_45_45_0', '1_46_46_0', '1_48_48_0', '1_48_57_1', '1_50_50_0', '1_52_52_0', '1_55_55_0', '1_57_57_0', '1_58_58_0', '1_58_63_1', '1_60_60_0', '1_63_63_0', '1_64_64_0', '1_64_72_1', '1_67_67_0', '1_69_69_0', '1_71_71_0', '1_72_72_0', '1_75_75_0', '1_75_84_2', '1_76_76_0', '1_76_84_1', '1_78_78_0', '1_80_80_0', '1_82_82_0', '1_84_84_0', '1_86_86_0', '1_86_94_1', '1_88_88_0', '1_90_90_0', '1_92_92_0', '1_94_94_0', '1_96_96_0', '1_96_100_1', '1_96_110_2', '1_98_98_0', '1_100_100_0', '1_103_103_0', '1_103_110_1', '1_105_105_0', '1_107_107_0', '1_108_108_0', '1_110_110_0', '1_112_112_0', '1_112_120_1', '1_114_114_0', '1_117_117_0', '1_118_118_0', '1_120_120_0', '1_122_122_0', '1_122_130_1', '1_124_124_0', '1_126_126_0', '1_128_128_0', '1_130_130_0', '1_132_132_0', '1_132_142_2', '1_134_134_0', '1_134_142_1', '1_138_138_0', '1_139_139_0', '1_140_140_0', '1_142_142_0', '1_144_144_0', '1_144_153_1', '1_147_147_0', '1_149_149_0', '1_150_150_0', '1_153_153_0', '1_154_154_0', '1_154_160_1', '1_154_162_2', '1_157_157_0', '1_158_158_0', '1_160_160_0', '1_162_162_0', '1_165_165_0', '1_165_172_1', '1_167_167_0', '1_168_168_0', '1_170_170_0', '1_172_172_0', '1_174_174_0', '1_174_181_1', '1_174_188_2', '1_177_177_0', '1_179_179_0', '1_181_181_0', '1_183_183_0', '1_187_187_0', '1_188_188_0', '1_190_190_0', '1_190_196_1', '1_191_191_0', '1_192_192_0', '1_194_194_0', '1_196_196_0', '1_198_198_0', '1_198_206_1', '1_200_200_0', '1_202_202_0', '1_204_204_0', '1_206_206_0', '1_208_208_0', '1_208_216_1', '1_210_210_0', '1_212_212_0', '1_214_214_0', '1_216_216_0', '1_218_218_0', '1_218_228_2', '1_220_220_0', '1_220_228_1', '1_223_223_0', '1_225_225_0', '1_226_226_0', '1_228_228_0', '1_231_231_0', '1_231_238_1', '1_233_233_0', '1_234_234_0', '1_236_236_0', '1_238_238_0', '1_240_240_0', '1_240_248_1', '1_243_243_0', '1_244_244_0', '1_246_246_0', '1_248_248_0', '1_250_250_0', '1_250_258_1', '1_252_252_0', '1_254_254_0', '1_256_256_0', '1_258_258_0', '1_260_260_0', '1_260_264_1', '1_260_273_2', '1_262_262_0', '1_264_264_0', '1_266_266_0', '1_266_273_1', '1_270_270_0', '1_272_272_0', '1_273_273_0', '1_276_276_0', '1_276_282_1', '1_279_279_0', '1_280_280_0', '1_281_281_0', '1_282_282_0', '1_284_284_0', '1_284_294_2', '1_287_287_0', '1_287_294_1', '1_288_288_0', '1_290_290_0', '1_292_292_0', '1_294_294_0', '1_296_296_0', '1_296_300_1', '1_296_308_2', '1_298_298_0', '1_300_300_0', '1_302_302_0', '1_302_308_1', '1_304_304_0', '1_306_306_0', '1_308_308_0', '1_311_311_0', '1_311_318_1', '1_314_314_0', '1_316_316_0', '1_317_317_0', '1_318_318_0', '1_321_321_0', '1_321_331_1', '1_323_323_0', '1_325_325_0', '1_326_326_0', '1_331_331_0', '1_332_332_0', '1_332_338_1', '1_333_333_0', '1_334_334_0', '1_336_336_0', '1_338_338_0', '1_340_340_0', '1_340_350_2', '1_342_342_0', '1_342_350_1', '1_344_344_0', '1_346_346_0', '1_348_348_0', '1_350_350_0', '1_352_352_0', '1_352_360_1', '1_354_354_0', '1_356_356_0', '1_358_358_0', '1_360_360_0', '1_362_362_0', '1_362_370_1', '1_364_364_0', '1_366_366_0', '1_368_368_0', '1_370_370_0', '1_373_373_0', '1_373_378_1', '1_373_382_2', '1_374_374_0', '1_376_376_0', '1_378_378_0', '1_380_380_0', '1_382_382_0', '1_384_384_0', '1_384_388_1', '1_384_392_2', '1_384_396_3', '1_386_386_0', '1_388_388_0', '1_390_390_0', '1_392_392_0', '1_394_394_0', '1_396_396_0', '1_398_398_0', '1_398_400_1', '1_400_400_0']);

select
    tag1 as part_name
from (
    select
        tag1, sum(is_covered) as is_covered
    from (
        select
            tag1, tag2, isMergeTreePartCoveredBy(tag1, tag2) as is_covered
        from mt
            array join names AS tag1
            array join names AS tag2
        where tag1 != tag2
    )
    group by tag1
)
where is_covered = 0
order by mergeTreePartInfo(part_name).partition_id, mergeTreePartInfo(part_name).min_block;
