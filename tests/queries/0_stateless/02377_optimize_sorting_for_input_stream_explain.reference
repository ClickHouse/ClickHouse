-- disable optimization -> sorting order is NOT propagated from subquery -> full sort
-- QUERY: set optimize_sorting_for_input_stream=0;set max_threads=1;EXPLAIN PIPELINE SELECT a FROM (SELECT a FROM optimize_sorting) ORDER BY a
MergeSortingTransform
LimitsCheckingTransform
PartialSortingTransform
-- enable_optimization -> sorting order is propagated from subquery -> merge sort
-- QUERY: set optimize_sorting_for_input_stream=1;set max_threads=1;EXPLAIN PIPELINE SELECT a FROM (SELECT a FROM optimize_sorting) ORDER BY a
MergeSortingTransform
-- ExpressionStep preserves sort mode
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a FROM optimize_sorting ORDER BY a
Sort Mode: Stream: a ASC
Sort Mode: Stream: a ASC
Sort Mode: Port: a ASC
Sort Mode: Port: a ASC
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a FROM optimize_sorting ORDER BY a+1
Sort Mode: None
Sort Mode: Stream: plus(a, 1) ASC
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
-- ExpressionStep breaks sort mode
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a+1 FROM optimize_sorting ORDER BY a+1
Sort Mode: Stream: plus(a, 1) ASC
Sort Mode: Stream: plus(a, 1) ASC
Sort Mode: None
Sort Mode: Chunk: a ASC
-- FilterStep preserves sort mode
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a FROM optimize_sorting WHERE a > 0
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a FROM optimize_sorting WHERE a+1 > 0
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a, a+1 FROM optimize_sorting WHERE a+1 > 0
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
-- FilterStep breaks sort mode
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a > 0 FROM optimize_sorting WHERE a > 0
Sort Mode: None
Sort Mode: None
Sort Mode: Chunk: a ASC
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a+1 FROM optimize_sorting WHERE a+1 > 0
Sort Mode: None
Sort Mode: None
Sort Mode: Chunk: a ASC
-- aliases break sorting order
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a FROM (SELECT sipHash64(a) AS a FROM (SELECT a FROM optimize_sorting ORDER BY a)) ORDER BY a
Sort Mode: Stream: a ASC
Sort Mode: Stream: a ASC
Sort Mode: None
Sort Mode: Stream: a ASC
Sort Mode: Port: a ASC
Sort Mode: Port: a ASC
-- aliases DONT break sorting order
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode=1 SELECT a, b FROM (SELECT x AS a, y AS b FROM (SELECT a AS x, b AS y FROM optimize_sorting) ORDER BY x, y)
Sort Mode: Stream: x ASC, y ASC
Sort Mode: Stream: x ASC, y ASC
Sort Mode: Chunk: a ASC, b ASC
Sort Mode: Chunk: a ASC, b ASC
-- actions chain breaks sorting order: input(column a)->sipHash64(column a)->alias(sipHash64(column a), a)->plus(alias a, 1)
-- QUERY: set optimize_read_in_order=1;EXPLAIN PLAN actions=1, header=1, sortmode = 1 SELECT a, z FROM (SELECT sipHash64(a) AS a, a + 1 AS z FROM (SELECT a FROM optimize_sorting ORDER BY a + 1)) ORDER BY a + 1
Sort Mode: None
Sort Mode: Stream: plus(a, 1) ASC
Sort Mode: None
Sort Mode: Stream: plus(a, 1) ASC
Sort Mode: Chunk: a ASC
Sort Mode: Chunk: a ASC
