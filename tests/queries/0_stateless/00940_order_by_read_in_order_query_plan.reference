-- { echoOn }

-- Exact match, single key
select * from tab order by (a + b) * c;
0	0	0	0
0	0	0	0
1	1	1	1
1	1	1	1
2	2	2	2
2	2	2	2
3	3	3	3
3	3	3	3
4	4	4	4
4	4	4	4
select * from (explain plan actions = 1 select * from tab order by (a + b) * c) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) ASC
  Result sort description: multiply(plus(a, b), c) ASC
select * from tab order by (a + b) * c desc;
4	4	4	4
4	4	4	4
3	3	3	3
3	3	3	3
2	2	2	2
2	2	2	2
1	1	1	1
1	1	1	1
0	0	0	0
0	0	0	0
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC
  Result sort description: multiply(plus(a, b), c) DESC
-- Exact match, full key
select * from tab order by (a + b) * c, sin(a / b);
0	0	0	0
0	0	0	0
1	1	1	1
1	1	1	1
2	2	2	2
2	2	2	2
3	3	3	3
3	3	3	3
4	4	4	4
4	4	4	4
select * from (explain plan actions = 1 select * from tab order by (a + b) * c, sin(a / b)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) ASC, sin(divide(a, b)) ASC
  Result sort description: multiply(plus(a, b), c) ASC, sin(divide(a, b)) ASC
select * from tab order by (a + b) * c desc, sin(a / b) desc;
4	4	4	4
4	4	4	4
3	3	3	3
3	3	3	3
2	2	2	2
2	2	2	2
1	1	1	1
1	1	1	1
0	0	0	0
0	0	0	0
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc, sin(a / b) desc) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC, sin(divide(a, b)) DESC
  Result sort description: multiply(plus(a, b), c) DESC, sin(divide(a, b)) DESC
-- Exact match, mixed direction
select * from tab order by (a + b) * c desc, sin(a / b);
4	4	4	4
4	4	4	4
3	3	3	3
3	3	3	3
2	2	2	2
2	2	2	2
1	1	1	1
1	1	1	1
0	0	0	0
0	0	0	0
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc, sin(a / b)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC
  Result sort description: multiply(plus(a, b), c) DESC, sin(divide(a, b)) ASC
select * from tab order by (a + b) * c, sin(a / b) desc;
0	0	0	0
0	0	0	0
1	1	1	1
1	1	1	1
2	2	2	2
2	2	2	2
3	3	3	3
3	3	3	3
4	4	4	4
4	4	4	4
select * from (explain plan actions = 1 select * from tab order by (a + b) * c, sin(a / b) desc) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) ASC
  Result sort description: multiply(plus(a, b), c) ASC, sin(divide(a, b)) DESC
-- Wrong order, full sort
select * from tab order by sin(a / b), (a + b) * c;
1	1	1	1
1	1	1	1
2	2	2	2
2	2	2	2
3	3	3	3
3	3	3	3
4	4	4	4
4	4	4	4
0	0	0	0
0	0	0	0
select * from (explain plan actions = 1 select * from tab order by sin(a / b), (a + b) * c) where explain ilike '%sort description%';
  Sort description: sin(divide(a, b)) ASC, multiply(plus(a, b), c) ASC
-- Fixed point
select * from tab where (a + b) * c = 8 order by sin(a / b);
2	2	2	2
2	2	2	2
select * from (explain plan actions = 1 select * from tab where (a + b) * c = 8 order by sin(a / b)) where explain ilike '%sort description%';
  Prefix sort description: sin(divide(a, b)) ASC
  Result sort description: sin(divide(a, b)) ASC
select * from tab where d + 1 = 2 order by (d + 1) * 4, (a + b) * c settings optimize_move_to_prewhere = 0;
1	1	1	1
1	1	1	1
select * from (explain plan actions = 1 select * from tab where d + 1 = 2 order by (d + 1) * 4, (a + b) * c settings optimize_move_to_prewhere = 0) where explain ilike '%sort description%';
  Prefix sort description: multiply(plus(d, 1), 4) ASC, multiply(plus(a, b), c) ASC
  Result sort description: multiply(plus(d, 1), 4) ASC, multiply(plus(a, b), c) ASC
select * from tab where d + 1 = 3 and (a + b) = 4 and c = 2 order by (d + 1) * 4, sin(a / b) settings optimize_move_to_prewhere = 0;
2	2	2	2
2	2	2	2
select * from (explain plan actions = 1 select * from tab where d + 1 = 3 and (a + b) = 4 and c = 2 order by (d + 1) * 4, sin(a / b) settings optimize_move_to_prewhere = 0) where explain ilike '%sort description%';
  Prefix sort description: multiply(plus(d, 1), 4) ASC, sin(divide(a, b)) ASC
  Result sort description: multiply(plus(d, 1), 4) ASC, sin(divide(a, b)) ASC
-- Wrong order with fixed point
select * from tab where (a + b) * c = 8 order by sin(b / a);
2	2	2	2
2	2	2	2
select * from (explain plan actions = 1 select * from tab where (a + b) * c = 8 order by sin(b / a)) where explain ilike '%sort description%';
  Sort description: sin(divide(b, a)) ASC
-- Monotonicity
select * from tab order by intDiv((a + b) * c, 2);
0	0	0	0
0	0	0	0
1	1	1	1
1	1	1	1
2	2	2	2
2	2	2	2
3	3	3	3
3	3	3	3
4	4	4	4
4	4	4	4
select * from (explain plan actions = 1 select * from tab order by intDiv((a + b) * c, 2)) where explain like '%sort description%';
  Prefix sort description: intDiv(multiply(plus(a, b), c), 2) ASC
  Result sort description: intDiv(multiply(plus(a, b), c), 2) ASC
select * from tab order by intDiv((a + b) * c, 2), sin(a / b);
0	0	0	0
0	0	0	0
1	1	1	1
1	1	1	1
2	2	2	2
2	2	2	2
3	3	3	3
3	3	3	3
4	4	4	4
4	4	4	4
select * from (explain plan actions = 1 select * from tab order by intDiv((a + b) * c, 2), sin(a / b)) where explain like '%sort description%';
  Prefix sort description: intDiv(multiply(plus(a, b), c), 2) ASC
  Result sort description: intDiv(multiply(plus(a, b), c), 2) ASC, sin(divide(a, b)) ASC
-- select * from tab order by (a + b) * c, intDiv(sin(a / b), 2);
select * from (explain plan actions = 1 select * from tab order by (a + b) * c, intDiv(sin(a / b), 2)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) ASC, intDiv(sin(divide(a, b)), 2) ASC
  Result sort description: multiply(plus(a, b), c) ASC, intDiv(sin(divide(a, b)), 2) ASC
-- select * from tab order by (a + b) * c desc , intDiv(sin(a / b), 2);
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc , intDiv(sin(a / b), 2)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC
  Result sort description: multiply(plus(a, b), c) DESC, intDiv(sin(divide(a, b)), 2) ASC
-- select * from tab order by (a + b) * c, intDiv(sin(a / b), 2) desc;
select * from (explain plan actions = 1 select * from tab order by (a + b) * c, intDiv(sin(a / b), 2) desc) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) ASC
  Result sort description: multiply(plus(a, b), c) ASC, intDiv(sin(divide(a, b)), 2) DESC
-- select * from tab order by (a + b) * c desc, intDiv(sin(a / b), 2) desc;
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc, intDiv(sin(a / b), 2) desc) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC, intDiv(sin(divide(a, b)), 2) DESC
  Result sort description: multiply(plus(a, b), c) DESC, intDiv(sin(divide(a, b)), 2) DESC
-- select * from tab order by (a + b) * c desc, intDiv(sin(a / b), -2);
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc, intDiv(sin(a / b), -2)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC, intDiv(sin(divide(a, b)), -2) ASC
  Result sort description: multiply(plus(a, b), c) DESC, intDiv(sin(divide(a, b)), -2) ASC
-- select * from tab order by (a + b) * c desc, intDiv(intDiv(sin(a / b), -2), -3);
select * from (explain plan actions = 1 select * from tab order by (a + b) * c desc, intDiv(intDiv(sin(a / b), -2), -3)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) DESC
  Result sort description: multiply(plus(a, b), c) DESC, intDiv(intDiv(sin(divide(a, b)), -2), -3) ASC
-- select * from tab order by (a + b) * c, intDiv(intDiv(sin(a / b), -2), -3);
select * from (explain plan actions = 1 select * from tab order by (a + b) * c, intDiv(intDiv(sin(a / b), -2), -3)) where explain like '%sort description%';
  Prefix sort description: multiply(plus(a, b), c) ASC, intDiv(intDiv(sin(divide(a, b)), -2), -3) ASC
  Result sort description: multiply(plus(a, b), c) ASC, intDiv(intDiv(sin(divide(a, b)), -2), -3) ASC
-- { echoOn }

select * from tab2 order by toTimeZone(toTimezone(x, 'UTC'), 'CET'), intDiv(intDiv(y, -2), -3);
2020-02-02 00:00:00	0	0
2020-02-02 00:00:00	0	0
2020-02-03 00:00:00	1	1
2020-02-03 00:00:00	1	1
2020-02-04 00:00:00	2	2
2020-02-04 00:00:00	2	2
2020-02-05 00:00:00	3	3
2020-02-05 00:00:00	3	3
select * from (explain plan actions = 1 select * from tab2 order by toTimeZone(toTimezone(x, 'UTC'), 'CET'), intDiv(intDiv(y, -2), -3)) where explain like '%sort description%';
  Prefix sort description: toTimeZone(toTimezone(x, \'UTC\'), \'CET\') ASC, intDiv(intDiv(y, -2), -3) ASC
  Result sort description: toTimeZone(toTimezone(x, \'UTC\'), \'CET\') ASC, intDiv(intDiv(y, -2), -3) ASC
select * from tab2 order by toStartOfDay(x), intDiv(intDiv(y, -2), -3);
2020-02-02 00:00:00	0	0
2020-02-02 00:00:00	0	0
2020-02-03 00:00:00	1	1
2020-02-03 00:00:00	1	1
2020-02-04 00:00:00	2	2
2020-02-04 00:00:00	2	2
2020-02-05 00:00:00	3	3
2020-02-05 00:00:00	3	3
select * from (explain plan actions = 1 select * from tab2 order by toStartOfDay(x), intDiv(intDiv(y, -2), -3)) where explain like '%sort description%';
  Prefix sort description: toStartOfDay(x) ASC
  Result sort description: toStartOfDay(x) ASC, intDiv(intDiv(y, -2), -3) ASC
-- select * from tab2 where toTimezone(x, 'CET') = '2020-02-03 01:00:00' order by intDiv(intDiv(y, -2), -3);
select * from (explain plan actions = 1 select * from tab2 where toTimezone(x, 'CET') = '2020-02-03 01:00:00' order by intDiv(intDiv(y, -2), -3) settings optimize_move_to_prewhere=0) where explain like '%sort description%';
  Prefix sort description: intDiv(intDiv(y, -2), -3) ASC
  Result sort description: intDiv(intDiv(y, -2), -3) ASC
