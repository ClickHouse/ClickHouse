SYSTEM FLUSH LOGS;

set log_comment = 'Please_Trace_ConvertingAggregatedToChunksTransform';

SELECT CAST(toStartOfInterval(event_time, toIntervalSecond(_CAST(60, 'UInt32'))), 'INT') AS t, avg(metric) FROM (SELECT event_time, sum(CurrentMetric_FilesystemCacheSize) AS metric FROM clusterAllReplicas(test_shard_localhost, merge('system', '^metric_log$')) WHERE (event_date >= toDate(now() - _CAST(600, 'UInt32'))) AND (event_time >= (now() - _CAST(600, 'UInt32'))) GROUP BY event_time) GROUP BY t ORDER BY t ASC WITH FILL STEP _CAST(60, 'UInt32')
SETTINGS skip_unavailable_shards = 1
FORMAT Null;

SELECT CAST(toStartOfInterval(event_time, toIntervalSecond(_CAST(60, 'UInt32'))), 'INT') AS t, avg(metric) FROM (SELECT event_time, sum(CurrentMetric_FilesystemCacheSize) AS metric FROM clusterAllReplicas(test_shard_localhost, merge('system', '^metric_log$')) WHERE (event_date >= toDate(now() - _CAST(600, 'UInt32'))) AND (event_time >= (now() - _CAST(600, 'UInt32'))) GROUP BY event_time) GROUP BY t ORDER BY t ASC WITH FILL STEP _CAST(60, 'UInt32')
FORMAT Null
SETTINGS skip_unavailable_shards = 1,
    min_compress_block_size = 2462542, max_compress_block_size = 361771, max_block_size = 40252, min_external_table_block_size_bytes = 0, max_joined_block_size_rows = 83874, max_insert_threads = 1, max_threads = 3, max_parsing_threads = 10, max_read_buffer_size = 913817, connect_timeout_with_failover_ms = 2000, connect_timeout_with_failover_secure_ms = 3000, use_hedged_requests = false, idle_connection_timeout = 36000, s3_max_get_rps = 1000000, s3_max_get_burst = 2000000, s3_max_put_rps = 1000000, s3_max_put_burst = 2000000, s3_check_objects_after_upload = true, max_remote_read_network_bandwidth = 1000000000000, max_remote_write_network_bandwidth = 1000000000000, max_local_read_bandwidth = 1000000000000, max_local_write_bandwidth = 1000000000000, stream_like_engine_allow_direct_select = true, enable_multiple_prewhere_read_steps = false, replication_wait_for_inactive_replica_timeout = 30, min_count_to_compile_expression = 0, compile_aggregate_expressions = false, compile_sort_description = false, group_by_two_level_threshold = 1, distributed_aggregation_memory_efficient = false, allow_nonconst_timezone_arguments = true, skip_unavailable_shards = true, input_format_parallel_parsing = false, min_chunk_bytes_for_parallel_parsing = 5635037, output_format_parallel_formatting = false, merge_tree_coarse_index_granularity = 24, min_bytes_to_use_direct_io = 10737418240, min_bytes_to_use_mmap_io = 10737418240, secondary_indices_enable_bulk_filtering = false, log_queries = true, insert_quorum_timeout = 60000, merge_tree_read_split_ranges_into_intersecting_and_non_intersecting_injection_probability = 0.2199999988079071, http_wait_end_of_query = true, http_response_buffer_size = 3216700, fsync_metadata = true, query_plan_join_swap_table = true, http_send_timeout = 60., http_receive_timeout = 60., use_index_for_in_with_subqueries_max_values = 1000000000, opentelemetry_start_trace_probability = 0.10000000149011612, enable_vertical_final = false, max_rows_to_read = 20000000, max_bytes_to_read = 1000000000000, max_bytes_to_read_leaf = 1000000000000, max_rows_to_group_by = 10000000000, max_bytes_before_external_group_by = 10737418240, max_bytes_ratio_before_external_group_by = 0., max_rows_to_sort = 10000000000, max_bytes_to_sort = 10000000000, prefer_external_sort_block_bytes = 1, max_bytes_before_external_sort = 10737418240, max_bytes_ratio_before_external_sort = 0., max_bytes_before_remerge_sort = 89823633, max_result_rows = 1000000000, max_result_bytes = 1000000000, max_execution_speed = 100000000000, max_execution_speed_bytes = 10000000000000, timeout_before_checking_execution_speed = 300., max_estimated_execution_time = 600., max_columns_to_read = 20000, max_temporary_columns = 20000, max_temporary_non_const_columns = 20000, readonly = 2, max_rows_in_set = 10000000000, max_bytes_in_set = 10000000000, max_rows_in_join = 10000000000, max_bytes_in_join = 10000000000, cross_join_min_rows_to_compress = 1, cross_join_min_bytes_to_compress = 1, max_rows_to_transfer = 1000000000, max_bytes_to_transfer = 1000000000, max_rows_in_distinct = 10000000000, max_bytes_in_distinct = 100000000;
