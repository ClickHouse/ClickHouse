Too many optimizations applied to query plan
Too many optimizations applied to query plan
> sipHash should be calculated after filtration
FUNCTION sipHash64
Filter column: equals
> sorting steps should know about limit
Limit 10
Sorting
Sorting
Limit 10
-- filter push down --
> filter should be pushed down after aggregating
Aggregating
Filter
0	1
1	2
2	3
3	4
4	5
5	6
6	7
7	8
8	9
9	10
> filter should be pushed down after aggregating, column after aggregation is const
COLUMN Const(UInt8) -> y != 0
Aggregating
Filter
Filter
> (analyzer) filter should be pushed down after aggregating, column after aggregation is const
COLUMN Const(UInt8) -> __table1.y != 0_UInt8
Aggregating
Filter
Filter
0	1	1
1	2	1
2	3	1
3	4	1
4	5	1
5	6	1
6	7	1
7	8	1
8	9	1
9	10	1
> one condition of filter should be pushed down after aggregating, other condition is aliased
Filter column
ALIAS s != 4 :: 4 -> y != 0 AND s != 4 UInt8 : 2
Aggregating
Filter column: y != 0
> (analyzer) one condition of filter should be pushed down after aggregating, other condition is aliased
Filter column
ALIAS __table1.s != 4_UInt8 :: 1 -> __table1.y != 0_UInt8 AND __table1.s != 4_UInt8
Aggregating
Filter column: __table1.y != 0_UInt8
0	1
1	2
2	3
3	4
5	6
6	7
7	8
8	9
9	10
> one condition of filter should be pushed down after aggregating, other condition is cast
Filter column
FUNCTION sum(x) :: 1 - 4 :: 2 -> s - 4
Aggregating
Filter column: y != 0
> (analyzer) one condition of filter should be pushed down after aggregating, other condition is cast
Filter column
FUNCTION sum(__table2.x) :: 0 - 4_UInt8 :: 2 -> __table1.s - 4_UInt8
Aggregating
Filter column: __table1.y != 0_UInt8
0	1
1	2
2	3
3	4
5	6
6	7
7	8
8	9
9	10
> one condition of filter should be pushed down after aggregating, other two conditions are ANDed
Filter column
FUNCTION s - 8 :: 3 AND s - 4 :: 5 -> y != 0 AND s - 8 AND s - 4
Aggregating
Filter column: y != 0
> (analyzer) one condition of filter should be pushed down after aggregating, other two conditions are ANDed
Filter column
FUNCTION __table1.s - 8_UInt8 :: 3 AND __table1.s - 4_UInt8 :: 5 -> __table1.y != 0_UInt8 AND __table1.s - 8_UInt8 AND __table1.s - 4_UInt8
Aggregating
Filter column: __table1.y != 0_UInt8
0	1
1	2
2	3
3	4
5	6
6	7
7	8
9	10
> two conditions of filter should be pushed down after aggregating and ANDed, one condition is aliased
Filter column
ALIAS s != 8 :: 4 -> y != 0 AND s != 8 AND y - 4
Aggregating
Filter column: y != 0 AND y - 4
> (analyzer) two conditions of filter should be pushed down after aggregating and ANDed, one condition is aliased
Filter column
ALIAS __table1.s != 8_UInt8 :: 1 -> __table1.y != 0_UInt8 AND __table1.s != 8_UInt8 AND __table1.y - 4_UInt8
Aggregating
Filter column: __table1.y != 0_UInt8 AND __table1.y - 4_UInt8
0	1
1	2
2	3
4	5
5	6
6	7
7	8
9	10
> filter is split, one part is filtered before ARRAY JOIN
Filter column: y != 2 AND x != 0
ARRAY JOIN x
Filter column: y != 2
> (analyzer) filter is split, one part is filtered before ARRAY JOIN
Filter column: __table2.y != 2_UInt8 AND __array_join_exp_1 != 0_UInt8
ARRAY JOIN __array_join_exp_1
Filter column: __table2.y != 2_UInt8
1	3
> filter is pushed down before Distinct
Distinct
Distinct
Filter column: y != 2
> (analyzer) filter is pushed down before Distinct
Distinct
Distinct
Filter column: __table1.y != 2_UInt8
0	0
0	1
1	0
1	1
> filter is pushed down before sorting steps
Sorting
Sorting
Filter column: x != 0 AND y != 0
> (analyzer) filter is pushed down before sorting steps
Sorting
Sorting
Filter column: __table1.x != 0_UInt8 AND __table1.y != 0_UInt8
1	2
1	1
> filter is pushed down before TOTALS HAVING and aggregating
TotalsHaving
Aggregating
Filter column: y != 2
> (analyzer) filter is pushed down before TOTALS HAVING and aggregating
TotalsHaving
Aggregating
Filter column: __table1.y != 2_UInt8
0	12
1	15
3	10

0	37
> filter is pushed down before CreatingSets
CreatingSets
Filter
1
3
> one condition of filter is pushed down before LEFT JOIN
  Join
Filter column: number != 1
> (analyzer) one condition of filter is pushed down before LEFT JOIN
  Join
Filter column: __table1.number != 1_UInt8
0	0
3	3
> one condition of filter is pushed down before INNER JOIN
  Join
Filter column: number != 1 AND number != 2
Filter column: b != 2 AND b != 1
> (analyzer) one condition of filter is pushed down before INNER JOIN
  Join
Filter column: __table1.number != 1_UInt8 AND __table1.number != 2_UInt8
Filter column: __table2.b != 2_UInt8 AND __table2.b != 1_UInt8
3	3
> filter is pushed down before UNION
Union
Filter
Filter
2	3
2	3
> function calculation should be done after sorting and limit (if possible)
> Expression should be divided into two subexpressions and only one of them should be moved after Sorting
Expression ((Projection + Before ORDER BY [lifted up part]))
FUNCTION sipHash64
Sorting
Expression (Before ORDER BY)
FUNCTION plus
> (analyzer) function calculation should be done after sorting and limit (if possible)
> Expression should be divided into two subexpressions and only one of them should be moved after Sorting
Expression ((Project names + (Before ORDER BY + (Projection + Change column names to column identifiers)) [lifted up part]))
FUNCTION sipHash64
Sorting
Expression ((Before ORDER BY + (Projection + Change column names to column identifiers)))
FUNCTION plus
> this query should be executed without throwing an exception
0
