-- { echoOn }
select partition_id, rows, index_granularity_bytes_in_memory_allocated>25 from system.parts where database = currentDatabase() and table = 'test_materialize' and active order by 1;
0	5000	1
1	5000	1
alter table test_materialize modify setting use_const_adaptive_granularity;
alter table test_materialize add column new_value String;
alter table test_materialize delete where new_value != '';
alter table test_materialize rewrite parts settings mutations_sync=2;
select partition_id, rows, index_granularity_bytes_in_memory_allocated from system.parts where database = currentDatabase() and table = 'test_materialize' and active order by 1;
0	5000	25
1	5000	25
alter table test_materialize modify setting use_const_adaptive_granularity=0;
alter table test_materialize rewrite parts;
alter table test_materialize delete where (key % 2) == 0 settings mutations_sync=2;
select partition_id, rows, index_granularity_bytes_in_memory_allocated>25 from system.parts where database = currentDatabase() and table = 'test_materialize' and active order by 1;
0	2500	1
1	2500	1
select * from system.mutations where database = currentDatabase() and not is_done format Vertical;
