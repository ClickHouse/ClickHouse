-- { echoOn }

SELECT 'First JOIN LEFT second JOIN INNER';
First JOIN LEFT second JOIN INNER
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    INNER JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 0
)
EXCEPT
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    INNER JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 1
);
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
INNER JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC
SETTINGS enable_parallel_replicas=0;
2314142518414636144	800
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
INNER JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC;
2314142518414636144	800
SELECT 'First JOIN LEFT second JOIN LEFT';
First JOIN LEFT second JOIN LEFT
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    LEFT JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 0
)
EXCEPT
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    LEFT JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 1
);
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
LEFT JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC
SETTINGS enable_parallel_replicas=0;
226951274137800912	1000
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
LEFT JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC;
226951274137800912	1000
SELECT 'First JOIN LEFT second JOIN RIGHT';
First JOIN LEFT second JOIN RIGHT
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    RIGHT JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 0
)
EXCEPT
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    RIGHT JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 1
);
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
RIGHT JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC
SETTINGS enable_parallel_replicas=0;
6134460278847160657	900
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
RIGHT JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC;
6134460278847160657	900
SELECT 'First JOIN LEFT second JOIN FULL';
First JOIN LEFT second JOIN FULL
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    FULL JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 0
)
EXCEPT
(
    SELECT
        t1.*,
        t2.*,
        t3.*
    FROM test_table_join_1 AS t1
    LEFT JOIN test_table_join_2 AS t2 USING (id)
    FULL JOIN test_table_join_3 AS t3 USING (id)
    ORDER BY ALL ASC
    SETTINGS enable_parallel_replicas = 1
);
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
FULL JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC
SETTINGS enable_parallel_replicas=0;
4047269034570325425	1100
SELECT
    sum(sipHash64(t1.*, t2.*, t3.*)),
    count()
FROM test_table_join_1 AS t1
LEFT JOIN test_table_join_2 AS t2 USING (id)
FULL JOIN test_table_join_3 AS t3 USING (id)
ORDER BY ALL ASC;
4047269034570325425	1100
