-- Tags: no-fasttest

{% for type in ["Object('json')", "Object(Nullable('json'))"] -%}

SELECT '--JSONLength--';
SELECT JSONLength('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }});
SELECT JSONLength('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b');
SELECT JSONLength('{}'::{{ type }});

SELECT '--JSONHas--';
SELECT JSONHas('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'a');
SELECT JSONHas('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b');
SELECT JSONHas('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'c');

SELECT '--isValidJSON--';
SELECT isValidJSON('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }});

SELECT '--JSONKey--';
SELECT JSONKey('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 1);
SELECT JSONKey('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 2);
SELECT JSONKey('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, -1);
SELECT JSONKey('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, -2);

SELECT '--JSONType--';
SELECT JSONType('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }});
SELECT JSONType('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b');

SELECT '--JSONExtract<numeric>--';
SELECT JSONExtractInt('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 1);
SELECT JSONExtractFloat('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 2);
SELECT JSONExtractUInt('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', -1);
SELECT JSONExtractBool('{"passed": true}'::{{ type }}, 'passed');

SELECT '--JSONExtractString--';
SELECT JSONExtractString('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'a');
SELECT JSONExtractString('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 1);
select JSONExtractString('{"abc":"\\n\\u0000"}'::{{ type }}, 'abc');
select JSONExtractString('{"abc":"\\u263a"}'::{{ type }}, 'abc');

SELECT '--JSONExtract (generic)--';
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'Tuple(String, Array(Float64))');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'Tuple(a String, b Array(Float64))');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'Tuple(b Array(Float64), a String)');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'Tuple(a FixedString(6), c UInt8)');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'a', 'String');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 'Array(Float32)');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 'Array(Int8)');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 'Array(Nullable(Int8))');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 'Array(UInt8)');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 'Array(Nullable(UInt8))');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 1, 'Int8');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 2, 'Int32');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 4, 'Nullable(Int64)');
SELECT JSONExtract('{"passed": true}'::{{ type }}, 'passed', 'UInt8');
SELECT JSONExtract('{"day": "Thursday"}'::{{ type }}, 'day', 'Enum8(\'Sunday\' = 0, \'Monday\' = 1, \'Tuesday\' = 2, \'Wednesday\' = 3, \'Thursday\' = 4, \'Friday\' = 5, \'Saturday\' = 6)');
SELECT JSONExtract('{"day": 5}'::{{ type }}, 'day', 'Enum8(\'Sunday\' = 0, \'Monday\' = 1, \'Tuesday\' = 2, \'Wednesday\' = 3, \'Thursday\' = 4, \'Friday\' = 5, \'Saturday\' = 6)');
SELECT JSONExtract('{"a":3,"b":5,"c":7}'::{{ type }}, 'Tuple(a Int, b Int)');
SELECT JSONExtract('{"a":3,"b":5,"c":7}'::{{ type }}, 'Tuple(c Int, a Int)');
SELECT JSONExtract('{"a":3,"b":5,"c":7}'::{{ type }}, 'Tuple(b Int, d Int)');
SELECT JSONExtract('{"a":3,"b":5,"c":7}'::{{ type }}, 'Tuple(Int, Int)');
SELECT JSONExtract('{"a":3}'::{{ type }}, 'Tuple(Int, Int)');
SELECT JSONExtract('{"a":123456, "b":3.55}'::{{ type }}, 'Tuple(a LowCardinality(Int32), b Decimal(5, 2))');
SELECT JSONExtract('{"a":1, "b":"417ddc5d-e556-4d27-95dd-a34d84e46a50"}'::{{ type }}, 'Tuple(a Int8, b UUID)');
SELECT JSONExtract('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'a', 'LowCardinality(String)');
SELECT JSONExtract('{"a":3333.6333333333333333333333, "b":"test"}'::{{ type }}, 'Tuple(a Decimal(10,1), b LowCardinality(String))');
SELECT JSONExtract('{"a":3333.6333333333333333333333, "b":"test"}'::{{ type }}, 'Tuple(a Decimal(20,10), b LowCardinality(String))');
SELECT JSONExtract('{"a":123456.123456}'::{{ type }}, 'a', 'Decimal(20, 4)') as a, toTypeName(a);
SELECT toDecimal64(123456789012345.12, 4), JSONExtract('{"a":123456789012345.12}'::{{ type }}, 'a', 'Decimal(30, 4)');
SELECT toDecimal128(1234567890.12345678901234567890, 20), JSONExtract('{"a":1234567890.12345678901234567890, "b":"test"}'::{{ type }}, 'Tuple(a Decimal(35,20), b LowCardinality(String))');
SELECT toDecimal256(1234567890.123456789012345678901234567890, 30), JSONExtract('{"a":1234567890.12345678901234567890, "b":"test"}'::{{ type }}, 'Tuple(a Decimal(45,30), b LowCardinality(String))');
SELECT JSONExtract('{"a": 3}'::{{ type }}, 'a', 'Decimal(5, 2)');

SELECT '--JSONExtractKeysAndValues--';
SELECT JSONExtractKeysAndValues('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'String');
SELECT JSONExtractKeysAndValues('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'Array(Float64)');
SELECT JSONExtractKeysAndValues('{"a": "hello", "b": "world"}'::{{ type }}, 'String');
SELECT JSONExtractKeysAndValues('{"x": {"a": 5, "b": 7, "c": 11}}'::{{ type }}, 'x', 'Int8');
SELECT JSONExtractKeysAndValues('{"a": "hello", "b": "world"}'::{{ type }}, 'LowCardinality(String)');

SELECT '--JSONExtractRaw--';
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }});
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'a');
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b');
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b', 1);
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }});
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }}, 'c');
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }}, 'c', 'd');
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }}, 'c', 'd', 2);
SELECT JSONExtractRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }}, 'c', 'd', 3);
SELECT JSONExtractRaw('{"passed": true}'::{{ type }});
SELECT JSONExtractRaw('{}'::{{ type }});
SELECT JSONExtractRaw('{"abc":"\\n\\u0000"}'::{{ type }}, 'abc');
SELECT JSONExtractRaw('{"abc":"\\u263a"}'::{{ type }}, 'abc');

SELECT '--JSONExtractArrayRaw--';
SELECT JSONExtractArrayRaw(''::{{ type }});
SELECT JSONExtractArrayRaw('{"a": "hello", "b": "not_array"}'::{{ type }});
SELECT JSONExtractArrayRaw('{"arr": []}'::{{ type }}, 'arr');
SELECT JSONExtractArrayRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b');
SELECT JSONExtractArrayRaw('{"arr": [1,2,3,4,5,"hello"]}'::{{ type }}, 'arr');
SELECT JSONExtractArrayRaw(arrayJoin(JSONExtractArrayRaw('{"arr": [[1,2,3],[4,5,6]]}'::{{ type }}, 'arr')));

SELECT '--JSONExtractKeysAndValuesRaw--';
SELECT JSONExtractKeysAndValuesRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'a');
SELECT JSONExtractKeysAndValuesRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }}, 'b');
SELECT JSONExtractKeysAndValuesRaw('{"a": "hello", "b": [-100, 200.0, 300]}'::{{ type }});
SELECT JSONExtractKeysAndValuesRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }});
SELECT JSONExtractKeysAndValuesRaw('{"a": "hello", "b": [-100, 200.0, 300], "c":{"d":[121,144]}}'::{{ type }}, 'c');

SELECT '--const/non-const mixed--';
SELECT JSONExtractString('{"arr": ["a", "b", "c", "d", "e"]}'::{{ type }}, 'arr', idx) FROM (SELECT arrayJoin([1,2,3,4,5]) AS idx);
SELECT JSONExtractString(json::{{ type }}, 's') FROM (SELECT arrayJoin(['{"s":"u"}', '{"s":"v"}']) AS json);

{% endfor -%}
