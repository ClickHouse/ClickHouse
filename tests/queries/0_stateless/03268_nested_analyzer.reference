-- {echoOn }

SELECT nested(['a', 'b'], [1, 2], [3, 4]);
[(1,3),(2,4)]
SELECT nested(['a', 'b'], [1, 2], materialize([3, 4]));
[(1,3),(2,4)]
SELECT nested(['a', 'b'], materialize([1, 2]), materialize([3, 4]));
[(1,3),(2,4)]
SELECT nested([['a', 'b']], [[1, 2], [3]], [[4, 5], [6]]);
[[(1,4),(2,5)],[(3,6)]]
SELECT nested([['a'], ['b']], [[1, 2], [3]], [[4, 5], [6]]); -- {serverError BAD_ARGUMENTS}
select x, y, z, nested(['a', 'b', 'c'], x, y, z), nested([['a', 'b', 'c']], x, y, z) from system.one array join [[[1, 2], [3]], [[4], [5, 6]]] as x, [[[7, 8], [9]], [[10], [11, 12]]] as y, [[[13, 14], [15]], [[16], [17, 18]]] as z format Pretty;
   ┏━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃ x           ┃ y              ┃ z              ┃ nested(['a', 'b', 'c'], x, y, z)          ┃ nested([['a', 'b', 'c']], x, y, z)  ┃
   ┡━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
1. │ [[1,2],[3]] │ [[7,8],[9]]    │ [[13,14],[15]] │ [([1,2],[7,8],[13,14]),([3],[9],[15])]    │ [[(1,7,13),(2,8,14)],[(3,9,15)]]    │
   ├─────────────┼────────────────┼────────────────┼───────────────────────────────────────────┼─────────────────────────────────────┤
2. │ [[4],[5,6]] │ [[10],[11,12]] │ [[16],[17,18]] │ [([4],[10],[16]),([5,6],[11,12],[17,18])] │ [[(4,10,16)],[(5,11,17),(6,12,18)]] │
   └─────────────┴────────────────┴────────────────┴───────────────────────────────────────────┴─────────────────────────────────────┘
select nested([[['a', 'b', 'c']]], [[[1, 2], [3]], [[4], [5, 6]]] as x, [[[7, 8], [9]], [[10], [11, 12]]] as y, [[[13, 14], [15]], [[16], [17, 18]]] as z) format Pretty;
   ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃ nested([[['a', 'b', 'c']]], x, y, z)                                   ┃
   ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
1. │ [[[(1,7,13),(2,8,14)],[(3,9,15)]],[[(4,10,16)],[(5,11,17),(6,12,18)]]] │
   └────────────────────────────────────────────────────────────────────────┘
SELECT nested(['a', 'b'], [[1, 2], [3, 4]], [[5], [6]]);
[([1,2],[5]),([3,4],[6])]
SELECT nested([['a', 'b']], [[1, 2], [3, 4]], [[5], [6]]); -- {serverError SIZES_OF_ARRAYS_DONT_MATCH}
0	0
0	0	1
