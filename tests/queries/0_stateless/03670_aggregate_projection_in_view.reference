-- { echo ON }

DROP TABLE IF EXISTS t;
DROP TABLE IF EXISTS v;
CREATE TABLE t ( x String, y String, v Float64 ) ENGINE=MergeTree ORDER BY (x, y);
ALTER TABLE t ADD PROJECTION tp ( SELECT x, SUM(v) GROUP BY x );
CREATE VIEW v AS SELECT * FROM t;
INSERT INTO t (x, y, v) SELECT number % 10, number % 100, number FROM numbers(10000);
SET optimize_use_projections = 1;
SET force_optimize_projection = 1;
EXPLAIN SELECT x, SUM(v) FROM v GROUP BY x;
Expression ((Project names + Projection))
  Aggregating
    Expression
      ReadFromMergeTree (tp)
SELECT x, SUM(v) FROM v GROUP BY x ORDER BY x;
0	4995000
1	4996000
2	4997000
3	4998000
4	4999000
5	5000000
6	5001000
7	5002000
8	5003000
9	5004000
DROP TABLE t;
DROP TABLE v;
