-- enable optimize_distinct_in_order
-- distinct pipeline on empty table -> no optimization, table is empty
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Distinct)
    DistinctTransform
      (Expression)
      ExpressionTransform
        (ReadFromPreparedSource)
        NullSource 0 → 1
-- insert into table
-- disable optimize_distinct_in_order
-- distinct all primary key columns -> no optimization
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Distinct)
    DistinctTransform
      (Expression)
      ExpressionTransform
        (ReadFromMergeTree)
        MergeTreeInOrder 0 → 1
-- enable optimize_distinct_in_order
-- distinct with all primary key columns -> pre-distinct optimization only
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Distinct)
    DistinctSortedChunkTransform
      (Expression)
      ExpressionTransform
        (ReadFromMergeTree)
        MergeTreeInOrder 0 → 1
-- distinct with primary key prefix -> pre-distinct optimization only
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Distinct)
    DistinctSortedChunkTransform
      (Expression)
      ExpressionTransform
        (ReadFromMergeTree)
        MergeTreeInOrder 0 → 1
-- distinct with primary key prefix and order by on column in distinct -> pre-distinct and final distinct optimization
(Expression)
ExpressionTransform
  (Distinct)
  DistinctSortedTransform
    (Sorting)
    MergeSortingTransform
      LimitsCheckingTransform
        PartialSortingTransform
          (Distinct)
          DistinctSortedChunkTransform
            (Expression)
            ExpressionTransform
              (ReadFromMergeTree)
              MergeTreeInOrder 0 → 1
-- distinct with primary key prefix and order by on column _not_ in distinct -> pre-distinct optimization only
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Sorting)
    MergeSortingTransform
      LimitsCheckingTransform
        PartialSortingTransform
          (Distinct)
          DistinctSortedChunkTransform
            (Expression)
            ExpressionTransform
              (ReadFromMergeTree)
              MergeTreeInOrder 0 → 1
-- distinct with non-primary key prefix -> no optimization
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Distinct)
    DistinctTransform
      (Expression)
      ExpressionTransform
        (ReadFromMergeTree)
        MergeTreeInOrder 0 → 1
-- distinct with non-primary key prefix and order by on column in distinct -> final distinct optimization only
(Expression)
ExpressionTransform
  (Distinct)
  DistinctSortedTransform
    (Sorting)
    MergeSortingTransform
      LimitsCheckingTransform
        PartialSortingTransform
          (Distinct)
          DistinctTransform
            (Expression)
            ExpressionTransform
              (ReadFromMergeTree)
              MergeTreeInOrder 0 → 1
-- distinct with non-primary key prefix and order by on column _not_ in distinct -> no optimization
(Expression)
ExpressionTransform
  (Distinct)
  DistinctTransform
    (Sorting)
      (Distinct)
      DistinctTransform
        (Expression)
        ExpressionTransform
          (ReadFromMergeTree)
          MergeTreeInOrder 0 → 1
-- the same values in every chunk, distinct in order should skip entire chunks with the same key as previous one
-- single-threaded distinct
0
-- multi-threaded distinct
0
-- skip part of chunk since it contains values from previous one
-- single-threaded distinct
0
1
2
3
4
5
6
7
8
9
-- multi-threaded distinct
0
1
2
3
4
5
6
7
8
9
-- create table with not only primary key columns
-- distinct with primary key prefix only
0
-- distinct with full key
0	0
0	1
0	2
0	3
0	4
-- distinct with key prefix and non-sorted column
0	0
0	1
0	2
0	3
0	4
0	5
0	6
0	7
0	8
0	9
