version: 1
defaults:
  duration: 120
  topology: 3
scenarios:
  - id: PERF-01
    name: Prod-mix baseline tails
    topology: 3
    workload: { config: workloads/prod_mix.yaml, duration: 180 }
    gates:
      - { type: single_leader }
      - { type: error_rate_le, max_ratio: 0.02 }

  - id: PERF-02
    name: Write-heavy default vs Rocks
    topology: 3
    workload: { config: workloads/write_heavy.yaml, duration: 180 }
    gates:
      - { type: single_leader }

  - id: PERF-03
    name: Backpressure recovery
    topology: 3
    workload: { config: workloads/prod_mix.yaml, duration: 120 }
    faults:
      - { kind: netem, on: all, delay_ms: 80, duration_s: 60 }
    gates:
      - { type: single_leader }

  - id: PERF-04
    name: Huge MultiRead stripes
    topology: 3
    workload: { config: workloads/prod_mix.yaml, duration: 180 }
    gates:
      - { type: single_leader }
      - { type: error_rate_le, max_ratio: 0.05 }
    opts:
      feature_flags:
        multi_read: 1

  - id: PERF-05
    name: Read-only stripes fairness
    topology: 3
    workload: { config: workloads/prod_mix.yaml, duration: 180 }
    gates:
      - { type: single_leader }

  - id: IMP-03
    name: RocksKeeper compaction tails
    topology: 3
    workload: { config: workloads/write_heavy.yaml, duration: 180 }
    gates:
      - { type: single_leader }
