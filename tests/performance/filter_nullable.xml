<test>
    <settings>
        <max_insert_threads>8</max_insert_threads>
        <allow_experimental_projection_optimization>0</allow_experimental_projection_optimization>
        <max_threads>1</max_threads>
    </settings>

    <create_query>
        CREATE TABLE a
        (
            d Nullable(Date),
            n Nullable(Int64)
        )
        ENGINE = MergeTree
        ORDER BY tuple()
    </create_query>

    <fill_query>insert into a select '2000-01-01', number%1000 from numbers_mt(100000000)</fill_query>
    <fill_query>insert into a select '2000-01-02', number%1000 from numbers_mt(100000000)</fill_query>
    <fill_query>insert into a select '2000-01-03', number%1000 from numbers_mt(100000000)</fill_query>
    <fill_query>insert into a select '2000-01-04', number%1000 from numbers_mt(100000000)</fill_query>

    <fill_query>OPTIMIZE TABLE a FINAL</fill_query>

    <query>select count(d) from a where d='2000-01-01'</query>
    <query>select count(n) from a where n between 0 and 750</query>
    <drop_query>drop table if exists a</drop_query>
</test>
