<test max_ignored_relative_change="0.4">

    <preconditions>
        <table_exists>hits_100m_single</table_exists>
    </preconditions>

    <settings>
        <max_memory_usage>30000000000</max_memory_usage>
    </settings>

    <create_query>CREATE TABLE ma_kv (key String, value AggregateFunction(groupBitmap, UInt64)) EmbeddedRocksdb primary key(key)</create_query>

    <fill_query> INSERT INTO ma_kv SELECT concat('CodeVersion=', CodeVersion) as key,  bitmapBuild(groupArray(UserID)) AS value FROM hits_100m_single GROUP BY key</fill_query>

    <query>SELECT groupBitmapOr(value) FROM ma_kv WHERE key IN ('CodeVersion=1657', 'CodeVersion=1', 'CodeVersion=275')</query>

    <drop_query>DROP TABLE IF EXISTS ma_kv</drop_query>
</test>
