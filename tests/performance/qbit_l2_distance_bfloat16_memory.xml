<test>
    <settings>
        <allow_experimental_qbit_type>1</allow_experimental_qbit_type>
    </settings>
    <substitutions>
        <substitution>
            <name>vector_size</name>
            <values>
                <value>100</value>
            </values>
        </substitution>

        <substitution>
            <name>elements</name>
            <values>
                <value>1000000</value>
            </values>
        </substitution>

        <substitution>
            <name>type</name>
            <values>
                <value>BFloat16</value>
            </values>
        </substitution>
        <substitution>
            <name>p</name>
            <values>
                <!-- Test full and small precisions -->
                <value>16</value>
                <value>8</value>
            </values>
        </substitution>
    </substitutions>

    <create_query>DROP TABLE IF EXISTS tab_{type}</create_query>
    <create_query>CREATE TABLE tab_{type} (id UInt32, vec QBit({type}, {vector_size})) ENGINE = Memory</create_query>
    <create_query>INSERT INTO tab_{type} SELECT number + 1 AS id, arrayMap(i -> id + i - 1, range({vector_size})) AS vec FROM numbers({elements})</create_query>

    <query>
        SELECT * FROM (SELECT 1 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 2 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 3 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 4 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 5 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 6 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 7 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 8 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 9 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
        UNION ALL
        SELECT * FROM (SELECT 10 AS k, id, L2DistanceTransposed(vec, arrayMap(i -> (i + k) * 2, range({vector_size})), {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 10)
    </query>

    <drop_query>DROP TABLE tab_{type}</drop_query>
</test>
