<test>
    <preconditions>
        <table_exists>hits_100m_single</table_exists>
    </preconditions>

    <create_query>DROP TABLE IF EXISTS perf_avg</create_query>
    <create_query>SET allow_experimental_bigint_types=1</create_query>

    <create_query>CREATE TABLE perf_avg(
        num UInt64,
        num_u Decimal256(75) DEFAULT toDecimal256(num / 400000, 75),
        num_f Float64 DEFAULT num / 100
        ) ENGINE = MergeTree() ORDER BY tuple()
    </create_query>

    <fill_query>
        INSERT INTO perf_avg(num)
        SELECT toUInt64(UserID / (WatchID + 1)  * 1000000)
        FROM hits_100m_single
    </fill_query>

    <query>SELECT avg(num) FROM perf_avg</query>
    <query>SELECT avg(2 * num) FROM perf_avg</query>
    <query>SELECT avg(num_u) FROM perf_avg</query>
    <query>SELECT avg(num_f) FROM perf_avg</query>
    <query>SELECT avgWeighted(num_f, num) FROM perf_avg</query>
    <query>SELECT avgWeighted(num_f, num_f) FROM perf_avg</query>
    <query>SELECT avgWeighted(num_f, num_u) FROM perf_avg</query>
    <query>SELECT avgWeighted(num_u, num_f) FROM perf_avg</query>
    <query>SELECT avgWeighted(num_u, num) FROM perf_avg</query>
    <query>SELECT avgWeighted(num_u, num_u) FROM perf_avg</query>

    <drop_query>DROP TABLE IF EXISTS perf_avg</drop_query>
</test>
