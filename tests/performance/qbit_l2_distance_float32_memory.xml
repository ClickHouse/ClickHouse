<test>
    <settings>
        <allow_experimental_qbit_type>1</allow_experimental_qbit_type>
    </settings>
    <substitutions>
        <substitution>
            <name>vector_size</name>
            <values>
                <value>100</value>
            </values>
        </substitution>

        <substitution>
            <name>elements</name>
            <values>
                <value>1000000</value>
            </values>
        </substitution>

        <substitution>
            <name>type</name>
            <values>
                <value>Float32</value>
            </values>
        </substitution>
        <substitution>
            <name>p</name>
            <values>
                <value>32</value>
                <value>16</value>
                <value>8</value>
                <value>4</value>
                <value>2</value>
            </values>
        </substitution>
    </substitutions>

    <create_query>DROP TABLE IF EXISTS tab_{type}</create_query>
    <create_query>CREATE TABLE tab_{type} (id UInt32, vec QBit({type}, {vector_size})) ENGINE = Memory</create_query>
    <create_query>INSERT INTO tab_{type} SELECT number + 1 AS id, arrayMap(i -> to{type}(id + i - 1), range({vector_size})) AS vec FROM numbers({elements})</create_query>

    <query>WITH arrayMap(i -> to{type}((i + 1) * 2), range({vector_size})) AS reference_vec SELECT id, L2DistanceTransposed(vec, reference_vec, {p}) AS dist FROM tab_{type} ORDER BY dist LIMIT 3</query>

    <drop_query>DROP TABLE tab_{type}</drop_query>
</test>
