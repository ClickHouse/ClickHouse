<test>
    <create_query>CREATE TABLE orders(o_orderkey Int32, o_custkey Int32, o_totalprice Decimal(15, 2)) ENGINE MergeTree ORDER BY o_orderkey</create_query>
    <create_query>CREATE TABLE customer(c_custkey Int32, c_nationkey Int32) ENGINE MergeTree ORDER BY c_custkey</create_query>
    <create_query>CREATE TABLE nation(n_nationkey Int32, n_name String) ENGINE MergeTree ORDER BY n_nationkey</create_query>

    <fill_query>INSERT INTO orders SELECT number, number/10000, number%1000 FROM numbers(100000000)</fill_query>
    <fill_query>INSERT INTO customer SELECT number, 5 FROM numbers(1)</fill_query>
    <fill_query>INSERT INTO customer SELECT number+1, 6 FROM numbers(100)</fill_query>
    <fill_query>INSERT INTO customer SELECT number+1000, 7 FROM numbers(10000)</fill_query>
    <fill_query>INSERT INTO nation VALUES (5,'ETHIOPIA'),(6,'FRANCE'),(7,'GERMANY'),(100,'UNKNOWN')</fill_query>

    <!-- 1 element in filter  -->
    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'ETHIOPIA') AS cn 
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=0
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'ETHIOPIA') AS cn 
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'ETHIOPIA') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1, join_runtime_filter_exact_values_limit=0
    </query>


    <!-- 100 elements in filter -->
    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'FRANCE') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=0
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'FRANCE') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'FRANCE') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1, join_runtime_filter_exact_values_limit=10
    </query>


    <!-- 10000 elements in filter -->
    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'GERMANY') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=0
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'GERMANY') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1, join_runtime_filter_exact_values_limit=20000
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'GERMANY') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1, join_runtime_filter_exact_values_limit=10
    </query>


    <!-- 0 elements in filter -->
    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'WAKANDA') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=0
    </query>

    <query>
        SELECT avg(o_totalprice)
        FROM orders
        JOIN (SELECT * FROM customer JOIN nation ON c_nationkey = n_nationkey WHERE n_name = 'WAKANDA') AS cn
        ON c_custkey = o_custkey
        SETTINGS enable_join_runtime_filters=1
    </query>

    <drop_query>DROP TABLE orders</drop_query>
    <drop_query>DROP TABLE customer</drop_query>
    <drop_query>DROP TABLE nation</drop_query>
</test>
