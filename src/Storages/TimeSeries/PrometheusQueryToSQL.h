#pragma once

#include <Storages/TimeSeries/PrometheusQueryEvaluationSettings.h>


namespace DB
{
class ColumnsDescription;

/// Converts a parsed prometheus query to SQL.
class PrometheusQueryToSQLConverter
{
public:
    PrometheusQueryToSQLConverter(
        std::shared_ptr<const PrometheusQueryTree> promql_query_, const PrometheusQueryEvaluationSettings & evaluation_settings_);

    /// Builds an AST to execute this prometheus query.
    ASTPtr getSQL() const;

    /// Returns the names and types of columns returned by the SQL query generated by function getSQL().
    ColumnsDescription getResultColumns() const;

    /// Returns the result type of the query. Takes into account the evaluation range and the query tree.
    PrometheusQueryResultType getResultType() const { return result_type; }

private:
    class ASTBuilder;

    std::shared_ptr<const PrometheusQueryTree> promql_query;
    PrometheusQueryEvaluationSettings evaluation_settings;

    PrometheusQueryResultType result_type;
};

}
