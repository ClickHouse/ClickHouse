#pragma once

#include <Parsers/IAST_fwd.h>
#include <Storages/ColumnsDescription.h>
#include <Storages/TimeSeries/PrometheusQueryEvaluationSettings.h>
#include <Storages/TimeSeries/PrometheusQueryToSQL/ConverterDefs.h>


namespace DB::PrometheusQueryToSQL
{

/// Converts a prometheus query to SQL.
class Converter
{
public:
    Converter(std::shared_ptr<const PrometheusQueryTree> promql_tree_, PrometheusQueryEvaluationSettings settings_);

    /// Returns the result type of the query. Takes into account the evaluation range and the query tree.
    ResultType getResultType() const { return result_type; }

    /// Returns the names and types of columns returned by the SQL query generated by function getSQL().
    ColumnsDescription getResultColumns() const;

    /// Builds an AST to execute this prometheus query.
    ASTPtr getSQL() const;

private:
    const std::shared_ptr<const PrometheusQueryTree> promql_tree;
    const PrometheusQueryEvaluationSettings settings;
    const ResultType result_type;
};

}
