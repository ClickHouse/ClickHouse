#!/usr/bin/env bash

pushd /data/chbuild
if [ "$1" = "r" ]
then
    read -p "Are you sure? " -n 1 -r
    echo

    rm -rf ./*

    # cmake -DSANITIZER=memory -DUSE_STATIC_LIBRARIES=off -DSPLIT_SHARED_LIBRARIES=on -DENABLE_BROTLI=0 -DENABLE_POCO_MONGODB=0 -DENABLE_REDIS=0 -DENABLE_CLICKHOUSE_EXTRACT_FROM_CONFIG=0 -DENABLE_PARQUET=0 -DENABLE_ORC=0 -DENABLE_SSL=0 -DENABLE_CRYPTO=0 -DPOCO_SKIP_OPENSSL_FIND=1 -DENABLE_PROTOBUF=0 -DENABLE_GPERF=0 -DENABLE_BASE64=0 -DENABLE_HYPERSCAN=0 -DENABLE_RAPIDJSON=0 -DENABLE_HDFS=0 -DENABLE_CAPNP=0 -DENABLE_RDKAFKA=0 -DENABLE_MYSQL=0 -DENABLE_CLICKHOUSE_OBFUSCATOR=0 -DENABLE_CLICKHOUSE_ODBC_BRIDGE=0 -DENABLE_POCO_ODBC=0 -DENABLE_ODBC=0 -DUSE_EMBEDDED_COMPILER=0 -DENABLE_UTILS=0 -DARCH_NATIVE=1 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=0 /home/amos/git/chorigin

    # cmake -DUSE_STATIC_LIBRARIES=0 -DSPLIT_SHARED_LIBRARIES=1 -DCLICKHOUSE_SPLIT_BINARY=1 -DENABLE_TESTS=0 -DENABLE_UTILS=0 /home/amos/git/chorigin

    cmake -DENABLE_PARQUET=0 /home/amos/git/chorigin

    # cmake -GNinja  -DUSE_STATIC_LIBRARIES=off -DSPLIT_SHARED_LIBRARIES=on -DGOLD_PATH=/usr/local/bin -DCMAKE_BUILD_TYPE=Debug -DENABLE_TESTS=OFF  -DCMAKE_EXE_LINKER_FLAGS="-Wl,--gdb-index" ..
    # cmake -GNinja -DGOLD_PATH=/usr/local/bin -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=OFF -DCMAKE_EXE_LINKER_FLAGS="-Wl,--gdb-index" -DCMAKE_CXX_FLAGS_DEBUG="-gsplit-dwarf" ..
    # cmake -GNinja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_UTILS=0 -DUSE_STATIC_LIBRARIES=0 -DENABLE_TESTS=0 -DENABLE_CAPNP=0 -DENABLE_RDKAFKA=0 -DENABLE_EMBEDDED_COMPILER=0 -DUSE_INTERNAL_LLVM_LIBRARY=0 /home/amos/git/chorigin
    # cmake -GNinja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_UTILS=0 -DUSE_STATIC_LIBRARIES=0 -DENABLE_TESTS=0 -DENABLE_CAPNP=0 -DENABLE_RDKAFKA=0 -DENABLE_EMBEDDED_COMPILER=0 -DUSE_INTERNAL_LLVM_LIBRARY=0  -DCMAKE_C_COMPILER=/usr/local/bin/clang -DCMAKE_CXX_COMPILER=/usr/local/bin/clang++ /home/amos/git/chorigin
    # cmake -GNinja -DCMAKE_BUILD_TYPE=Debug  -DENABLE_TESTS=0 -D USE_INTERNAL_UNWIND_LIBRARY=1 -D ENABLE_JEMALLOC=1 -D ENABLE_CAPNP=0 -D ENABLE_UNWIND=0 -D ENABLE_ICU=0 -D ENABLE_POCO_MONGODB=0 -D ENABLE_POCO_ODBC=0 -D ENABLE_ODBC=0 -D ENABLE_MYSQL=0 /home/amos/git/chorigin

    #env CC=/home/amos/gentoo/usr/lib/llvm/8/bin/clang CXX=/home/amos/gentoo/usr/lib/llvm/8/bin/clang++ cmake -GNinja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=0 /home/amos/git/chorigin
    # env CC=/home/amos/gentoo/usr/lib/llvm/8/bin/clang CXX=/home/amos/gentoo/usr/lib/llvm/8/bin/clang++ cmake -GNinja -D CMAKE_BUILD_TYPE=RelWithDebInfo -D SANITIZE=undefined -D USE_INTERNAL_UNWIND_LIBRARY=1 -D ENABLE_JEMALLOC=0 -D ENABLE_CAPNP=0 -D ENABLE_RDKAFKA=0 -D ENABLE_UNWIND=0 -D ENABLE_ICU=0 -D ENABLE_POCO_MONGODB=0 -D ENABLE_POCO_NETSSL=0 -D ENABLE_POCO_ODBC=0 -D ENABLE_ODBC=0 -D ENABLE_MYSQL=0 -D ENABLE_SSL=0 -D ENABLE_POCO_NETSSL=0 /home/amos/git/chorigin
    # env CC=/home/amos/gentoo/usr/lib/llvm/8/bin/clang CXX=/home/amos/gentoo/usr/lib/llvm/8/bin/clang++ cmake -GNinja -DSANITIZE=undefined -DENABLE_EMBEDDED_COMPILER=1 -DENABLE_TESTS=0 -DENABLE_UTILS=0 /home/amos/git/chorigin
	# cmake -GNinja -DUSE_EMBEDDED_COMPILER=0 -DGLIBC_COMPATIBILITY=1 -DUSE_STATIC_LIBRARIES=0 -DENABLE_UTILS=0 -DSPLIT_SHARED_LIBRARIES=1 -DARCH_NATIVE=1 -DENABLE_VECTORCLASS=1 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=0 /home/amos/git/chorigin
    # cmake -GNinja -DUSE_EMBEDDED_COMPILER=0 -DUSE_STATIC_LIBRARIES=0 -DENABLE_UTILS=0 -DSPLIT_SHARED_LIBRARIES=1 -DARCH_NATIVE=1 -DENABLE_VECTORCLASS=1 -DENABLE_POCO_NETSSL=0 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=0 /home/amos/git/chorigin

    ninja
else
    ninja
fi
popd
