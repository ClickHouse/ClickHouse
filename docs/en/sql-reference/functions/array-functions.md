---
description: 'Documentation for Array Functions'
sidebar_label: 'Arrays'
slug: /sql-reference/functions/array-functions
title: 'Array Functions'
---

# Array functions

<!-- 
The inner content of the tags below are replaced at doc framework build time with 
docs generated from system.functions. Please do not modify or remove the tags.
See: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->

<!--AUTOGENERATED_START-->
## array {#array}

Introduced in: v1.1

Creates an array from the function arguments.

The arguments should be constants and have types that share a common supertype.
At least one argument must be passed, because otherwise it isn't clear which type of array to create.
This means that you can't use this function to create an empty array. To do so, use the `emptyArray*` function.

Use the `[ ]` operator for the same functionality.

**Syntax**

```sql
array(x1 [, x2, ..., xN])
```

**Arguments**

- `x1` — Constant value of any type T. If only this argument is provided, the array will be of type T. - `[, x2, ..., xN]` — Additional N constant values sharing a common supertype with `x1`

**Returned value**

Returns an array, where 'T' is the smallest common type out of the passed arguments. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Valid usage**

```sql title=Query
SELECT array(toInt32(1), toUInt16(2), toInt8(3)) AS a, toTypeName(a)
```

```response title=Response
┌─a───────┬─toTypeName(a)─┐
│ [1,2,3] │ Array(Int32)  │
└─────────┴───────────────┘
```

**Invalid usage**

```sql title=Query
SELECT array(toInt32(5), toDateTime('1998-06-16'), toInt8(5)) AS a, toTypeName(a)
```

```response title=Response
Received exception from server (version 25.4.3):
Code: 386. DB::Exception: Received from localhost:9000. DB::Exception:
There is no supertype for types Int32, DateTime, Int8 ...
```

## arrayAUCPR {#arrayAUCPR}

Introduced in: v20.4

Calculates the area under the precision-recall (PR) curve.
A precision-recall curve is created by plotting precision on the y-axis and recall on the x-axis across all thresholds.
The resulting value ranges from 0 to 1, with a higher value indicating better model performance.
The PR AUC is particularly useful for imbalanced datasets, providing a clearer comparison of performance compared to ROC AUC on those cases.
For more details, please see [here](https://developers.google.com/machine-learning/glossary#pr-auc-area-under-the-pr-curve), [here](https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc#expandable-1) and [here](https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Area_under_the_curve).

**Syntax**

```sql
arrayAUCPR(scores, labels[, partial_offsets])
```

**Arguments**

- `cores` — Scores prediction model gives. [`Array((U)Int*)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `labels` — Labels of samples, usually 1 for positive sample and 0 for negative sample. [`Array((U)Int*)`](/sql-reference/data-types/array) or [`Array(Enum)`](/sql-reference/data-types/array)
- `partial_offsets` —
- Optional. An [`Array(T)`](/sql-reference/data-types/array) of three non-negative integers for calculating a partial area under the PR curve (equivalent to a vertical band of the PR space) instead of the whole AUC. This option is useful for distributed computation of the PR AUC. The array must contain the following elements [`higher_partitions_tp`, `higher_partitions_fp`, `total_positives`].
- `higher_partitions_tp`: The number of positive labels in the higher-scored partitions.
- `higher_partitions_fp`: The number of negative labels in the higher-scored partitions.
- `total_positives`: The total number of positive samples in the entire dataset.

::::note
When `arr_partial_offsets` is used, the `arr_scores` and `arr_labels` should be only a partition of the entire dataset, containing an interval of scores.
The dataset should be divided into contiguous partitions, where each partition contains the subset of the data whose scores fall within a specific range.
For example:

- One partition could contain all scores in the range [0, 0.5).
- Another partition could contain scores in the range [0.5, 1.0].

::::

**Returned value**

Returns area under the precision-recall (PR) curve. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayAUCPR([0.1, 0.4, 0.35, 0.8], [0, 0, 1, 1]);
```

```response title=Response
┌─arrayAUCPR([0.1, 0.4, 0.35, 0.8], [0, 0, 1, 1])─┐
│                              0.8333333333333333 │
└─────────────────────────────────────────────────┘
```

## arrayAll {#arrayAll}

Introduced in: v1.1

Returns `1` if lambda `func(x [, y1, y2, ... yN])` returns true for all elements. Otherwise, it returns `0`.

**Syntax**

```sql
arrayAll(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `cond1_arr, ...` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns `1` if the lambda function returns true for all elements, `0` otherwise [`UInt8`](/sql-reference/data-types/int-uint)

**Examples**

**All elements match**

```sql title=Query
SELECT arrayAll(x, y -> x=y, [1, 2, 3], [1, 2, 3])
```

```response title=Response
1
```

**Not all elements match**

```sql title=Query
SELECT arrayAll(x, y -> x=y, [1, 2, 3], [1, 1, 1])
```

```response title=Response
0
```

## arrayAvg {#arrayAvg}

Introduced in: v21.1

Returns the average of elements in the source array.

If a lambda function `func` is specified, returns the average of elements of the lambda results.

**Syntax**

```sql
arrayAvg([func(x[, y1, ..., yN])], source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — Optional. A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the average of elements in the source array, or the average of elements of the lambda results if provided. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Basic example**

```sql title=Query
SELECT arrayAvg([1, 2, 3, 4]);
```

```response title=Response
2.5
```

**Usage with lambda function**

```sql title=Query
SELECT arrayAvg(x, y -> x*y, [2, 3], [2, 3]) AS res;
```

```response title=Response
6.5
```

## arrayCompact {#arrayCompact}

Introduced in: v20.1

Removes consecutive duplicate elements from an array, including `null` values. The order of values in the resulting array is determined by the order in the source array.

**Syntax**

```sql
arrayCompact(arr)
```

**Arguments**

- `arr` — An array to remove duplicates from. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array without duplicate values [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayCompact([1, 1, nan, nan, 2, 3, 3, 3]);
```

```response title=Response
[1,nan,2,3]
```

## arrayConcat {#arrayConcat}

Introduced in: v1.1

Combines arrays passed as arguments.

**Syntax**

```sql
arrayConcat(arr1 [, arr2, ... , arrN])
```

**Arguments**

- `arr1 [, arr2, ... , arrN]` — N number of arrays to concatenate. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns a single combined array from the provided array arguments. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayConcat([1, 2], [3, 4], [5, 6]) AS res
```

```response title=Response
[1, 2, 3, 4, 5, 6]
```

## arrayCount {#arrayCount}

Introduced in: v1.1

Returns the number of elements for which `func(arr1[i], ..., arrN[i])` returns true.
If `func` is not specified, it returns the number of non-zero elements in the array.

`arrayCount` is a [higher-order function](/sql-reference/functions/overview#higher-order-functions).

**Syntax**

```sql
arrayCount([func, ] arr1, ...)
```

**Arguments**

- `func` — Optional. Function to apply to each element of the array(s). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr1, ..., arrN` — N arrays. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the number of elements for which `func` returns true. Otherwise, returns the number of non-zero elements in the array. [`UInt32`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayCount(x -> (x % 2), groupArray(number)) FROM numbers(10)
```

```response title=Response
5
```

## arrayCumSum {#arrayCumSum}

Introduced in: v1.1

Returns an array of the partial (running) sums of the elements in the source array. If a lambda function is specified, the sum is computed from applying the lambda to the array elements at each position.

**Syntax**

```sql
arrayCumSum([func,] arr1[, arr2, ... , arrN])
```

**Arguments**

- `func` — Optional. A lambda function to apply to the array elements at each position. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr1` — The source array of numeric values. [`Array(T)`](/sql-reference/data-types/array)
- `[arr2, ..., arrN]` — Optional. Additional arrays of the same size, passed as arguments to the lambda function if specified. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array of the partial sums of the elements in the source array. The result type matches the input array's numeric type. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Basic usage**

```sql title=Query
SELECT arrayCumSum([1, 1, 1, 1]) AS res
```

```response title=Response
[1, 2, 3, 4]
```

**With lambda**

```sql title=Query
SELECT arrayCumSum(x -> x * 2, [1, 2, 3]) AS res
```

```response title=Response
[2, 6, 12]
```

## arrayCumSumNonNegative {#arrayCumSumNonNegative}

Introduced in: v18.12

Returns an array of the partial (running) sums of the elements in the source array, replacing any negative running sum with zero. If a lambda function is specified, the sum is computed from applying the lambda to the array elements at each position.

**Syntax**

```sql
arrayCumSumNonNegative([func,] arr1[, arr2, ... , arrN])
```

**Arguments**

- `func` — Optional. A lambda function to apply to the array elements at each position. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr1` — The source array of numeric values. [`Array(T)`](/sql-reference/data-types/array)
- `[arr2, ..., arrN]` — Optional. Additional arrays of the same size, passed as arguments to the lambda function if specified. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array of the partial sums of the elements in the source array, with any negative running sum replaced by zero. The result type matches the input array's numeric type. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Basic usage**

```sql title=Query
SELECT arrayCumSumNonNegative([1, 1, -4, 1]) AS res
```

```response title=Response
[1, 2, 0, 1]
```

**With lambda**

```sql title=Query
SELECT arrayCumSumNonNegative(x -> x * 2, [1, -2, 3]) AS res
```

```response title=Response
[2, 0, 6]
```

## arrayDifference {#arrayDifference}

Introduced in: v1.1

Calculates an array of differences between adjacent array elements.
The first element of the result array will be 0, the second `arr[1] - arr[0]`, the third `arr[2] - arr[1]`, etc.
The type of elements in the result array are determined by the type inference rules for subtraction (e.g. `UInt8` - `UInt8` = `Int16`).

**Syntax**

```sql
arrayDifference(arr)
```

**Arguments**

- `arr` — Array for which to calculate differences between adjacent elements. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array of differences between adjacent array elements [`UInt*`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayDifference([1, 2, 3, 4]);
```

```response title=Response
[0,1,1,1]
```

**Example of overflow due to result type Int64**

```sql title=Query
SELECT arrayDifference([0, 10000000000000000000]);
```

```response title=Response
┌─arrayDifference([0, 10000000000000000000])─┐
│ [0,-8446744073709551616]                   │
└────────────────────────────────────────────┘
```

## arrayDistinct {#arrayDistinct}

Introduced in: v1.1

Returns an array containing only the distinct elements of an array.

**Syntax**

```sql
arrayDistinct(arr)
```

**Arguments**

- `arr` — Array for which to extract distinct elements. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array containing the distinct elements [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayDistinct([1, 2, 2, 3, 1]);
```

```response title=Response
[1,2,3]
```

## arrayDotProduct {#arrayDotProduct}

Introduced in: v23.5

Returns the dot product of two arrays.

:::note
The sizes of the two vectors must be equal. Arrays and Tuples may also contain mixed element types.
:::

**Syntax**

```sql
arrayDotProduct(v1, v2)
```

**Arguments**

- `v1` — First vector. [`Array((U)Int* | Float* | Decimal)`](/sql-reference/data-types/array) or [`Tuple((U)Int* | Float* | Decimal)`](/sql-reference/data-types/tuple)
- `v2` — Second vector. [`Array((U)Int* | Float* | Decimal)`](/sql-reference/data-types/array) or [`Tuple((U)Int* | Float* | Decimal)`](/sql-reference/data-types/tuple)

**Returned value**

The dot product of the two vectors.

:::note
The return type is determined by the type of the arguments. If Arrays or Tuples contain mixed element types then the result type is the supertype.
:::

 [`(U)Int*`](/sql-reference/data-types/int-uint) or [`Float*`](/sql-reference/data-types/float) or [`Decimal`](/sql-reference/data-types/decimal)

**Examples**

**Array example**

```sql title=Query
SELECT arrayDotProduct([1, 2, 3], [4, 5, 6]) AS res, toTypeName(res);
```

```response title=Response
32    UInt16
```

**Tuple example**

```sql title=Query
SELECT dotProduct((1::UInt16, 2::UInt8, 3::Float32),(4::Int16, 5::Float32, 6::UInt8)) AS res, toTypeName(res);
```

```response title=Response
32    Float64
```

## arrayElement {#arrayElement}

Introduced in: v1.1

Gets the element of the provided array with index `n` where `n` can be any integer type.
If the index falls outside of the bounds of an array, it returns a default value (0 for numbers, an empty string for strings, etc.),
except for arguments of a non-constant array and a constant index 0. In this case there will be an error `Array indices are 1-based`.

:::note
Arrays in ClickHouse are one-indexed.
:::

Negative indexes are supported. In this case, the corresponding element is selected, numbered from the end. For example, `arr[-1]` is the last item in the array.

Operator `[n]` provides the same functionality.

**Syntax**

```sql
arrayElement(arr, n)
```

**Arguments**

- `arr` — The array to search. [`Array(T)`](/sql-reference/data-types/array). - `n` — Position of the element to get. [`(U)Int*`](/sql-reference/data-types/int-uint).

**Returned value**

Returns a single combined array from the provided array arguments [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayElement(arr, 2) FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
2
```

**Negative indexing**

```sql title=Query
SELECT arrayElement(arr, -1) FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
3
```

**Using [n] notation**

```sql title=Query
SELECT arr[2] FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
2
```

**Index out of array bounds**

```sql title=Query
SELECT arrayElement(arr, 4) FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
0
```

## arrayElementOrNull {#arrayElementOrNull}

Introduced in: v1.1

Gets the element of the provided array with index `n` where `n` can be any integer type.
If the index falls outside of the bounds of an array, `NULL` is returned instead of a default value.

:::note
Arrays in ClickHouse are one-indexed.
:::

Negative indexes are supported. In this case, it selects the corresponding element numbered from the end. For example, `arr[-1]` is the last item in the array.

**Syntax**

```sql
arrayElementOrNull(arrays)
```

**Arguments**

- `arrays` — Arbitrary number of array arguments. [`Array`](/sql-reference/data-types/array)

**Returned value**

Returns a single combined array from the provided array arguments. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayElementOrNull(arr, 2) FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
2
```

**Negative indexing**

```sql title=Query
SELECT arrayElementOrNull(arr, -1) FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
3
```

**Index out of array bounds**

```sql title=Query
SELECT arrayElementOrNull(arr, 4) FROM (SELECT [1, 2, 3] AS arr)
```

```response title=Response
NULL
```

## arrayEnumerate {#arrayEnumerate}

Introduced in: v1.1

Returns the array `[1, 2, 3, ..., length (arr)]`

This function is normally used with the [`ARRAY JOIN`](/sql-reference/statements/select/array-join) clause. It allows counting something just
once for each array after applying `ARRAY JOIN`.
This function can also be used in higher-order functions. For example, you can use it to get array indexes for elements that match a condition.

**Syntax**

```sql
arrayEnumerate(arr)
```

**Arguments**

- `arr` — The array to enumerate. [`Array`](/sql-reference/data-types/array)

**Returned value**

Returns the array `[1, 2, 3, ..., length (arr)]`. [`Array(UInt32)`](/sql-reference/data-types/array)

**Examples**

**Basic example with ARRAY JOIN**

```sql title=Query
CREATE TABLE test
(
    `id` UInt8,
    `tag` Array(String),
    `version` Array(String)
)
ENGINE = MergeTree
ORDER BY id;

INSERT INTO test VALUES (1, ['release-stable', 'dev', 'security'], ['2.4.0', '2.6.0-alpha', '2.4.0-sec1']);

SELECT
    id,
    tag,
    version,
    seq
FROM test
ARRAY JOIN
    tag,
    version,
    arrayEnumerate(tag) AS seq
```

```response title=Response
┌─id─┬─tag────────────┬─version─────┬─seq─┐
│  1 │ release-stable │ 2.4.0       │   1 │
│  1 │ dev            │ 2.6.0-alpha │   2 │
│  1 │ security       │ 2.4.0-sec1  │   3 │
└────┴────────────────┴─────────────┴─────┘
```

## arrayEnumerateDense {#arrayEnumerateDense}

Introduced in: v18.12

Returns an array of the same size as the source array, indicating where each element first appears in the source array.

**Syntax**

```sql
arrayEnumerateDense(arr)
```

**Arguments**

- `arr` — The array to enumerate. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array of the same size as `arr`, indicating where each element first appears in the source array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayEnumerateDense([10, 20, 10, 30])
```

```response title=Response
[1,2,1,3]
```

## arrayEnumerateDenseRanked {#arrayEnumerateDenseRanked}

Introduced in: v20.1

Returns an array the same size as the source array, indicating where each element first appears in the source array. It allows for enumeration of a multidimensional array with the ability to specify how deep to look inside the array.

**Syntax**

```sql
arrayEnumerateDenseRanked(clear_depth, arr, max_array_depth)
```

**Arguments**

- `clear_depth` — Enumerate elements at the specified level separately. Must be less than or equal to `max_arr_depth`. [`UInt*`](/sql-reference/data-types/int-uint)
- `arr` — N-dimensional array to enumerate. [`Array(T)`](/sql-reference/data-types/array)
- `max_array_depth` — The maximum effective depth. Must be less than or equal to the depth of `arr`. [`UInt*`](/sql-reference/data-types/int-uint)

**Returned value**

Returns an array denoting where each element first appears in the source array [`Array`](/sql-reference/data-types/array)

**Examples**

**Basic usage**

```sql title=Query
- - With clear_depth=1 and max_array_depth=1, the result is identical to what arrayEnumerateDense would give.

SELECT arrayEnumerateDenseRanked(1,[10, 20, 10, 30],1);
```

```response title=Response
[1,2,1,3]
```

**Usage with a multidimensional array**

```sql title=Query
- - In this example, arrayEnumerateDenseRanked is used to obtain an array indicating, for each element of the
- - multidimensional array, what its position is among elements of the same value.
- - For the first row of the passed array, [10, 10, 30, 20], the corresponding first row of the result is [1, 1, 2, 3],
- - indicating that 10 is the first number encountered in position 1 and 2, 30 the second number encountered in position 3
- - and 20 is the third number encountered in position 4.
- - For the second row, [40, 50, 10, 30], the corresponding second row of the result is [4,5,1,2], indicating that 40
- - and 50 are the fourth and fifth numbers encountered in position 1 and 2 of that row, that another 10
- - (the first encountered number) is in position 3 and 30 (the second number encountered) is in the last position.

SELECT arrayEnumerateDenseRanked(1,[[10,10,30,20],[40,50,10,30]],2);
```

```response title=Response
[[1,1,2,3],[4,5,1,2]]
```

**Example with increased clear_depth**

```sql title=Query
- - Changing clear_depth=2 results in the enumeration occurring separately for each row anew.

SELECT arrayEnumerateDenseRanked(2,[[10,10,30,20],[40,50,10,30]],2);
```

```response title=Response
[[1, 1, 2, 3], [1, 2, 3, 4]]
```

## arrayEnumerateUniq {#arrayEnumerateUniq}

Introduced in: v1.1

Returns an array the same size as the source array, indicating for each element what its position is among elements with the same value.

This function is useful when using `ARRAY JOIN` and aggregation of array elements.

The function can take multiple arrays of the same size as arguments. In this case, uniqueness is considered for tuples of elements in the same positions in all the arrays.

**Syntax**

```sql
arrayEnumerateUniq(arr1[, arr2, ... , arrN])
```

**Arguments**

- `arr1` — First array to process. [`Array(T)`](/sql-reference/data-types/array)
- `arr2, ...` — Optional. Additional arrays of the same size for tuple uniqueness. [`Array(UInt32)`](/sql-reference/data-types/array)

**Returned value**

Returns an array where each element is the position among elements with the same value or tuple. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Basic usage**

```sql title=Query
SELECT arrayEnumerateUniq([10, 20, 10, 30]);
```

```response title=Response
[1, 1, 2, 1]
```

**Multiple arrays**

```sql title=Query
SELECT arrayEnumerateUniq([1, 1, 1, 2, 2, 2], [1, 1, 2, 1, 1, 2]);
```

```response title=Response
[1,2,1,1,2,1]
```

**ARRAY JOIN aggregation**

```sql title=Query
- - Each goal ID has a calculation of the number of conversions (each element in the Goals nested data structure is a goal that was reached, which we refer to as a conversion)
- - and the number of sessions. Without ARRAY JOIN, we would have counted the number of sessions as sum(Sign). But in this particular case,
- - the rows were multiplied by the nested Goals structure, so in order to count each session one time after this, we apply a condition to the
- - value of the arrayEnumerateUniq(Goals.ID) function.

SELECT
    Goals.ID AS GoalID,
    sum(Sign) AS Reaches,
    sumIf(Sign, num = 1) AS Visits
FROM test.visits
ARRAY JOIN
    Goals,
    arrayEnumerateUniq(Goals.ID) AS num
WHERE CounterID = 160656
GROUP BY GoalID
ORDER BY Reaches DESC
LIMIT 10
```

```response title=Response
┌──GoalID─┬─Reaches─┬─Visits─┐
│   53225 │    3214 │   1097 │
│ 2825062 │    3188 │   1097 │
│   56600 │    2803 │    488 │
│ 1989037 │    2401 │    365 │
│ 2830064 │    2396 │    910 │
│ 1113562 │    2372 │    373 │
│ 3270895 │    2262 │    812 │
│ 1084657 │    2262 │    345 │
│   56599 │    2260 │    799 │
│ 3271094 │    2256 │    812 │
└─────────┴─────────┴────────┘
```

## arrayEnumerateUniqRanked {#arrayEnumerateUniqRanked}

Introduced in: v20.1

Returns an array (or multi-dimensional array) with the same dimensions as the source array,
indicating for each element what it's position is among elements with the same value.
It allows for enumeration of a multi-dimensional array with the ability to specify how deep to look inside the array.

**Syntax**

```sql
arrayEnumerateUniqRanked(clear_depth, arr, max_array_depth)
```

**Arguments**

- `clear_depth` — Enumerate elements at the specified level separately. Positive integer less than or equal to `max_arr_depth`. [`UInt*`](/sql-reference/data-types/int-uint)
- `arr` — N-dimensional array to enumerate. [`Array(T)`](/sql-reference/data-types/array)
- `max_array_depth` — The maximum effective depth. Positive integer less than or equal to the depth of `arr`. [`UInt*`](/sql-reference/data-types/int-uint)

**Returned value**

Returns an N-dimensional array the same size as `arr` with each element showing the position of that element in relation to other elements of the same value. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Example 1**

```sql title=Query
- - With clear_depth=1 and max_array_depth=1, the result of arrayEnumerateUniqRanked
- - is identical to that which arrayEnumerateUniq would give for the same array.

SELECT arrayEnumerateUniqRanked(1, [1, 2, 1], 1);
```

```response title=Response
[1, 1, 2]
```

**Example 2**

```sql title=Query
- - with clear_depth=1 and max_array_depth=1, the result of arrayEnumerateUniqRanked
- - is identical to that which arrayEnumerateUniqwould give for the same array.

SELECT arrayEnumerateUniqRanked(1, [[1, 2, 3], [2, 2, 1], [3]], 2);", "[[1, 1, 1], [2, 3, 2], [2]]
```

```response title=Response
[1, 1, 2]
```

**Example 3**

```sql title=Query
- - In this example, arrayEnumerateUniqRanked is used to obtain an array indicating,
- - for each element of the multidimensional array, what its position is among elements
- - of the same value. For the first row of the passed array, [1, 2, 3], the corresponding
- - result is [1, 1, 1], indicating that this is the first time 1, 2 and 3 are encountered.
- - For the second row of the provided array, [2, 2, 1], the corresponding result is [2, 3, 3],
- - indicating that 2 is encountered for a second and third time, and 1 is encountered
- - for the second time. Likewise, for the third row of the provided array [3] the
- - corresponding result is [2] indicating that 3 is encountered for the second time.

SELECT arrayEnumerateUniqRanked(1, [[1, 2, 3], [2, 2, 1], [3]], 2);
```

```response title=Response
[[1, 1, 1], [2, 3, 2], [2]]
```

**Example 4**

```sql title=Query
- - Changing clear_depth=2, results in elements being enumerated separately for each row.
SELECT arrayEnumerateUniqRanked(2,[[1, 2, 3],[2, 2, 1],[3]], 2);
```

```response title=Response
[[1, 1, 1], [1, 2, 1], [1]]
```

## arrayExists {#arrayExists}

Introduced in: v1.1

Returns `1` if there is at least one element in a source array for which `func(x[, y1, y2, ... yN])` returns true. Otherwise, it returns `0`.

**Syntax**

```sql
arrayExists(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns `1` if the lambda function returns true for at least one element, `0` otherwise [`UInt8`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayExists(x, y -> x=y, [1, 2, 3], [0, 0, 0])
```

```response title=Response
0
```

## arrayFill {#arrayFill}

Introduced in: v20.1

The `arrayFill` function sequentially processes a source array from the first element
to the last, evaluating a lambda condition at each position using elements from
the source and condition arrays. When the lambda function evaluates to false at
position i, the function replaces that element with the element at position i-1
from the current state of the array. The first element is always preserved
regardless of any condition.

**Syntax**

```sql
arrayFill(func(x [, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x [, y1, ..., yN])` — A lambda function `func(x [, y1, y2, ... yN]) → F(x [, y1, y2, ... yN])` which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Example with single array**

```sql title=Query
SELECT arrayFill(x -> not isNull(x), [1, null, 2, null]) AS res
```

```response title=Response
[1, 1, 2, 2]
```

**Example with two arrays**

```sql title=Query
SELECT arrayFill(x, y, z -> x > y AND x < z, [5, 3, 6, 2], [4, 7, 1, 3], [10, 2, 8, 5]) AS res
```

```response title=Response
[5, 5, 6, 6]
```

## arrayFilter {#arrayFilter}

Introduced in: v1.1

Returns an array containing only the elements in the source array for which a lambda function returns true.

**Syntax**

```sql
arrayFilter(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])]
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns a subset of the source array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Example 1**

```sql title=Query
SELECT arrayFilter(x -> x LIKE '%World%', ['Hello', 'abc World']) AS res
```

```response title=Response
['abc World']
```

**Example 2**

```sql title=Query
SELECT
    arrayFilter(
        (i, x) -> x LIKE '%World%',
        arrayEnumerate(arr),
        ['Hello', 'abc World'] AS arr)
    AS res
```

```response title=Response
[2]
```

## arrayFirst {#arrayFirst}

Introduced in: v1.1

Returns the first element in the source array for which `func(x[, y1, y2, ... yN])` returns true, otherwise it returns a default value.

**Syntax**

```sql
arrayFirst(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [Lambda function](/sql-reference/functions/overview#arrow-operator-and-lambda). - `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array). - `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns the first element of the source array for which `λ` is true, otherwise returns the default value of `T`.

**Examples**

**Usage example**

```sql title=Query
SELECT arrayFirst(x, y -> x=y, ['a', 'b', 'c'], ['c', 'b', 'a'])
```

```response title=Response
b
```

**No match**

```sql title=Query
SELECT arrayFirst(x, y -> x=y, [0, 1, 2], [3, 3, 3]) AS res, toTypeName(res)
```

```response title=Response
0 UInt8
```

## arrayFirstIndex {#arrayFirstIndex}

Introduced in: v1.1

Returns the index of the first element in the source array for which `func(x[, y1, y2, ... yN])` returns true, otherwise it returns '0'.

**Syntax**

```sql
arrayFirstIndex(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [Lambda function](/sql-reference/functions/overview#arrow-operator-and-lambda). - `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array). - `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns the index of the first element of the source array for which `func` is true, otherwise returns `0` [`UInt32`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayFirstIndex(x, y -> x=y, ['a', 'b', 'c'], ['c', 'b', 'a'])
```

```response title=Response
2
```

**No match**

```sql title=Query
SELECT arrayFirstIndex(x, y -> x=y, ['a', 'b', 'c'], ['d', 'e', 'f'])
```

```response title=Response
0
```

## arrayFirstOrNull {#arrayFirstOrNull}

Introduced in: v1.1

Returns the first element in the source array for which `func(x[, y1, y2, ... yN])` returns true, otherwise it returns `NULL`.

**Syntax**

```sql
arrayFirstOrNull(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the first element of the source array for which `func` is true, otherwise returns `NULL`.

**Examples**

**Usage example**

```sql title=Query
SELECT arrayFirstOrNull(x, y -> x=y, ['a', 'b', 'c'], ['c', 'b', 'a'])
```

```response title=Response
b
```

**No match**

```sql title=Query
SELECT arrayFirstOrNull(x, y -> x=y, [0, 1, 2], [3, 3, 3]) AS res, toTypeName(res)
```

```response title=Response
NULL Nullable(UInt8)
```

## arrayFlatten {#arrayFlatten}

Introduced in: v20.1

Converts an array of arrays to a flat array.

Function:

- Applies to any depth of nested arrays.
- Does not change arrays that are already flat.

The flattened array contains all the elements from all source arrays.

**Syntax**

```sql
arrayFlatten(arr)
```

**Arguments**

- `arr` — A multidimensional array. [`Array(Array(T))`](/sql-reference/data-types/array)

**Returned value**

Returns a flattened array from the multidimensional array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayFlatten([[[1]], [[2], [3]]]);
```

```response title=Response
[1, 2, 3]
```

## arrayFold {#arrayFold}

Introduced in: v23.10

Applies a lambda function to one or more equally-sized arrays and collects the result in an accumulator.

**Syntax**

```sql
arrayFold(λ(acc, x1 [, x2, x3, ... xN]), arr1 [, arr2, arr3, ... arrN], acc)
```

**Arguments**

- `λ(x, x1 [, x2, x3, ... xN])` — A lambda function `λ(acc, x1 [, x2, x3, ... xN]) → F(acc, x1 [, x2, x3, ... xN])` where `F` is an operation applied to `acc` and array values from `x` with the result of `acc` re-used. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr1 [, arr2, arr3, ... arrN]` — N arrays over which to operate. [`Array(T)`](/sql-reference/data-types/array)
- `acc` — Accumulator value with the same type as the return type of the Lambda function.

**Returned value**

Returns the final `acc` value.

**Examples**

**Usage example**

```sql title=Query
SELECT arrayFold(acc,x -> acc + x*2, [1, 2, 3, 4], 3::Int64) AS res;
```

```response title=Response
23
```

**Fibonacci sequence**

```sql title=Query
SELECT arrayFold(acc, x -> (acc.2, acc.2 + acc.1),range(number),(1::Int64, 0::Int64)).1 AS fibonacci FROM numbers(1,10);
```

```response title=Response
┌─fibonacci─┐
│         0 │
│         1 │
│         1 │
│         2 │
│         3 │
│         5 │
│         8 │
│        13 │
│        21 │
│        34 │
└───────────┘
```

**Example using multiple arrays**

```sql title=Query
SELECT arrayFold(
(acc, x, y) -> acc + (x * y),
[1, 2, 3, 4],
[10, 20, 30, 40],
0::Int64
) AS res;
```

```response title=Response
300
```

## arrayIntersect {#arrayIntersect}

Introduced in: v1.1

Takes multiple arrays and returns an array with elements which are present in all source arrays. The result contains only unique values.

**Syntax**

```sql
arrayIntersect(arr, arr1, ..., arrN)
```

**Arguments**

- `arrN` — N arrays from which to make the new array. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns an array with distinct elements that are present in all N arrays [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT
arrayIntersect([1, 2], [1, 3], [2, 3]) AS empty_intersection,
arrayIntersect([1, 2], [1, 3], [1, 4]) AS non_empty_intersection
```

```response title=Response
┌─non_empty_intersection─┬─empty_intersection─┐
│ []                     │ [1]                │
└────────────────────────┴────────────────────┘
```

## arrayJaccardIndex {#arrayJaccardIndex}

Introduced in: v23.7

Returns the [Jaccard index](https://en.wikipedia.org/wiki/Jaccard_index) of two arrays.

**Syntax**

```sql
arrayJaccardIndex(arr_x, arr_y)
```

**Arguments**

- `arr_x` — First array. [`Array(T)`](/sql-reference/data-types/array)
- `arr_y` — Second array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the Jaccard index of `arr_x` and `arr_y` [`Float64`](/sql-reference/data-types/float)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayJaccardIndex([1, 2], [2, 3]) AS res
```

```response title=Response
0.3333333333333333
```

## arrayJoin {#arrayJoin}

Introduced in: v1.1

The `arrayJoin` function takes a row that contains an array and unfolds it, generating multiple rows – one for each element in the array.
This is in contrast to Regular Functions in ClickHouse which map input values to output values within the same row,
and Aggregate Functions which take a group of rows and "compress" or "reduce" them into a single summary row
(or a single value within a summary row if used with `GROUP BY`).

All the values in the columns are simply copied, except the values in the column where this function is applied;
these are replaced with the corresponding array value.

**Syntax**

```sql
arrayJoin(arr)
```

**Arguments**

- `arr` — An array to unfold. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns a set of rows unfolded from `arr`.

**Examples**

**Basic usage**

```sql title=Query
SELECT arrayJoin([1, 2, 3] AS src) AS dst, 'Hello', src
```

```response title=Response
┌─dst─┬─\'Hello\'─┬─src─────┐
│   1 │ Hello     │ [1,2,3] │
│   2 │ Hello     │ [1,2,3] │
│   3 │ Hello     │ [1,2,3] │
└─────┴───────────┴─────────┘
```

**arrayJoin affects all sections of the query**

```sql title=Query
- - The arrayJoin function affects all sections of the query, including the WHERE section. Notice the result 2, even though the subquery returned 1 row.

SELECT sum(1) AS impressions
FROM
(
    SELECT ['Istanbul', 'Berlin', 'Bobruisk'] AS cities
)
WHERE arrayJoin(cities) IN ['Istanbul', 'Berlin'];
```

```response title=Response
┌─impressions─┐
│           2 │
└─────────────┘
```

**Using multiple arrayJoin functions**

```sql title=Query
- A query can use multiple arrayJoin functions. In this case, the transformation is performed multiple times and the rows are multiplied.

SELECT
    sum(1) AS impressions,
    arrayJoin(cities) AS city,
    arrayJoin(browsers) AS browser
FROM
(
    SELECT
        ['Istanbul', 'Berlin', 'Bobruisk'] AS cities,
        ['Firefox', 'Chrome', 'Chrome'] AS browsers
)
GROUP BY
    2,
    3
```

```response title=Response
┌─impressions─┬─city─────┬─browser─┐
│           2 │ Istanbul │ Chrome  │
│           1 │ Istanbul │ Firefox │
│           2 │ Berlin   │ Chrome  │
│           1 │ Berlin   │ Firefox │
│           2 │ Bobruisk │ Chrome  │
│           1 │ Bobruisk │ Firefox │
└─────────────┴──────────┴─────────┘
```

**Unexpected results due to optimizations**

```sql title=Query
- - Using multiple arrayJoin with the same expression may not produce the expected result due to optimizations.
- - For these cases, consider modifying the repeated array expression with extra operations that do not affect join result.
- e.g. arrayJoin(arraySort(arr)), arrayJoin(arrayConcat(arr, []))

SELECT
    arrayJoin(dice) as first_throw,
    /* arrayJoin(dice) as second_throw */ -- is technically correct, but will annihilate result set
    arrayJoin(arrayConcat(dice, [])) as second_throw -- intentionally changed expression to force re-evaluation
FROM (
    SELECT [1, 2, 3, 4, 5, 6] as dice
);
```

```response title=Response
┌─first_throw─┬─second_throw─┐
│           1 │            1 │
│           1 │            2 │
│           1 │            3 │
│           1 │            4 │
│           1 │            5 │
│           1 │            6 │
│           2 │            1 │
│           2 │            2 │
│           2 │            3 │
│           2 │            4 │
│           2 │            5 │
│           2 │            6 │
│           3 │            1 │
│           3 │            2 │
│           3 │            3 │
│           3 │            4 │
│           3 │            5 │
│           3 │            6 │
│           4 │            1 │
│           4 │            2 │
│           4 │            3 │
│           4 │            4 │
│           4 │            5 │
│           4 │            6 │
│           5 │            1 │
│           5 │            2 │
│           5 │            3 │
│           5 │            4 │
│           5 │            5 │
│           5 │            6 │
│           6 │            1 │
│           6 │            2 │
│           6 │            3 │
│           6 │            4 │
│           6 │            5 │
│           6 │            6 │
└─────────────┴──────────────┘
```

**Using the ARRAY JOIN syntax**

```sql title=Query
- - Note the ARRAY JOIN syntax in the `SELECT` query below, which provides broader possibilities.
- - ARRAY JOIN allows you to convert multiple arrays with the same number of elements at a time.

SELECT
    sum(1) AS impressions,
    city,
    browser
FROM
(
    SELECT
        ['Istanbul', 'Berlin', 'Bobruisk'] AS cities,
        ['Firefox', 'Chrome', 'Chrome'] AS browsers
)
ARRAY JOIN
    cities AS city,
    browsers AS browser
GROUP BY
    2,
    3
```

```response title=Response
┌─impressions─┬─city─────┬─browser─┐
│           1 │ Istanbul │ Firefox │
│           1 │ Berlin   │ Chrome  │
│           1 │ Bobruisk │ Chrome  │
└─────────────┴──────────┴─────────┘
```

**Using Tuple**

```sql title=Query
- - You can also use Tuple

SELECT
    sum(1) AS impressions,
    (arrayJoin(arrayZip(cities, browsers)) AS t).1 AS city,
    t.2 AS browser
FROM
(
    SELECT
        ['Istanbul', 'Berlin', 'Bobruisk'] AS cities,
        ['Firefox', 'Chrome', 'Chrome'] AS browsers
)
GROUP BY
    2,
    3
```

```response title=Response
┌─impressions─┬─city─────┬─browser─┐
│           1 │ Istanbul │ Firefox │
│           1 │ Berlin   │ Chrome  │
│           1 │ Bobruisk │ Chrome  │
└─────────────┴──────────┴─────────┘
```

## arrayLast {#arrayLast}

Introduced in: v1.1

Returns the last element in the source array for which a lambda `func(x [, y1, y2, ... yN])` returns true, otherwise it returns a default value.

**Syntax**

```sql
arrayLast(func(x[, y1, ..., yN]), source[, cond1, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [Lambda function](/sql-reference/functions/overview#arrow-operator-and-lambda). - `source` — The source array to process. [`Array(T)`](/sql-reference/data-types/array). - `[, cond1, ... , condN]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns the last element of the source array for which `func` is true, otherwise returns the default value of `T`.

**Examples**

**Usage example**

```sql title=Query
SELECT arrayLast(x, y -> x=y, ['a', 'b', 'c'], ['a', 'b', 'c'])
```

```response title=Response
c
```

**No match**

```sql title=Query
SELECT arrayFirst(x, y -> x=y, [0, 1, 2], [3, 3, 3]) AS res, toTypeName(res)
```

```response title=Response
0 UInt8
```

## arrayLastIndex {#arrayLastIndex}

Introduced in: v1.1

Returns the index of the last element in the source array for which `func(x[, y1, y2, ... yN])` returns true, otherwise it returns '0'.

**Syntax**

```sql
arrayLastIndex(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the index of the last element of the source array for which `func` is true, otherwise returns `0` [`UInt32`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayLastIndex(x, y -> x=y, ['a', 'b', 'c'], ['a', 'b', 'c']);
```

```response title=Response
3
```

**No match**

```sql title=Query
SELECT arrayLastIndex(x, y -> x=y, ['a', 'b', 'c'], ['d', 'e', 'f']);
```

```response title=Response
0
```

## arrayLastOrNull {#arrayLastOrNull}

Introduced in: v1.1

Returns the last element in the source array for which a lambda `func(x [, y1, y2, ... yN])` returns true, otherwise it returns `NULL`.

**Syntax**

```sql
arrayLastOrNull(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x [, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [Lambda function](/sql-reference/functions/overview#arrow-operator-and-lambda). - `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array). - `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns the last element of the source array for which `λ` is not true, otherwise returns `NULL`.

**Examples**

**Usage example**

```sql title=Query
SELECT arrayLastOrNull(x, y -> x=y, ['a', 'b', 'c'], ['a', 'b', 'c'])
```

```response title=Response
c
```

**No match**

```sql title=Query
SELECT arrayLastOrNull(x, y -> x=y, [0, 1, 2], [3, 3, 3]) AS res, toTypeName(res)
```

```response title=Response
NULL Nullable(UInt8)
```

## arrayLevenshteinDistance {#arrayLevenshteinDistance}

Introduced in: v25.4

Calculates the Levenshtein distance for two arrays.

**Syntax**

```sql
arrayLevenshteinDistance(from, to)
```

**Arguments**

- `from` — The first array. [`Array(T)`](/sql-reference/data-types/array). - `to` — The second array. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Levenshtein distance between the first and the second arrays. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayLevenshteinDistance([1, 2, 4], [1, 2, 3])
```

```response title=Response
1
```

## arrayLevenshteinDistanceWeighted {#arrayLevenshteinDistanceWeighted}

Introduced in: v25.4

Calculates Levenshtein distance for two arrays with custom weights for each element.
The number of elements for the array and its weights should match.

**Syntax**

```sql
arrayLevenshteinDistanceWeighted(from, to, from_weights, to_weights)
```

**Arguments**

- `from` — first array. [`Array(T)`](/sql-reference/data-types/array). - `to` — second array. [`Array(T)`](/sql-reference/data-types/array). - `from_weights` — weights for the first array. [`Array((U)Int*|Float*)`](/sql-reference/data-types/array)
- `to_weights` — weights for the second array. [`Array((U)Int*|Float*)`](/sql-reference/data-types/array)

**Returned value**

Levenshtein distance between the first and the second arrays with custom weights for each element [`Float64`](/sql-reference/data-types/float)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayLevenshteinDistanceWeighted(['A', 'B', 'C'], ['A', 'K', 'L'], [1.0, 2, 3], [3.0, 4, 5])
```

```response title=Response
14
```

## arrayMap {#arrayMap}

Introduced in: v1.1

Returns an array obtained from the original arrays by applying a lambda function to each element.

**Syntax**

```sql
arrayMap(func, arr)
```

**Arguments**

- `func` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr` — N arrays to process. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array from the lambda results [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayMap(x -> (x + 2), [1, 2, 3]) as res;
```

```response title=Response
[3, 4, 5]
```

**Creating a tuple of elements from different arrays**

```sql title=Query
SELECT arrayMap((x, y) -> (x, y), [1, 2, 3], [4, 5, 6]) AS res
```

```response title=Response
[(1, 4),(2, 5),(3, 6)]
```

## arrayMax {#arrayMax}

Introduced in: v21.1

Returns the maximum element in the source array.

If a lambda function `func` is specified, returns the maximum element of the lambda results.

**Syntax**

```sql
arrayMax([func(x[, y1, ..., yN])], source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — Optional. A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the maximum element in the source array, or the maximum element of the lambda results if provided.

**Examples**

**Basic example**

```sql title=Query
SELECT arrayMax([5, 3, 2, 7]);
```

```response title=Response
7
```

**Usage with lambda function**

```sql title=Query
SELECT arrayMax(x, y -> x/y, [4, 8, 12, 16], [1, 2, 1, 2]);
```

```response title=Response
12
```

## arrayMin {#arrayMin}

Introduced in: v21.1

Returns the minimum element in the source array.

If a lambda function `func` is specified, returns the minimum element of the lambda results.

**Syntax**

```sql
arrayMin([func(x[, y1, ..., yN])], source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — Optional. A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `cond1_arr, ...` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the minimum element in the source array, or the minimum element of the lambda results if provided.

**Examples**

**Basic example**

```sql title=Query
SELECT arrayMin([5, 3, 2, 7]);
```

```response title=Response
2
```

**Usage with lambda function**

```sql title=Query
SELECT arrayMin(x, y -> x/y, [4, 8, 12, 16], [1, 2, 1, 2]);
```

```response title=Response
4
```

## arrayNormalizedGini {#arrayNormalizedGini}

Introduced in: v25.1

Calculates the normalized Gini coefficient.

**Syntax**

```sql
arrayNormalizedGini(predicted, label)
```

**Arguments**

- `predicted` — The predicted value. [`Array(T)`](/sql-reference/data-types/array)
- `label` — The actual value. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

A tuple containing the Gini coefficients of the predicted values, the Gini coefficient of the normalized values, and the normalized Gini coefficient (= the ratio of the former two Gini coefficients) [`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayNormalizedGini([0.9, 0.3, 0.8, 0.7],[6, 1, 0, 2]);
```

```response title=Response
(0.18055555555555558, 0.2638888888888889, 0.6842105263157896)
```

## arrayPartialReverseSort {#arrayPartialReverseSort}

Introduced in: v23.2

This function is the same as `arrayReverseSort` but with an additional `limit` argument allowing partial sorting.

:::tip
To retain only the sorted elements use `arrayResize`.
:::

**Syntax**

```sql
arrayPartialReverseSort([f,] arr [, arr1, ... ,arrN], limit)
```

**Arguments**

- `f(arr[, arr1, ... ,arrN])` — The lambda function to apply to elements of array `x`. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr` — Array to be sorted. [`Array(T)`](/sql-reference/data-types/array)
- `arr1, ... ,arrN` — N additional arrays, in the case when `f` accepts multiple arguments. [`Array(T)`](/sql-reference/data-types/array)
- `limit` — Index value up until which sorting will occur. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

Returns an array of the same size as the original array where elements in the range `[1..limit]` are sorted
in descending order. The remaining elements `(limit..N]` are in an unspecified order.

**Examples**

**simple_int**

```sql title=Query
SELECT arrayPartialReverseSort(2, [5, 9, 1, 3])
```

```response title=Response
[9, 5, 1, 3]
```

**simple_string**

```sql title=Query
SELECT arrayPartialReverseSort(2, ['expenses','lasso','embolism','gladly'])
```

```response title=Response
['lasso','gladly','expenses','embolism']
```

**retain_sorted**

```sql title=Query
SELECT arrayResize(arrayPartialReverseSort(2, [5, 9, 1, 3]), 2)
```

```response title=Response
[9, 5]
```

**lambda_simple**

```sql title=Query
SELECT arrayPartialReverseSort((x) -> -x, 2, [5, 9, 1, 3])
```

```response title=Response
[1, 3, 5, 9]
```

**lambda_complex**

```sql title=Query
SELECT arrayPartialReverseSort((x, y) -> -y, 1, [0, 1, 2], [1, 2, 3]) as res
```

```response title=Response
[0, 1, 2]
```

## arrayPartialShuffle {#arrayPartialShuffle}

Introduced in: v23.2

Returns an array of the same size as the original array where elements in range `[1..limit]` are a random
subset of the original array. Remaining `(limit..n]` shall contain the elements not in `[1..limit]` range in undefined order.
Value of limit shall be in range `[1..n]`. Values outside of that range are equivalent to performing full `arrayShuffle`:

:::note
This function will not materialize constants.

The value of `limit` should be in the range `[1..N]`. Values outside of that range are equivalent to performing full [`arrayShuffle`](#arrayShuffle).
:::

**Syntax**

```sql
arrayPartialShuffle(arr [, limit[, seed]])
```

**Arguments**

- `arr` — The array to shuffle. [`Array(T)`](/sql-reference/data-types/array)
- `seed` — Optional. The seed to be used with random number generation. If not provided, a random one is used. [`(U)Int*`](/sql-reference/data-types/int-uint)
- `limit` — Optional. The number to limit element swaps to, in the range `[1..N]`. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

Array with elements partially shuffled. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**no_limit1**

```sql title=Query
SELECT arrayPartialShuffle([1, 2, 3, 4], 0)
```

```response title=Response
[2, 4, 3, 1]
```

**no_limit2**

```sql title=Query
SELECT arrayPartialShuffle([1, 2, 3, 4])
```

```response title=Response
[4, 1, 3, 2]
```

**random_seed**

```sql title=Query
SELECT arrayPartialShuffle([1, 2, 3, 4], 2)
```

```response title=Response
[3, 4, 1, 2]
```

**explicit_seed**

```sql title=Query
SELECT arrayPartialShuffle([1, 2, 3, 4], 2, 41)
```

```response title=Response
[3, 2, 1, 4]
```

**materialize**

```sql title=Query
SELECT arrayPartialShuffle(materialize([1, 2, 3, 4]), 2, 42), arrayPartialShuffle([1, 2, 3], 2, 42) FROM numbers(10)
```

```response title=Response
┌─arrayPartial⋯4]), 2, 42)─┬─arrayPartial⋯ 3], 2, 42)─┐
│ [3,2,1,4]                │ [3,2,1]                  │
│ [3,2,1,4]                │ [3,2,1]                  │
│ [4,3,2,1]                │ [3,2,1]                  │
│ [1,4,3,2]                │ [3,2,1]                  │
│ [3,4,1,2]                │ [3,2,1]                  │
│ [1,2,3,4]                │ [3,2,1]                  │
│ [1,4,3,2]                │ [3,2,1]                  │
│ [1,4,3,2]                │ [3,2,1]                  │
│ [3,1,2,4]                │ [3,2,1]                  │
│ [1,3,2,4]                │ [3,2,1]                  │
└──────────────────────────┴──────────────────────────┘
```

## arrayPartialSort {#arrayPartialSort}

Introduced in: v23.2

This function is the same as `arraySort` but with an additional `limit` argument allowing partial sorting.

:::tip
To retain only the sorted elements use `arrayResize`.
:::

**Syntax**

```sql
arrayPartialSort([f,] arr [, arr1, ... ,arrN], limit)
```

**Arguments**

- `f(arr[, arr1, ... ,arrN])` — The lambda function to apply to elements of array `x`. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `arr` — Array to be sorted. [`Array(T)`](/sql-reference/data-types/array)
- `arr1, ... ,arrN` — N additional arrays, in the case when `f` accepts multiple arguments. [`Array(T)`](/sql-reference/data-types/array)
- `limit` — Index value up until which sorting will occur. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

Returns an array of the same size as the original array where elements in the range `[1..limit]` are sorted
in ascending order. The remaining elements `(limit..N]` are in an unspecified order.

**Examples**

**simple_int**

```sql title=Query
SELECT arrayPartialSort(2, [5, 9, 1, 3])
```

```response title=Response
[1, 3, 5, 9]
```

**simple_string**

```sql title=Query
SELECT arrayPartialSort(2, ['expenses', 'lasso', 'embolism', 'gladly'])
```

```response title=Response
['embolism', 'expenses', 'gladly', 'lasso']
```

**retain_sorted**

```sql title=Query
SELECT arrayResize(arrayPartialSort(2, [5, 9, 1, 3]), 2)
```

```response title=Response
[1, 3]
```

**lambda_simple**

```sql title=Query
SELECT arrayPartialSort((x) -> -x, 2, [5, 9, 1, 3])
```

```response title=Response
[9, 5, 1, 3]
```

**lambda_complex**

```sql title=Query
SELECT arrayPartialSort((x, y) -> -y, 1, [0, 1, 2], [1, 2, 3]) as res
```

```response title=Response
[2, 1, 0]
```

## arrayPopBack {#arrayPopBack}

Introduced in: v1.1

Removes the last element from the array.

**Syntax**

```sql
arrayPopBack(arr)
```

**Arguments**

- `arr` — The array for which to remove the last element from. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array identical to `arr` but without the last element of `arr` [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayPopBack([1, 2, 3]) AS res;
```

```response title=Response
[1, 2]
```

## arrayPopFront {#arrayPopFront}

Introduced in: v1.1

Removes the first item from the array.

**Syntax**

```sql
arrayPopFront(arr)
```

**Arguments**

- `arr` — The array for which to remove the first element from. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array identical to `arr` but without the first element of `arr` [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayPopFront([1, 2, 3]) AS res;
```

```response title=Response
[2, 3]
```

## arrayProduct {#arrayProduct}

Introduced in: v21.1

Returns the product of elements in the source array.

If a lambda function `func` is specified, returns the product of elements of the lambda results.

**Syntax**

```sql
arrayProduct([func(x[, y1, ..., yN])], source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — Optional. A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the product of elements in the source array, or the product of elements of the lambda results if provided. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Basic example**

```sql title=Query
SELECT arrayProduct([1, 2, 3, 4]);
```

```response title=Response
24
```

**Usage with lambda function**

```sql title=Query
SELECT arrayProduct(x, y -> x+y, [2, 2], [2, 2]) AS res;
```

```response title=Response
16
```

## arrayPushBack {#arrayPushBack}

Introduced in: v1.1

Adds one item to the end of the array.

**Syntax**

```sql
arrayPushBack(arr, x)
```

**Arguments**

- `arr` — The array for which to add value `x` to the end of. [`Array(T)`](/sql-reference/data-types/array)
- `x` —
- Single value to add to the end of the array. [`Array(T)`](/sql-reference/data-types/array).

:::note

- Only numbers can be added to an array with numbers, and only strings can be added to an array of strings.
- When adding numbers, ClickHouse automatically sets the type of `x` for the data type of the array.
- Can be `NULL`. The function adds a `NULL` element to an array, and the type of array elements converts to `Nullable`.

For more information about the types of data in ClickHouse, see [Data types](/sql-reference/data-types).
:::

**Returned value**

Returns an array identical to `arr` but with an additional value `x` at the end of the array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayPushBack(['a'], 'b') AS res;
```

```response title=Response
['a','b']
```

## arrayPushFront {#arrayPushFront}

Introduced in: v1.1

Adds one element to the beginning of the array.

**Syntax**

```sql
arrayPushFront(arr, x)
```

**Arguments**

- `arr` — The array for which to add value `x` to the end of. [`Array(T)`](/sql-reference/data-types/array). - `x` —
- Single value to add to the start of the array. [`Array(T)`](/sql-reference/data-types/array).

:::note

- Only numbers can be added to an array with numbers, and only strings can be added to an array of strings.
- When adding numbers, ClickHouse automatically sets the type of `x` for the data type of the array.
- Can be `NULL`. The function adds a `NULL` element to an array, and the type of array elements converts to `Nullable`.

For more information about the types of data in ClickHouse, see [Data types](/sql-reference/data-types).
:::

**Returned value**

Returns an array identical to `arr` but with an additional value `x` at the beginning of the array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayPushFront(['b'], 'a') AS res;
```

```response title=Response
['a','b']
```

## arrayROCAUC {#arrayROCAUC}

Introduced in: v20.4

Calculates the area under the receiver operating characteristic (ROC) curve.
A ROC curve is created by plotting True Positive Rate (TPR) on the y-axis and False Positive Rate (FPR) on the x-axis across all thresholds.
The resulting value ranges from zero to one, with a higher value indicating better model performance.

The ROC AUC (also known as simply AUC) is a concept in machine learning.
For more details, please see [here](https://developers.google.com/machine-learning/glossary#pr-auc-area-under-the-pr-curve), [here](https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc#expandable-1) and [here](https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Area_under_the_curve).

**Syntax**

```sql
arrayROCAUC(scores, labels[, scale[, partial_offsets]])
```

**Arguments**

- `scores` — Scores prediction model gives. [`Array((U)Int*)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `labels` — Labels of samples, usually 1 for positive sample and 0 for negative sample. [`Array((U)Int*)`](/sql-reference/data-types/array) or [`Enum`](/sql-reference/data-types/enum)
- `scale` — Optional. Decides whether to return the normalized area. If false, returns the area under the TP (true positives) x FP (false positives) curve instead. Default value: true. [`Bool`](/sql-reference/data-types/boolean)
- `partial_offsets` —
- An array of four non-negative integers for calculating a partial area under the ROC curve (equivalent to a vertical band of the ROC space) instead of the whole AUC. This option is useful for distributed computation of the ROC AUC. The array must contain the following elements [`higher_partitions_tp`, `higher_partitions_fp`, `total_positives`, `total_negatives`]. [Array](/sql-reference/data-types/array) of non-negative [Integers](../data-types/int-uint.md). Optional.
- `higher_partitions_tp`: The number of positive labels in the higher-scored partitions.
- `higher_partitions_fp`: The number of negative labels in the higher-scored partitions.
- `total_positives`: The total number of positive samples in the entire dataset.
- `total_negatives`: The total number of negative samples in the entire dataset.

::::note
When `arr_partial_offsets` is used, the `arr_scores` and `arr_labels` should be only a partition of the entire dataset, containing an interval of scores.
The dataset should be divided into contiguous partitions, where each partition contains the subset of the data whose scores fall within a specific range.
For example:

- One partition could contain all scores in the range [0, 0.5).
- Another partition could contain scores in the range [0.5, 1.0].

::::

**Returned value**

Returns area under the receiver operating characteristic (ROC) curve. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayROCAUC([0.1, 0.4, 0.35, 0.8], [0, 0, 1, 1]);
```

```response title=Response
0.75
```

## arrayRandomSample {#arrayRandomSample}

Introduced in: v23.10

Returns a subset with `samples`-many random elements of an input array. If `samples` exceeds the size of the input array, the sample size is limited to the size of the array, i.e. all array elements are returned but their order is not guaranteed. The function can handle both flat arrays and nested arrays.

**Syntax**

```sql
arrayRandomSample(arr, samples)
```

**Arguments**

- `arr` — The input array or multidimensional array from which to sample elements. [`Array(T)`](/sql-reference/data-types/array)
- `samples` — The number of elements to include in the random sample. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

An array containing a random sample of elements from the input array [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayRandomSample(['apple', 'banana', 'cherry', 'date'], 2) as res;
```

```response title=Response
['cherry','apple']
```

**Using a multidimensional array**

```sql title=Query
SELECT arrayRandomSample([[1, 2], [3, 4], [5, 6]], 2) as res;
```

```response title=Response
[[3,4],[5,6]]
```

## arrayReduce {#arrayReduce}

Introduced in: v1.1

Applies an aggregate function to array elements and returns its result.
The name of the aggregation function is passed as a string in single quotes `'max'`, `'sum'`.
When using parametric aggregate functions, the parameter is indicated after the function name in parentheses `'uniqUpTo(6)'`.

**Syntax**

```sql
arrayReduce(agg_f, arr1 [, arr2, ... , arrN)]
```

**Arguments**

- `agg_f` — The name of an aggregate function which should be a constant. [`String`](/sql-reference/data-types/string)
- `arr1 [, arr2, ... , arrN)]` — N arrays corresponding to the arguments of `agg_f`. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the result of the aggregate function

**Examples**

**Usage example**

```sql title=Query
SELECT arrayReduce('max', [1, 2, 3]);
```

```response title=Response
┌─arrayReduce('max', [1, 2, 3])─┐
│                             3 │
└───────────────────────────────┘
```

**Example with aggregate function using multiple arguments**

```sql title=Query
- -If an aggregate function takes multiple arguments, then this function must be applied to multiple arrays of the same size.

SELECT arrayReduce('maxIf', [3, 5], [1, 0]);
```

```response title=Response
┌─arrayReduce('maxIf', [3, 5], [1, 0])─┐
│                                    3 │
└──────────────────────────────────────┘
```

**Example with a parametric aggregate function**

```sql title=Query
SELECT arrayReduce('uniqUpTo(3)', [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);
```

```response title=Response
┌─arrayReduce('uniqUpTo(3)', [1, 2, 3, 4, 5, 6, 7, 8, 9, 10])─┐
│                                                           4 │
└─────────────────────────────────────────────────────────────┘
```

## arrayReduceInRanges {#arrayReduceInRanges}

Introduced in: v20.4

Applies an aggregate function to array elements in the given ranges and returns an array containing the result corresponding to each range.
The function will return the same result as multiple `arrayReduce(agg_func, arraySlice(arr1, index, length), ...)`.

**Syntax**

```sql
arrayReduceInRanges(agg_f, ranges, arr1 [, arr2, ... ,arrN)]
```

**Arguments**

- `agg_f` — The name of the aggregate function to use. [`String`](/sql-reference/data-types/string)
- `ranges` — The range over which to aggregate. An array of tuples, `(i, r)` containing the index `i` from which to begin from and the range `r` over which to aggregate. [`Array(T)`](/sql-reference/data-types/array) or [`Tuple(T)`](/sql-reference/data-types/tuple)
- `arr1 [, arr2, ... ,arrN)]` — N arrays as arguments to the aggregate function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array containing results of the aggregate function over the specified ranges [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayReduceInRanges(
    'sum',
    [(1, 5), (2, 3), (3, 4), (4, 4)],
    [1000000, 200000, 30000, 4000, 500, 60, 7]
) AS res
```

```response title=Response
┌─res─────────────────────────┐
│ [1234500,234000,34560,4567] │
└─────────────────────────────┘
```

## arrayResize {#arrayResize}

Introduced in: v1.1

Changes the length of the array.

**Syntax**

```sql
arrayResize(arr, size[, extender])
```

**Arguments**

- `arr` — Array to resize. [`Array(T)`](/sql-reference/data-types/array)
- `size` —
- The new length of the array.
If `size` is less than the original size of the array, the array is truncated from the right.
If `size` is larger than the initial size of the array, the array is extended to the right with `extender` values or default values for the data type of the array items.
- `extender` — Value to use for extending the array. Can be `NULL`.

**Returned value**

An array of length `size`. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Example 1**

```sql title=Query
SELECT arrayResize([1], 3);
```

```response title=Response
[1,0,0]
```

**Example 2**

```sql title=Query
SELECT arrayResize([1], 3, NULL);
```

```response title=Response
[1,NULL,NULL]
```

## arrayReverse {#arrayReverse}

Introduced in: v1.1

Reverses the order of elements of a given array.

:::note
Function `reverse(arr)` performs the same functionality but works on other data-types
in addition to Arrays.
:::

**Syntax**

```sql
arrayReverse(arr)
```

**Arguments**

- `arr` — The array to reverse. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array of the same size as the original array containing the elements in reverse order [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayReverse([1, 2, 3])
```

```response title=Response
[3,2,1]
```

## arrayReverseFill {#arrayReverseFill}

Introduced in: v20.1

The `arrayReverseFill` function sequentially processes a source array from the last
element to the first, evaluating a lambda condition at each position using elements
from the source and condition arrays. When the condition evaluates to false at
position i, the function replaces that element with the element at position i+1
from the current state of the array. The last element is always preserved
regardless of any condition.

**Syntax**

```sql
arrayReverseFill(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array with elements of the source array replaced by the results of the lambda. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Example with a single array**

```sql title=Query
SELECT arrayReverseFill(x -> not isNull(x), [1, null, 2, null]) AS res
```

```response title=Response
[1, 2, 2, NULL]
```

**Example with two arrays**

```sql title=Query
SELECT arrayReverseFill(x, y, z -> x > y AND x < z, [5, 3, 6, 2], [4, 7, 1, 3], [10, 2, 8, 5]) AS res;
```

```response title=Response
[5, 6, 6, 2]
```

## arrayReverseSort {#arrayReverseSort}

Introduced in: v1.1

Sorts the elements of an array in descending order.
If a function `f` is specified, the provided array is sorted according to the result
of the function applied to the elements of the array, and then the sorted array is reversed.
If `f` accepts multiple arguments, the `arrayReverseSort` function is passed several arrays that
the arguments of `func` will correspond to.

If the array to sort contains `-Inf`, `NULL`, `NaN`, or `Inf` they will be sorted in the following order:

1.`-Inf`
2.`Inf`
3.`NaN`
4.`NULL`

`arrayReverseSort` is a [higher-order function](/sql-reference/functions/overview#higher-order-functions).

**Syntax**

```sql
arrayReverseSort([f,] arr [, arr1, ... ,arrN)
```

**Arguments**

- `f(y1[, y2 ... yN])` — The lambda function to apply to elements of array `x`. - `arr` — An array to be sorted. [`Array(T)`](/sql-reference/data-types/array) - `arr1, ..., yN` — Optional. N additional arrays, in the case when `f` accepts multiple arguments.

**Returned value**

Returns the array `x` sorted in descending order if no lambda function is provided, otherwise
it returns an array sorted according to the logic of the provided lambda function, and then reversed. [`Array(T)`](/sql-reference/data-types/array).

**Examples**

**Example 1**

```sql title=Query
SELECT arrayReverseSort((x, y) -> y, [4, 3, 5], ['a', 'b', 'c']) AS res;
```

```response title=Response
[5,3,4]
```

**Example 2**

```sql title=Query
SELECT arrayReverseSort((x, y) -> -y, [4, 3, 5], [1, 2, 3]) AS res;
```

```response title=Response
[4,3,5]
```

## arrayReverseSplit {#arrayReverseSplit}

Introduced in: v20.1

Split a source array into multiple arrays. When `func(x[, y1, ..., yN])` returns something other than zero, the array will be split to the right of the element. The array will not be split after the last element.

**Syntax**

```sql
arrayReverseSplit(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array of arrays. [`Array(Array(T))`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayReverseSplit((x, y) -> y, [1, 2, 3, 4, 5], [1, 0, 0, 1, 0]) AS res
```

```response title=Response
[[1], [2, 3, 4], [5]]
```

## arrayRotateLeft {#arrayRotateLeft}

Introduced in: v23.8

Rotates an array to the left by the specified number of elements. Negative values of `n` are treated as rotating to the right by the absolute value of the rotation.

**Syntax**

```sql
arrayRotateLeft(arr, n)
```

**Arguments**

- `arr` — The array for which to rotate the elements.[`Array(T)`](/sql-reference/data-types/array). - `n` — Number of elements to rotate. [`(U)Int8/16/32/64`](/sql-reference/data-types/int-uint).

**Returned value**

An array rotated to the left by the specified number of elements [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayRotateLeft([1,2,3,4,5,6], 2) as res;
```

```response title=Response
[3,4,5,6,1,2]
```

**Negative value of n**

```sql title=Query
SELECT arrayRotateLeft([1,2,3,4,5,6], -2) as res;
```

```response title=Response
[5,6,1,2,3,4]
```

## arrayRotateRight {#arrayRotateRight}

Introduced in: v23.8

Rotates an array to the right by the specified number of elements. Negative values of `n` are treated as rotating to the left by the absolute value of the rotation.

**Syntax**

```sql
arrayRotateRight(arr, n)
```

**Arguments**

- `arr` — The array for which to rotate the elements.[`Array(T)`](/sql-reference/data-types/array). - `n` — Number of elements to rotate. [`(U)Int8/16/32/64`](/sql-reference/data-types/int-uint).

**Returned value**

An array rotated to the right by the specified number of elements [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayRotateRight([1,2,3,4,5,6], 2) as res;
```

```response title=Response
[5,6,1,2,3,4]
```

**Negative value of n**

```sql title=Query
SELECT arrayRotateRight([1,2,3,4,5,6], -2) as res;
```

```response title=Response
[3,4,5,6,1,2]
```

## arrayShiftLeft {#arrayShiftLeft}

Introduced in: v23.8

Shifts an array to the left by the specified number of elements.
New elements are filled with the provided argument or the default value of the array element type.
If the number of elements is negative, the array is shifted to the right.

**Syntax**

```sql
arrayShiftLeft(arr, n[, default])
```

**Arguments**

- `arr` — The array for which to shift the elements.[`Array(T)`](/sql-reference/data-types/array). - `n` — Number of elements to shift.[`(U)Int8/16/32/64`](/sql-reference/data-types/int-uint). - `default` — Optional. Default value for new elements.

**Returned value**

An array shifted to the left by the specified number of elements [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayShiftLeft([1,2,3,4,5,6], 2) as res;
```

```response title=Response
[3,4,5,6,0,0]
```

**Negative value of n**

```sql title=Query
SELECT arrayShiftLeft([1,2,3,4,5,6], -2) as res;
```

```response title=Response
[0,0,1,2,3,4]
```

**Using a default value**

```sql title=Query
SELECT arrayShiftLeft([1,2,3,4,5,6], 2, 42) as res;
```

```response title=Response
[3,4,5,6,42,42]
```

## arrayShiftRight {#arrayShiftRight}

Introduced in: v23.8

Shifts an array to the right by the specified number of elements.
New elements are filled with the provided argument or the default value of the array element type.
If the number of elements is negative, the array is shifted to the left.

**Syntax**

```sql
arrayShiftRight(arr, n[, default])
```

**Arguments**

- `arr` — The array for which to shift the elements. [`Array(T)`](/sql-reference/data-types/array)
- `n` — Number of elements to shift. [`(U)Int8/16/32/64`](/sql-reference/data-types/int-uint)
- `default` — Optional. Default value for new elements.

**Returned value**

An array shifted to the right by the specified number of elements [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayShiftRight([1, 2, 3, 4, 5, 6], 2) as res;
```

```response title=Response
[0, 0, 1, 2, 3, 4]
```

**Negative value of n**

```sql title=Query
SELECT arrayShiftRight([1, 2, 3, 4, 5, 6], -2) as res;
```

```response title=Response
[3, 4, 5, 6, 0, 0]
```

**Using a default value**

```sql title=Query
SELECT arrayShiftRight([1, 2, 3, 4, 5, 6], 2, 42) as res;
```

```response title=Response
[42, 42, 1, 2, 3, 4]
```

## arrayShingles {#arrayShingles}

Introduced in: v24.1

Generates an array of shingles (similar to ngrams for strings), i.e. consecutive sub-arrays with a specified length of the input array.

**Syntax**

```sql
arrayShingles(arr, l)
```

**Arguments**

- `arr` — Array for which to generate an array of shingles. [`Array(T)`](/sql-reference/data-types/array)
- `l` — The length of each shingle. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

An array of generated shingles [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayShingles([1, 2, 3, 4], 3) as res;
```

```response title=Response
[[1, 2, 3], [2, 3, 4]]
```

## arrayShuffle {#arrayShuffle}

Introduced in: v23.2

Returns an array of the same size as the original array containing the elements in shuffled order.
Elements are reordered in such a way that each possible permutation of those elements has equal probability of appearance.

:::note
This function will not materialize constants.
:::

**Syntax**

```sql
arrayShuffle(arr [, seed])
```

**Arguments**

- `arr` — The array to shuffle. [`Array(T)`](/sql-reference/data-types/array)
- `seed (optional)` — Optional. The seed to be used with random number generation. If not provided a random one is used. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

Array with elements shuffled [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Example without seed (unstable results)**

```sql title=Query
SELECT arrayShuffle([1, 2, 3, 4]);
```

```response title=Response
[1,4,2,3]
```

**Example without seed (stable results)**

```sql title=Query
SELECT arrayShuffle([1, 2, 3, 4], 41);
```

```response title=Response
[3,2,1,4]
```

## arraySimilarity {#arraySimilarity}

Introduced in: v25.4

Calculates the similarity of two arrays from `0` to `1` based on weighted Levenshtein distance.

**Syntax**

```sql
arraySimilarity(from, to, from_weights, to_weights)
```

**Arguments**

- `from` — first array [`Array(T)`](/sql-reference/data-types/array)
- `to` — second array [`Array(T)`](/sql-reference/data-types/array)
- `from_weights` — weights for the first array. [`Array((U)Int*|Float*)`](/sql-reference/data-types/array)
- `to_weights` — weights for the second array. [`Array((U)Int*|Float*)`](/sql-reference/data-types/array)

**Returned value**

Returns the similarity between `0` and `1` of the two arrays based on the weighted Levenshtein distance [`Float64`](/sql-reference/data-types/float)

**Examples**

**Usage example**

```sql title=Query
SELECT arraySimilarity(['A', 'B', 'C'], ['A', 'K', 'L'], [1.0, 2, 3], [3.0, 4, 5]);
```

```response title=Response
0.2222222222222222
```

## arraySlice {#arraySlice}

Introduced in: v1.1

Returns a slice of the array, with `NULL` elements included.

**Syntax**

```sql
arraySlice(arr, offset [, length])
```

**Arguments**

- `arr` — Array to slice. [`Array(T)`](/sql-reference/data-types/array)
- `offset` — Indent from the edge of the array. A positive value indicates an offset on the left, and a negative value is an indent on the right. Numbering of the array items begins with `1`. [`(U)Int*`](/sql-reference/data-types/int-uint)
- `length` — The length of the required slice. If you specify a negative value, the function returns an open slice `[offset, array_length - length]`. If you omit the value, the function returns the slice `[offset, the_end_of_array]`. [`(U)Int*`](/sql-reference/data-types/int-uint)

**Returned value**

Returns a slice of the array with `length` elements from the specified `offset` [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arraySlice([1, 2, NULL, 4, 5], 2, 3) AS res;
```

```response title=Response
[2, NULL, 4]
```

## arraySort {#arraySort}

Introduced in: v1.1

Sorts the elements of the provided array in ascending order.
If a lambda function `f` is specified, sorting order is determined by the result of
the lambda applied to each element of the array.
If the lambda accepts multiple arguments, the `arraySort` function is passed several
arrays that the arguments of `f` will correspond to.

If the array to sort contains `-Inf`, `NULL`, `NaN`, or `Inf` they will be sorted in the following order:

1.`-Inf`
2.`Inf`
3.`NaN`
4.`NULL`

`arraySort` is a [higher-order function](/sql-reference/functions/overview#higher-order-functions).

**Syntax**

```sql
arraySort([f,] arr [, arr1, ... ,arrN])
```

**Arguments**

- `f(y1[, y2 ... yN])` — The lambda function to apply to elements of array `x`. - `arr` — An array to be sorted. [`Array(T)`](/sql-reference/data-types/array) - `arr1, ..., yN` — Optional. N additional arrays, in the case when `f` accepts multiple arguments.

**Returned value**

Returns the array `arr` sorted in ascending order if no lambda function is provided, otherwise
it returns an array sorted according to the logic of the provided lambda function. [`Array(T)`](/sql-reference/data-types/array).

**Examples**

**Example 1**

```sql title=Query
SELECT arraySort([1, 3, 3, 0]);
```

```response title=Response
[0,1,3,3]
```

**Example 2**

```sql title=Query
SELECT arraySort(['hello', 'world', '!']);
```

```response title=Response
['!','hello','world']
```

**Example 3**

```sql title=Query
SELECT arraySort([1, nan, 2, NULL, 3, nan, -4, NULL, inf, -inf]);
```

```response title=Response
[-inf,-4,1,2,3,inf,nan,nan,NULL,NULL]
```

## arraySplit {#arraySplit}

Introduced in: v20.1

Split a source array into multiple arrays. When `func(x [, y1, ..., yN])` returns something other than zero, the array will be split to the left of the element. The array will not be split before the first element.

**Syntax**

```sql
arraySplit(func(x[, y1, ..., yN]), source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`).[Lambda function](/sql-reference/functions/overview#arrow-operator-and-lambda). - `source_arr` — The source array to split [`Array(T)`](/sql-reference/data-types/array). - `[, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns an array of arrays [`Array(Array(T))`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arraySplit((x, y) -> y, [1, 2, 3, 4, 5], [1, 0, 0, 1, 0]) AS res
```

```response title=Response
[[1, 2, 3], [4, 5]]
```

## arrayStringConcat {#arrayStringConcat}

Introduced in: v1.1

Concatenates the elements of an array of strings into a single string, using the specified delimiter between elements.

**Syntax**

```sql
arrayStringConcat(arr[, delimiter])
```

**Arguments**

- `arr` — The source array of strings. [`Array(String)`](/sql-reference/data-types/array)
- `delimiter` — Optional.The delimiter to insert between elements. Defaults to empty string if not specified. [`String`](/sql-reference/data-types/string)

**Returned value**

A string consisting of the array elements joined by the delimiter. [`String`](/sql-reference/data-types/string)

**Examples**

**Basic usage**

```sql title=Query
SELECT arrayStringConcat(['a', 'b', 'c']);
```

```response title=Response
'abc'
```

**With delimiter**

```sql title=Query
SELECT arrayStringConcat(['a', 'b', 'c'], ',');
```

```response title=Response
a, b, c
```

## arraySum {#arraySum}

Introduced in: v21.1

Returns the sum of elements in the source array.

If a lambda function `func` is specified, returns the sum of elements of the lambda results.

**Syntax**

```sql
arrayMax([func(x[, y1, ..., yN])], source_arr[, cond1_arr, ... , condN_arr])
```

**Arguments**

- `func(x[, y1, ..., yN])` — Optional. A lambda function which operates on elements of the source array (`x`) and condition arrays (`y`). [`Lambda function`](/sql-reference/functions/overview#arrow-operator-and-lambda)
- `source_arr` — The source array to process. [`Array(T)`](/sql-reference/data-types/array)
- `, cond1_arr, ... , condN_arr]` — Optional. N condition arrays providing additional arguments to the lambda function. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the sum of elements in the source array, or the sum of elements of the lambda results if provided.

**Examples**

**Basic example**

```sql title=Query
SELECT arraySum([1, 2, 3, 4]);
```

```response title=Response
10
```

**Usage with lambda function**

```sql title=Query
SELECT arraySum(x, y -> x+y, [1, 1, 1, 1], [1, 1, 1, 1]);
```

```response title=Response
8
```

## arraySymmetricDifference {#arraySymmetricDifference}

Introduced in: v25.4

Takes multiple arrays and returns an array with elements that are not present in all source arrays. The result contains only unique values.

:::note
The symmetric difference of _more than two sets_ is [mathematically defined](https://en.wikipedia.org/wiki/Symmetric_difference#n-ary_symmetric_difference)
as the set of all input elements which occur in an odd number of input sets.
In contrast, function `arraySymmetricDifference` simply returns the set of input elements which do not occur in all input sets.
:::

**Syntax**

```sql
arraySymmetricDifference(arr1, arr2, ... , arrN)
```

**Arguments**

- `arrN` — N arrays from which to make the new array. [`Array(T)`](/sql-reference/data-types/array).

**Returned value**

Returns an array of distinct elements not present in all source arrays [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT
arraySymmetricDifference([1, 2], [1, 2], [1, 2]) AS empty_symmetric_difference,
arraySymmetricDifference([1, 2], [1, 2], [1, 3]) AS non_empty_symmetric_difference;
```

```response title=Response
┌─empty_symmetric_difference─┬─non_empty_symmetric_difference─┐
│ []                         │ [3]                            │
└────────────────────────────┴────────────────────────────────┘
```

## arrayUnion {#arrayUnion}

Introduced in: v24.10

Takes multiple arrays and returns an array which contains all elements that are present in one of the source arrays.The result contains only unique values.

**Syntax**

```sql
arrayUnion(arr1, arr2, ..., arrN)
```

**Arguments**

- `arrN` — N arrays from which to make the new array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array with distinct elements from the source arrays [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT
arrayUnion([-2, 1], [10, 1], [-2], []) as num_example,
arrayUnion(['hi'], [], ['hello', 'hi']) as str_example,
arrayUnion([1, 3, NULL], [2, 3, NULL]) as null_example
```

```response title=Response
┌─num_example─┬─str_example────┬─null_example─┐
│ [10,-2,1]   │ ['hello','hi'] │ [3,2,1,NULL] │
└─────────────┴────────────────┴──────────────┘
```

## arrayUniq {#arrayUniq}

Introduced in: v1.1

For a single argument passed, counts the number of different elements in the array.
For multiple arguments passed, it counts the number of different **tuples** made of elements at matching positions across multiple arrays.

For example `SELECT arrayUniq([1,2], [3,4], [5,6])` will form the following tuples:

- Position 1: (1,3,5)
- Position 2: (2,4,6)

It will then count the number of unique tuples. In this case `2`.

All arrays passed must have the same length.

:::tip
If you want to get a list of unique items in an array, you can use `arrayReduce('groupUniqArray', arr)`.
:::

**Syntax**

```sql
arrayUniq(arr1[, arr2, ..., arrN])
```

**Arguments**

- `arr1` — Array for which to count the number of unique elements. [`Array(T)`](/sql-reference/data-types/array)
- `[, arr2, ..., arrN]` — Optional. Additional arrays used to count the number of unique tuples of elements at corresponding positions in multiple arrays. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

For a single argument returns the number of unique
elements. For multiple arguments returns the number of unique tuples made from
elements at corresponding positions across the arrays.
 [`UInt32`](/sql-reference/data-types/int-uint)

**Examples**

**Single argument**

```sql title=Query
SELECT arrayUniq([1, 1, 2, 2])
```

```response title=Response
2
```

**Multiple argument**

```sql title=Query
SELECT arrayUniq([1, 2, 3, 1], [4, 5, 6, 4])
```

```response title=Response
3
```

## arrayWithConstant {#arrayWithConstant}

Introduced in: v20.1

Creates an array of length `length` filled with the constant `x`.

**Syntax**

```sql
arrayWithConstant(N, x)
```

**Arguments**

- `length` — Number of elements in the array. [`(U)Int*`](/sql-reference/data-types/int-uint)
- `x` — The value of the `N` elements in the array, of any type.

**Returned value**

Returns an Array with `N` elements of value `x`. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayWithConstant(3, 1)
```

```response title=Response
[1, 1, 1]
```

## arrayZip {#arrayZip}

Introduced in: v20.1

Combines multiple arrays into a single array. The resulting array contains the corresponding elements of the source arrays grouped into tuples in the listed order of arguments.

**Syntax**

```sql
arrayZip(arr1, arr2, ... , arrN)
```

**Arguments**

- `arr1, arr2, ... , arrN` — N arrays to combine into a single array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array with elements from the source arrays grouped in tuples. Data types in the tuple are the same as types of the input arrays and in the same order as arrays are passed [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayZip(['a', 'b', 'c'], [5, 2, 1]);
```

```response title=Response
[('a', 5), ('b', 2), ('c', 1)]
```

## arrayZipUnaligned {#arrayZipUnaligned}

Introduced in: v20.1

Combines multiple arrays into a single array, allowing for unaligned arrays (arrays of differing lengths). The resulting array contains the corresponding elements of the source arrays grouped into tuples in the listed order of arguments.

**Syntax**

```sql
arrayZipUnaligned(arr1, arr2, ..., arrN)
```

**Arguments**

- `arr1, arr2, ..., arrN` — N arrays to combine into a single array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns an array with elements from the source arrays grouped in tuples. Data types in the tuple are the same as types of the input arrays and in the same order as arrays are passed. [`Array(T)`](/sql-reference/data-types/array) or [`Tuple(T1, T2, ...)`](/sql-reference/data-types/tuple)

**Examples**

**Usage example**

```sql title=Query
SELECT arrayZipUnaligned(['a'], [1, 2, 3]);
```

```response title=Response
[('a', 1),(NULL, 2),(NULL, 3)]
```

## countEqual {#countEqual}

Introduced in: v1.1

Returns the number of elements in the array equal to `x`. Equivalent to `arrayCount(elem -> elem = x, arr)`.

`NULL` elements are handled as separate values.

**Syntax**

```sql
countEqual(arr, x)
```

**Arguments**

- `arr` — Array to search. [`Array(T)`](/sql-reference/data-types/array)
- `x` — Value in the array to count. Any type.

**Returned value**

Returns the number of elements in the array equal to `x` [`UInt64`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT countEqual([1, 2, NULL, NULL], NULL)
```

```response title=Response
2
```

## empty {#empty}

Introduced in: v1.1

Checks whether the input array is empty.

An array is considered empty if it does not contain any elements.

:::note
Can be optimized by enabling the [`optimize_functions_to_subcolumns` setting](/operations/settings/settings#optimize_functions_to_subcolumns). With `optimize_functions_to_subcolumns = 1` the function reads only [size0](/sql-reference/data-types/array#array-size) subcolumn instead of reading and processing the whole array column. The query `SELECT empty(arr) FROM TABLE;` transforms to `SELECT arr.size0 = 0 FROM TABLE;`.
:::

The function also works for [strings](string-functions.md#empty) or [UUID](uuid-functions.md#empty).

**Syntax**

```sql
empty(arr)
```

**Arguments**

- `arr` — Input array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns `1` for an empty array or `0` for a non-empty array [`UInt8`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT empty([]);
```

```response title=Response
1
```

## emptyArrayDate {#emptyArrayDate}

Introduced in: v1.1

Returns an empty Date array

**Syntax**

```sql
emptyArrayDate()
```

**Arguments**

- None.
**Returned value**

An empty Date array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayDate
```

```response title=Response
[]
```

## emptyArrayDateTime {#emptyArrayDateTime}

Introduced in: v1.1

Returns an empty DateTime array

**Syntax**

```sql
emptyArrayDateTime()
```

**Arguments**

- None.
**Returned value**

An empty DateTime array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayDateTime
```

```response title=Response
[]
```

## emptyArrayFloat32 {#emptyArrayFloat32}

Introduced in: v1.1

Returns an empty Float32 array

**Syntax**

```sql
emptyArrayFloat32()
```

**Arguments**

- None.
**Returned value**

An empty Float32 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayFloat32
```

```response title=Response
[]
```

## emptyArrayFloat64 {#emptyArrayFloat64}

Introduced in: v1.1

Returns an empty Float64 array

**Syntax**

```sql
emptyArrayFloat64()
```

**Arguments**

- None.
**Returned value**

An empty Float64 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayFloat64
```

```response title=Response
[]
```

## emptyArrayInt16 {#emptyArrayInt16}

Introduced in: v1.1

Returns an empty Int16 array

**Syntax**

```sql
emptyArrayInt16()
```

**Arguments**

- None.
**Returned value**

An empty Int16 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayInt16
```

```response title=Response
[]
```

## emptyArrayInt32 {#emptyArrayInt32}

Introduced in: v1.1

Returns an empty Int32 array

**Syntax**

```sql
emptyArrayInt32()
```

**Arguments**

- None.
**Returned value**

An empty Int32 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayInt32
```

```response title=Response
[]
```

## emptyArrayInt64 {#emptyArrayInt64}

Introduced in: v1.1

Returns an empty Int64 array

**Syntax**

```sql
emptyArrayInt64()
```

**Arguments**

- None.
**Returned value**

An empty Int64 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayInt64
```

```response title=Response
[]
```

## emptyArrayInt8 {#emptyArrayInt8}

Introduced in: v1.1

Returns an empty Int8 array

**Syntax**

```sql
emptyArrayInt8()
```

**Arguments**

- None.
**Returned value**

An empty Int8 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayInt8
```

```response title=Response
[]
```

## emptyArrayString {#emptyArrayString}

Introduced in: v1.1

Returns an empty String array

**Syntax**

```sql
emptyArrayString()
```

**Arguments**

- None.
**Returned value**

An empty String array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayString
```

```response title=Response
[]
```

## emptyArrayToSingle {#emptyArrayToSingle}

Introduced in: v1.1

Accepts an empty array and returns a one-element array that is equal to the default value.

**Syntax**

```sql
emptyArrayToSingle(arr)
```

**Arguments**

- `arr` — An empty array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

An array with a single value of the Array's default type. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Basic example**

```sql title=Query
CREATE TABLE test (
  a Array(Int32),
  b Array(String),
  c Array(DateTime)
)
ENGINE = MergeTree
ORDER BY tuple();

INSERT INTO test VALUES ([], [], []);

SELECT emptyArrayToSingle(a), emptyArrayToSingle(b), emptyArrayToSingle(c) FROM test;
```

```response title=Response
┌─emptyArrayToSingle(a)─┬─emptyArrayToSingle(b)─┬─emptyArrayToSingle(c)───┐
│ [0]                   │ ['']                  │ ['1970-01-01 01:00:00'] │
└───────────────────────┴───────────────────────┴─────────────────────────┘
```

## emptyArrayUInt16 {#emptyArrayUInt16}

Introduced in: v1.1

Returns an empty UInt16 array

**Syntax**

```sql
emptyArrayUInt16()
```

**Arguments**

- None.
**Returned value**

An empty UInt16 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayUInt16
```

```response title=Response
[]
```

## emptyArrayUInt32 {#emptyArrayUInt32}

Introduced in: v1.1

Returns an empty UInt32 array

**Syntax**

```sql
emptyArrayUInt32()
```

**Arguments**

- None.
**Returned value**

An empty UInt32 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayUInt32
```

```response title=Response
[]
```

## emptyArrayUInt64 {#emptyArrayUInt64}

Introduced in: v1.1

Returns an empty UInt64 array

**Syntax**

```sql
emptyArrayUInt64()
```

**Arguments**

- None.
**Returned value**

An empty UInt64 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayUInt64
```

```response title=Response
[]
```

## emptyArrayUInt8 {#emptyArrayUInt8}

Introduced in: v1.1

Returns an empty UInt8 array

**Syntax**

```sql
emptyArrayUInt8()
```

**Arguments**

- None.
**Returned value**

An empty UInt8 array. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT emptyArrayUInt8
```

```response title=Response
[]
```

## has {#has}

Introduced in: v1.1

Returns whether the array contains the specified element.

**Syntax**

```sql
has(arr, x)
```

**Arguments**

- `arr` — The source array. [`Array(T)`](/sql-reference/data-types/array)
- `x` — The value to search for in the array.

**Returned value**

Returns `1` if the array contains the specified element, otherwise `0`. [`UInt8`](/sql-reference/data-types/int-uint)

**Examples**

**Basic usage**

```sql title=Query
SELECT has([1, 2, 3], 2)
```

```response title=Response
1
```

**Not found**

```sql title=Query
SELECT has([1, 2, 3], 4)
```

```response title=Response
0
```

## hasAll {#hasAll}

Introduced in: v1.1

Checks whether one array is a subset of another.

- An empty array is a subset of any array.
- `Null` is processed as a value.
- The order of values in both the arrays does not matter.

**Syntax**

```sql
hasAll(set, subset)
```

**Arguments**

- `set` — Array of any type with a set of elements. [`Array(T)`](/sql-reference/data-types/array)
- `subset` — Array of any type that shares a common supertype with `set` containing elements that should be tested to be a subset of `set`. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

- `1`, if `set` contains all of the elements from `subset`.
- `0`, otherwise.

Raises a `NO_COMMON_TYPE` exception if the set and subset elements do not share a common supertype.

**Examples**

**Empty arrays**

```sql title=Query
SELECT hasAll([], [])
```

```response title=Response
1
```

**Arrays containing NULL values**

```sql title=Query
SELECT hasAll([1, Null], [Null])
```

```response title=Response
1
```

**Arrays containing values of a different type**

```sql title=Query
SELECT hasAll([1.0, 2, 3, 4], [1, 3])
```

```response title=Response
1
```

**Arrays containing String values**

```sql title=Query
SELECT hasAll(['a', 'b'], ['a'])
```

```response title=Response
1
```

**Arrays without a common type**

```sql title=Query
SELECT hasAll([1], ['a'])
```

```response title=Response
Raises a NO_COMMON_TYPE exception
```

**Array of arrays**

```sql title=Query
SELECT hasAll([[1, 2], [3, 4]], [[1, 2], [3, 5]])
```

```response title=Response
0
```

## hasAny {#hasAny}

Introduced in: v1.1

Checks whether two arrays have intersection by some elements.

- `Null` is processed as a value.
- The order of the values in both of the arrays does not matter.

**Syntax**

```sql
hasAny(arr_x, arr_y)
```

**Arguments**

- `arr_x` — Array of any type with a set of elements. [`Array(T)`](/sql-reference/data-types/array)
- `arr_y` — Array of any type that shares a common supertype with array `arr_x`. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

- `1`, if `arr_x` and `arr_y` have one similar element at least.
- `0`, otherwise.

Raises a `NO_COMMON_TYPE` exception if any of the elements of the two arrays do not share a common supertype.

**Examples**

**One array is empty**

```sql title=Query
SELECT hasAny([1], [])
```

```response title=Response
0
```

**Arrays containing NULL values**

```sql title=Query
SELECT hasAny([Null], [Null, 1])
```

```response title=Response
1
```

**Arrays containing values of a different type**

```sql title=Query
SELECT hasAny([-128, 1., 512], [1])
```

```response title=Response
1
```

**Arrays without a common type**

```sql title=Query
SELECT hasAny([[1, 2], [3, 4]], ['a', 'c'])
```

```response title=Response
Raises a `NO_COMMON_TYPE` exception
```

**Array of arrays**

```sql title=Query
SELECT hasAll([[1, 2], [3, 4]], [[1, 2], [1, 2]])
```

```response title=Response
1
```

## hasSubstr {#hasSubstr}

Introduced in: v20.6

Checks whether all the elements of array2 appear in a array1 in the same exact order.
Therefore, the function will return `1`, if and only if array1 = prefix + array2 + suffix.

In other words, the functions will check whether all the elements of array2 are contained in array1 like the `hasAll` function.
In addition, it will check that the elements are observed in the same order in both array1 and array2.

- The function will return `1` if array2 is empty.
- `Null` is processed as a value. In other words `hasSubstr([1, 2, NULL, 3, 4], [2,3])` will return `0`. However, `hasSubstr([1, 2, NULL, 3, 4], [2,NULL,3])` will return `1`
- The order of values in both the arrays does matter.

Raises a `NO_COMMON_TYPE` exception if any of the elements of the two arrays do not share a common supertype.

**Syntax**

```sql
hasSubstr(arr1, arr2)
```

**Arguments**

- `arr1` — Array of any type with a set of elements. [`Array(T)`](/sql-reference/data-types/array)
- `arr2` — Array of any type with a set of elements. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns `1` if array `arr1` contains array `arr2`. Otherwise, returns `0`. [`UInt8`](/sql-reference/data-types/int-uint)

**Examples**

**Both arrays are empty**

```sql title=Query
SELECT hasSubstr([], [])
```

```response title=Response
1
```

**Arrays containing NULL values**

```sql title=Query
SELECT hasSubstr([1, Null], [Null])
```

```response title=Response
1
```

**Arrays containing values of a different type**

```sql title=Query
SELECT hasSubstr([1.0, 2, 3, 4], [1, 3])
```

```response title=Response
0
```

**Arrays containing strings**

```sql title=Query
SELECT hasSubstr(['a', 'b'], ['a'])
```

```response title=Response
1
```

**Arrays with valid ordering**

```sql title=Query
SELECT hasSubstr(['a', 'b' , 'c'], ['a', 'b'])
```

```response title=Response
1
```

**Arrays with invalid ordering**

```sql title=Query
SELECT hasSubstr(['a', 'b' , 'c'], ['a', 'c'])
```

```response title=Response
0
```

**Array of arrays**

```sql title=Query
SELECT hasSubstr([[1, 2], [3, 4], [5, 6]], [[1, 2], [3, 4]])
```

```response title=Response
1
```

**Arrays without a common type**

```sql title=Query
SELECT hasSubstr([1, 2, NULL, 3, 4], ['a'])
```

```response title=Response
Raises a `NO_COMMON_TYPE` exception
```

## indexOf {#indexOf}

Introduced in: v1.1

Returns the index of the first element with value 'x' (starting from 1) if it is in the array.
If the array does not contain the searched-for value, the function returns `0`.

Elements set to `NULL` are handled as normal values.

**Syntax**

```sql
indexOf(arr, x)
```

**Arguments**

- `arr` — An array to search in for `x`. [`Array(T)`](/sql-reference/data-types/array)
- `x` — Value of the first matching element in `arr` for which to return an index. [`UInt64`](/sql-reference/data-types/int-uint)

**Returned value**

Returns the index (numbered from one) of the first `x` in `arr` if it exists. Otherwise, returns `0`. [`UInt64`](/sql-reference/data-types/int-uint)

**Examples**

**Basic example**

```sql title=Query
SELECT indexOf([5, 4, 1, 3], 3)
```

```response title=Response
4
```

**Array with nulls**

```sql title=Query
SELECT indexOf([1, 3, NULL, NULL], NULL)
```

```response title=Response
3
```

## indexOfAssumeSorted {#indexOfAssumeSorted}

Introduced in: v24.12

Returns the index of the first element with value 'x' (starting from `1`) if it is in the array.
If the array does not contain the searched-for value, the function returns `0`.

:::note
Unlike the `indexOf` function, this function assumes that the array is sorted in
ascending order. If the array is not sorted, results are undefined.
:::

**Syntax**

```sql
indexOfAssumeSorted(arr, x)
```

**Arguments**

- `arr` — A sorted array to search. [`Array(T)`](/sql-reference/data-types/array)
- `x` — Value of the first matching element in sorted `arr` for which to return an index. [`UInt64`](/sql-reference/data-types/int-uint)

**Returned value**

Returns the index (numbered from one) of the first `x` in `arr` if it exists. Otherwise, returns `0`. [`UInt64`](/sql-reference/data-types/int-uint)

**Examples**

**Basic example**

```sql title=Query
SELECT indexOfAssumeSorted([1, 3, 3, 3, 4, 4, 5], 4)
```

```response title=Response
5
```

## length {#length}

Introduced in: v1.1

Calculates the length of a string or array.

- For String or FixedString arguments: calculates the number of bytes in the string.
- For Array arguments: calculates the number of elements in the array.
- If applied to a FixedString argument, the function is a constant expression.

Please note that the number of bytes in a string is not the same as the number of
Unicode "code points" and it is not the same as the number of Unicode "grapheme clusters"
(what we usually call "characters") and it is not the same as the visible string width.

It is ok to have ASCII NUL bytes in strings, and they will be counted as well.

**Syntax**

```sql
length(x)
```

**Arguments**

- `x` — Value for which to calculate the number of bytes (for String/FixedString) or elements (for Array). [`String`](/sql-reference/data-types/string) or [`FixedString`](/sql-reference/data-types/fixedstring) or [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns the number of number of bytes in the String/FixedString `x` / the number of elements in array `x` [`UInt64`](/sql-reference/data-types/int-uint)

**Examples**

**string1**

```sql title=Query
SELECT length('Hello, world!')
```

```response title=Response
13
```

**arr1**

```sql title=Query
SELECT length(['Hello', 'world'])
```

```response title=Response
2
```

**constexpr**

```sql title=Query
WITH 'hello' || toString(number) AS str
SELECT str,
isConstant(length(str)) AS str_length_is_constant,
isConstant(length(str::FixedString(6))) AS fixed_str_length_is_constant
FROM numbers(3)
```

```response title=Response
┌─str────┬─str_length_is_constant─┬─fixed_str_length_is_constant─┐
│ hello0 │                      0 │                            1 │
│ hello1 │                      0 │                            1 │
│ hello2 │                      0 │                            1 │
└────────┴────────────────────────┴──────────────────────────────┘
```

**unicode**

```sql title=Query
SELECT 'ёлка' AS str1, length(str1), lengthUTF8(str1), normalizeUTF8NFKD(str1) AS str2, length(str2), lengthUTF8(str2)
```

```response title=Response
┌─str1─┬─length(str1)─┬─lengthUTF8(str1)─┬─str2─┬─length(str2)─┬─lengthUTF8(str2)─┐
│ ёлка │            8 │                4 │ ёлка │           10 │                5 │
└──────┴──────────────┴──────────────────┴──────┴──────────────┴──────────────────┘
```

**ascii_vs_utf8**

```sql title=Query
SELECT 'ábc' AS str, length(str), lengthUTF8(str)
```

```response title=Response
┌─str─┬─length(str)──┬─lengthUTF8(str)─┐
│ ábc │            4 │               3 │
└─────┴──────────────┴─────────────────┘
```

## notEmpty {#notEmpty}

Introduced in: v1.1

Checks whether the input array is non-empty.

An array is considered non-empty if it contains at least one element.

:::note
Can be optimized by enabling the [`optimize_functions_to_subcolumns`](/operations/settings/settings#optimize_functions_to_subcolumns) setting. With `optimize_functions_to_subcolumns = 1` the function reads only [size0](/sql-reference/data-types/array#array-size) subcolumn instead of reading and processing the whole array column. The query `SELECT notEmpty(arr) FROM table` transforms to `SELECT arr.size0 != 0 FROM TABLE`.
:::

The function also works for [strings](string-functions.md#notempty) or [UUID](uuid-functions.md#notempty).

**Syntax**

```sql
notEmpty(arr)
```

**Arguments**

- `arr` — Input array. [`Array(T)`](/sql-reference/data-types/array)

**Returned value**

Returns `1` for a non-empty array or `0` for an empty array [`UInt8`](/sql-reference/data-types/int-uint)

**Examples**

**Usage example**

```sql title=Query
SELECT notEmpty([1,2]);
```

```response title=Response
1
```

## range {#range}

Introduced in: v1.1

Returns an array of numbers from `start` to `end - 1` by `step`.

The supported types are:

- `UInt8/16/32/64`
- `Int8/16/32/64]`

- All arguments `start`, `end`, `step` must be one of the above supported types. Elements of the returned array will be a super type of the arguments.
- An exception is thrown if the function returns an array with a total length more than the number of elements specified by setting [`function_range_max_elements_in_block`](../../operations/settings/settings.md#function_range_max_elements_in_block).
- Returns `NULL` if any argument has Nullable(nothing) type. An exception is thrown if any argument has `NULL` value (Nullable(T) type).

**Syntax**

```sql
range([start, ] end [, step])
```

**Arguments**

- `start` — Optional. The first element of the array. Required if `step` is used. Default value: `0`. - `end` — Required. The number before which the array is constructed. - `step` — Optional. Determines the incremental step between each element in the array. Default value: `1`.

**Returned value**

Array of numbers from `start` to `end - 1` by `step`. [`Array(T)`](/sql-reference/data-types/array)

**Examples**

**Usage example**

```sql title=Query
SELECT range(5), range(1, 5), range(1, 5, 2), range(-1, 5, 2);
```

```response title=Response
┌─range(5)────┬─range(1, 5)─┬─range(1, 5, 2)─┬─range(-1, 5, 2)─┐
│ [0,1,2,3,4] │ [1,2,3,4]   │ [1,3]          │ [-1,1,3]        │
└─────────────┴─────────────┴────────────────┴─────────────────┘
```

## reverse {#reverse}

Introduced in: v1.1

Reverses the order of the elements in the input array or the characters in the input string.

**Syntax**

```sql
reverse(arr | str)
```

**Arguments**

- `arr | str` — The source array or string. [`Array(T)`](/sql-reference/data-types/array) or [`String`](/sql-reference/data-types/string)

**Returned value**

Returns an array or string with the order of elements or characters reversed.

**Examples**

**Reverse array**

```sql title=Query
SELECT reverse([1, 2, 3, 4]);
```

```response title=Response
[4, 3, 2, 1]
```

**Reverse string**

```sql title=Query
SELECT reverse('abcd');
```

```response title=Response
'dcba'
```

<!--AUTOGENERATED_END-->

## Distance functions {#distance-functions}

All supported functions are described in [distance functions documentation](../../sql-reference/functions/distance-functions.md).
