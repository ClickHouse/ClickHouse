
--- 
toc_title: "Функции для работы с индексами S2"
---

# Функции для работы с индексами S2 {#s2index}

[S2](https://s2geometry.io/) — это система геокодирования, в которой все географические данные представлены на трехмерной сфере (аналогично глобусу).

В библиотеке S2 точки представлены в виде векторов одинаковой длины, называемых индексами точек S2 (точки на поверхности единой трехмерной сферы), в отличие от традиционных пар: широта, долгота.

## geoToS2 {#geotos2}

Возвращает [S2](#s2index) индекс точки, соответствующий указанным координатам `(долгота, широта)`.

**Синтаксис**

``` sql
geoToS2(lon, lat)
```

**Параметры**

-   `lon` — долгота. [Float64](../../../sql-reference/data-types/float.md).
-   `lat` — широта. [Float64](../../../sql-reference/data-types/float.md).

**Возвращаемое значение**

-  S2 индекс точки.

Тип: [UInt64](../../../sql-reference/data-types/int-uint.md).

**Пример**

Query:

``` sql
SELECT geoToS2(37.79506683, 55.71290588) AS s2Index;
```

Result:

``` text
┌─────────────s2Index─┐
│ 4704772434919038107 │
└─────────────────────┘
```

## s2ToGeo {#s2togeo}

Возвращает географические координаты `(долгота, широта)`,
соответствующие указанному [S2](#s2index) индексу точки.

**Синтаксис**

``` sql
s2ToGeo(s2index)
```

**Параметры**

-   `s2index` — [S2](#s2index)-индекс. [UInt64](../../../sql-reference/data-types/int-uint.md).

**Возвращаемые значения**

-   Кортеж их двух значений: `tuple(lon,lat)`.

Тип: `lon` — [Float64](../../../sql-reference/data-types/float.md). `lat` — [Float64](../../../sql-reference/data-types/float.md).

**Пример**

Запрос:

``` sql
SELECT s2ToGeo(4704772434919038107) AS s2Coodrinates;
```

Результат:

``` text
┌─s2Coodrinates────────────────────────┐
│ (37.79506681471008,55.7129059052841) │
└──────────────────────────────────────┘
```

## s2GetNeighbors {#s2getneighbors}

Возвращает [S2](#s2index)-индексы соседей, соответствующие указанному S2-индексу. Ячейка в системе S2 представляет собой четырехугольник, ограниченный четырьмя сторонами. Соответственно, у каждой ячейки есть 4 соседа.

**Синтаксис**

``` sql
s2GetNeighbors(s2index)
```

**Параметры**

-   `s2index` — [S2](#s2index)-индекс. [UInt64](../../../sql-reference/data-types/int-uint.md).


**Returned values**

-   Массив, содержащий 4 соседних индекса: `array[s2index1, s2index3, s2index2, s2index4]`.

Тип: Любой S2-индекс [UInt64](../../../sql-reference/data-types/int-uint.md).


**Пример**

Запрос:

``` sql
SELECT s2GetNeighbors(5074766849661468672) AS s2Neighbors;
```

Результат:

``` text
┌─s2Neighbors───────────────────────────────────────────────────────────────────────┐
│ [5074766987100422144,5074766712222515200,5074767536856236032,5074767261978329088] │
└───────────────────────────────────────────────────────────────────────────────────┘
```

## s2CellsIntersect {#s2cellsintersect}

Определяет, пересекаются ли два предоставленных [S2](#s2index)-индекса ячейки или нет.

**Синтаксис**

``` sql
s2CellsIntersect(s2index1, s2index2)
```

**Параметры**

-   `siIndex1`, `s2index2` — S2-индекс. [UInt64](../../../sql-reference/data-types/int-uint.md).


**Возвращаемые значения**

-   1 — индексы ячеек S2 пересекаются.
-   0 — индексы ячеек не S2 пересекаются.

Тип: [UInt8](../../../sql-reference/data-types/int-uint.md).

**Пример**

Запрос:

``` sql
SELECT s2CellsIntersect(9926595209846587392, 9926594385212866560) AS intersect;
```

Результат:

``` text
┌─intersect─┐
│         1 │
└───────────┘
```

## s2CapContains {#s2capcontains}

Определяет, содержит ли купол [S2](#s2index)-индекс точки. Купол представляет собой часть сферы, которая была отрезана плоскостью. Купол определяется точкой на сфере и радиусом в градусах.

**Синтаксис**

``` sql
s2CapContains(center, degrees, point)
```

**Параметры**

-   `center` — S2-индекс точки , определяющий купол. [UInt64](../../../sql-reference/data-types/int-uint.md).
-   `degrees` — радиус купола в градусах. [Float64](../../../sql-reference/data-types/float.md).
-   `point` — S2-индекс точки. [UInt64](../../../sql-reference/data-types/int-uint.md).

**Returned values**

-   1 — купол содержит S2-индекс точки.
-   0 — купол не содержит S2-индекс точки.

Тип: [UInt8](../../../sql-reference/data-types/int-uint.md).

**Пример**

Query:

``` sql
SELECT s2CapContains(1157339245694594829, 1.0, 1157347770437378819) AS capContains;
```

Result:

``` text
┌─capContains─┐
│           1 │
└─────────────┘
```

## s2CapUnion {#s2capunion}

Определяет наименьший купол, содержащий заданные два входных купола. Купол представляет собой часть сферы, которая была отрезана плоскостью. Купол определяется точкой на сфере и радиусом в градусах.


**Синтаксис**

``` sql
s2CapUnion(center1, radius1, center2, radius2)
```

**Параметры**

-   `center1`, `center2` — S2-индексы точек, определяющие два входных купола. [UInt64](../../../sql-reference/data-types/int-uint.md).
-   `radius1`, `radius2` — значения радиуса в градусах, определяющие два входных купола. [Float64](../../../sql-reference/data-types/float.md).


**Returned values**

-   `center` — S2-индекс точки, соответствующий центру наименьшего купола, содержащего два входных купола. Тип: [UInt64](../../../sql-reference/data-types/int-uint.md).
-   `radius` — радиус в градусах наименьшего купола, содержащего два входных купола. Тип: [Float64](../../../sql-reference/data-types/float.md).

**Пример**

Query:

``` sql
SELECT s2CapUnion(3814912406305146967, 1.0, 1157347770437378819, 1.0) AS capUnion;
```

Result:

``` text
┌─capUnion───────────────────────────────┐
│ (4534655147792050737,60.2088283994957) │
└────────────────────────────────────────┘
```

## s2RectAdd {#s2rectadd}

Увеличивает размер ограничивающего прямоугольника, чтобы включить в себя заданный S2-индекс. В системе S2 прямоугольник представлен типом S2Region, называемым `S2latlngrect`, который задается прямоугольник в пространстве широта-долгота.

**Синтаксис**

``` sql
s2RectAdd(s2pointLow, s2pointHigh, s2Point)
```

**Параметры**

-   `s2PointLow` — нижний S2-индекс, задающий прямоугольник. [UInt64](../../../sql-reference/data-types/int-uint.md).
-   `s2PointHigh` — верхний S2-индекс, задающий прямоугольник. [UInt64](../../../sql-reference/data-types/int-uint.md).
-   `s2Point` — целевой S2-индекс точки, который должен быть увеличен, чтобы связанный прямоугольник включал её. [UInt64](../../../sql-reference/data-types/int-uint.md).

**Returned values**

-   `s2PointLow` — идентификатор нижней ячейки S2, соответствующий увеличенному прямоугольнику
Low S2 cell id corresponding to the grown rectangle. Type: [UInt64](../../../sql-reference/data-types/int-uint.md).
-   `s2PointHigh` — Hight S2 cell id corresponding to the grown rectangle. Type: [UInt64](../../../sql-reference/data-types/float.md).




