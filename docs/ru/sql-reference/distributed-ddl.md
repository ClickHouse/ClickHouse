---
sidebar_position: 32
sidebar_label: "Распределенные DDL запросы"
---

# Распределенные DDL запросы (секция ON CLUSTER) {#raspredelennye-ddl-zaprosy-sektsiia-on-cluster}

Запросы `CREATE`, `DROP`, `ALTER`, `RENAME` поддерживают возможность распределенного выполнения на кластере.
Например, следующий запрос создает распределенную (Distributed) таблицу `all_hits` на каждом хосте в `cluster`:

``` sql
CREATE TABLE IF NOT EXISTS all_hits ON CLUSTER cluster (p Date, i Int32) ENGINE = Distributed(cluster, default, hits)
```

Для корректного выполнения таких запросов необходимо на каждом хосте иметь одинаковое определение кластера (для упрощения синхронизации конфигов можете использовать подстановки из ZooKeeper). Также необходимо подключение к ZooKeeper серверам.
Локальная версия запроса в конечном итоге будет выполнена на каждом хосте кластера, даже если некоторые хосты в данный момент не доступны. 

:::warning    
Гарантируется упорядоченность выполнения запросов в рамках одного хоста.
:::

:::warning    
Внутри сервера ClickHouse есть специальный процесс — DDLWorker. Он запускается при запуске ClickHouse. Когда вы выполняете какой-либо SQL c `on cluster`, ClickHouse создает задачи в ZooKeeper для каждого шарда в кластере. DDLWorker на каждом узле берет свои задачи и выполняет их локально. Но поскольку DDLWorker запускается с ClickHouse, он использует настройки из профиля по умолчанию, которые были определены при запуске ClickHouse. DDLWorker невозможно перезапустить. Для применения изменений в настройках профиля необходимо перезапустить ClickHouse.
:::

<!--hide-->
