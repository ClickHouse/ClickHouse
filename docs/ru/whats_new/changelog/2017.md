---
machine_translated: true
machine_translated_rev: 1cd5f0028d917696daf71ac1c9ee849c99c1d5c8
---

### ClickHouse релиз 1.1.54327, 2017-12-21 {#clickhouse-release-1-1-54327-2017-12-21}

Этот выпуск содержит исправления ошибок для предыдущей версии 1.1.54318:

-   Исправлена ошибка с возможным состоянием гонки в репликации, которая могла привести к потере данных. Эта проблема затрагивает версии 1.1.54310 и 1.1.54318. Если вы используете одну из этих версий с Реплицированными таблицами, настоятельно рекомендуется обновить ее. Эта проблема отображается в журналах в предупреждающих сообщениях, таких как `Part ... from own log doesn't exist.` Эта проблема актуальна, даже если вы не видите эти сообщения в журналах.

### ClickHouse релиз 1.1.54318, 2017-11-30 {#clickhouse-release-1-1-54318-2017-11-30}

Этот выпуск содержит исправления ошибок для предыдущей версии 1.1.54310:

-   Исправлено некорректное удаление строк при слияниях в движке SummingMergeTree
-   Исправлена утечка памяти в несложных движках MergeTree
-   Исправлено снижение производительности при частых вставках в двигатели MergeTree
-   Исправлена ошибка, из-за которой очередь репликации останавливалась
-   Исправлена ротация и архивация журналов сервера

### ClickHouse релиз 1.1.54310, 2017-11-01 {#clickhouse-release-1-1-54310-2017-11-01}

#### Новые средства: {#new-features}

-   Пользовательский ключ секционирования для семейства движков таблиц MergeTree.
-   [Кафка](https://clickhouse.yandex/docs/en/operations/table_engines/kafka/) настольный двигатель.
-   Добавлена поддержка загрузки [CatBoost](https://catboost.yandex/) модели и их применение к данным, хранящимся в ClickHouse.
-   Добавлена поддержка часовых поясов с нецелочисленными смещениями от UTC.
-   Добавлена поддержка арифметических операций с временными интервалами.
-   Диапазон значений для типов Date и DateTime расширен до 2105 года.
-   Добавил тот `CREATE MATERIALIZED VIEW x TO y` запрос (указывает существующую таблицу для хранения данных материализованного представления).
-   Добавил тот `ATTACH TABLE` запрос без аргументов.
-   Логика обработки вложенных столбцов с именами, оканчивающимися на-Map в таблице SummingMergeTree, была извлечена в агрегатную функцию sumMap. Теперь вы можете указать такие столбцы явно.
-   Максимальный размер словаря IP trie увеличен до 128 миллионов записей.
-   Добавлена функция getSizeOfEnumType.
-   Добавлена агрегатная функция sumWithOverflow.
-   Добавлена поддержка формата ввода Cap'n Proto.
-   Теперь вы можете настроить уровень сжатия при использовании алгоритма zstd.

#### Назад несовместимые изменения: {#backward-incompatible-changes}

-   Создание временных таблиц с движком, отличным от памяти, не допускается.
-   Явное создание таблиц с помощью движка View или MaterializedView не допускается.
-   Во время создания таблицы новая проверка проверяет, что выражение ключа выборки включено в первичный ключ.

#### Устранение ошибок: {#bug-fixes}

-   Исправлены зависания при синхронной вставке в распределенную таблицу.
-   Исправлено неатомное добавление и удаление деталей в реплицируемых таблицах.
-   Данные, вставленные в материализованное представление, не подвергаются ненужной дедупликации.
-   Выполнение запроса к распределенной таблице, для которой локальная реплика отстает, а удаленные реплики недоступны, больше не приводит к ошибке.
-   Пользователям не нужны разрешения на доступ к `default` база данных для создания временных таблиц больше не существует.
-   Исправлен сбой при указании типа массива без аргументов.
-   Исправлены зависания, когда дисковый том, содержащий журналы сервера, заполнен.
-   Исправлено переполнение в функции toRelativeWeekNum для первой недели эпохи Unix.

#### Улучшения сборки: {#build-improvements}

-   Несколько сторонних библиотек (особенно Poco) были обновлены и преобразованы в подмодули git.

### ClickHouse релиз 1.1.54304, 2017-10-19 {#clickhouse-release-1-1-54304-2017-10-19}

#### Новые средства: {#new-features-1}

-   Поддержка TLS в собственном протоколе (чтобы включить, установите `tcp_ssl_port` в `config.xml` ).

#### Устранение ошибок: {#bug-fixes-1}

-   `ALTER` для реплицированных таблиц теперь пытается начать работать как можно скорее.
-   Исправлен сбой при чтении данных с настройкой `preferred_block_size_bytes=0.`
-   Исправлены сбои в работе `clickhouse-client` при нажатии на кнопку `Page Down`
-   Правильная интерпретация некоторых сложных запросов с помощью `GLOBAL IN` и `UNION ALL`
-   `FREEZE PARTITION` теперь он всегда работает атомарно.
-   Пустые почтовые запросы теперь возвращают ответ с кодом 411.
-   Исправлены ошибки интерпретации таких выражений, как `CAST(1 AS Nullable(UInt8)).`
-   Исправлена ошибка при чтении `Array(Nullable(String))` колонки от `MergeTree` таблицы.
-   Исправлен сбой при разборе таких запросов, как `SELECT dummy AS dummy, dummy AS b`
-   Пользователи обновляются правильно с недопустимым `users.xml`
-   Правильная обработка, когда исполняемый словарь возвращает ненулевой код ответа.

### ClickHouse релиз 1.1.54292, 2017-09-20 {#clickhouse-release-1-1-54292-2017-09-20}

#### Новые средства: {#new-features-2}

-   Добавил тот `pointInPolygon` функция для работы с координатами на координатной плоскости.
-   Добавил тот `sumMap` агрегатная функция для вычисления суммы массивов, аналогичная `SummingMergeTree`.
-   Добавил тот `trunc` функция. Улучшена производительность функций округления (`round`, `floor`, `ceil`, `roundToExp2`) и скорректировал логику их работы. Поменялась логика игры `roundToExp2` функция для дробей и отрицательных чисел.
-   Исполняемый файл ClickHouse теперь меньше зависит от версии libc. Один и тот же исполняемый файл ClickHouse может работать на самых разных системах Linux. Существует еще зависимость при использовании скомпилированных запросов (с настройкой `compile = 1` , который не используется по умолчанию).
-   Сократилось время, необходимое для динамической компиляции запросов.

#### Устранение ошибок: {#bug-fixes-2}

-   Исправлена ошибка, которая иногда производилась `part ... intersects previous part` сообщения и ослабленная согласованность реплик.
-   Исправлена ошибка, из-за которой сервер блокировался, если ZooKeeper был недоступен во время завершения работы.
-   Удалено избыточное ведение журнала при восстановлении реплик.
-   Исправлена ошибка в объединении всех реализаций.
-   Исправлена ошибка в функции concat, возникшая, если первый столбец в блоке имеет тип массива.
-   Прогресс теперь отображается в системе правильно.таблица слияний.

### ClickHouse релиз 1.1.54289, 2017-09-13 {#clickhouse-release-1-1-54289-2017-09-13}

#### Новые средства: {#new-features-3}

-   `SYSTEM` запросы для администрирования сервера: `SYSTEM RELOAD DICTIONARY`, `SYSTEM RELOAD DICTIONARIES`, `SYSTEM DROP DNS CACHE`, `SYSTEM SHUTDOWN`, `SYSTEM KILL`.
-   Добавлены функции для работы с массивами: `concat`, `arraySlice`, `arrayPushBack`, `arrayPushFront`, `arrayPopBack`, `arrayPopFront`.
-   Добавлен `root` и `identity` параметры для конфигурации ZooKeeper. Это позволяет изолировать отдельных пользователей в одном кластере ZooKeeper.
-   Добавлены статистические функции `groupBitAnd`, `groupBitOr`, и `groupBitXor` (для совместимости они также доступны под названиями `BIT_AND`, `BIT_OR`, и `BIT_XOR`).
-   Внешние словари можно загрузить из MySQL, указав сокет в файловой системе.
-   Внешние словари могут быть загружены из MySQL по протоколу SSL (`ssl_cert`, `ssl_key`, `ssl_ca` параметры).
-   Добавил тот `max_network_bandwidth_for_user` настройка для ограничения общего использования полосы пропускания для запросов на одного пользователя.
-   Поддержка `DROP TABLE` для временных таблиц.
-   Поддержка чтения `DateTime` значения в формате временных меток Unix от `CSV` и `JSONEachRow` форматы.
-   Запаздывающие реплики в распределенных запросах теперь исключаются по умолчанию (пороговое значение по умолчанию-5 минут).
-   Блокировка FIFO используется во время ALTER: запрос ALTER не блокируется бесконечно для непрерывно выполняемых запросов.
-   Возможность установки `umask` в конфигурационном файле.
-   Улучшенная производительность для запросов с помощью `DISTINCT` .

#### Устранение ошибок: {#bug-fixes-3}

-   Улучшен процесс удаления старых узлов в ZooKeeper. Раньше старые узлы иногда не удалялись, если были очень частые вставки, что приводило к медленному завершению работы сервера, среди прочего.
-   Исправлена рандомизация при выборе хостов для подключения к ZooKeeper.
-   Исправлено исключение запаздывающих реплик в распределенных запросах, если реплика является localhost.
-   Исправлена ошибка, когда часть данных в a `ReplicatedMergeTree` стол может быть сломан после запуска `ALTER MODIFY` на элементе в `Nested` структура.
-   Исправлена ошибка, которая могла привести к тому, что запросы SELECT «hang».
-   Улучшения в распределенных DDL-запросах.
-   Исправлен запрос `CREATE TABLE ... AS <materialized view>`.
-   Разрешен тупик в работе `ALTER ... CLEAR COLUMN IN PARTITION` запрос для `Buffer` таблицы.
-   Исправлено недопустимое значение по умолчанию для `Enum` s (0 вместо минимума) при использовании `JSONEachRow` и `TSKV` форматы.
-   Разрешен внешний вид зомби-процессов при использовании словаря с помощью `executable` источник.
-   Исправлена обработка выхода онлайн / оффлайн для запроса.

#### Улучшен рабочий процесс разработки и сборки ClickHouse: {#improved-workflow-for-developing-and-assembling-clickhouse}

-   Вы можете использовать `pbuilder` чтобы построить ClickHouse.
-   Вы можете использовать `libc++` вместо `libstdc++` для сборок на Linux.
-   Добавлены инструкции по использованию инструментов статического анализа кода: `Coverage`, `clang-tidy`, `cppcheck`.

#### Пожалуйста, обратите внимание при обновлении: {#please-note-when-upgrading}

-   Теперь существует более высокое значение по умолчанию для параметра MergeTree `max_bytes_to_merge_at_max_space_in_pool` (максимальный общий размер частей данных для слияния, в байтах): он увеличился со 100 гигабайт до 150 гигабайт. Это может привести к большим слияниям, выполняемым после обновления сервера, что может привести к увеличению нагрузки на дисковую подсистему. Если свободное пространство, доступное на сервере, меньше чем в два раза общего объема выполняемых слияний, это приведет к остановке всех других слияний, включая слияния небольших частей данных. В результате запросы INSERT завершатся ошибкой с сообщением «Merges are processing significantly slower than inserts.» Используйте `SELECT * FROM system.merges` запрос на мониторинг ситуации. Вы также можете проверить следующее: `DiskSpaceReservedForMerge` метрика в системе `system.metrics` таблица, или в графите. Вам не нужно ничего делать, чтобы исправить это, так как проблема будет решена сама собой, как только большие слияния закончатся. Если вы сочтете это неприемлемым, вы можете восстановить предыдущее значение для `max_bytes_to_merge_at_max_space_in_pool` установка. Чтобы сделать это, перейдите в раздел <merge_tree> раздел в конфигурации.xml, набор ``` <merge_tree>``<max_bytes_to_merge_at_max_space_in_pool>107374182400</max_bytes_to_merge_at_max_space_in_pool> ``` и перезагрузите сервер.

### ClickHouse релиз 1.1.54284, 2017-08-29 {#clickhouse-release-1-1-54284-2017-08-29}

-   Это исправленный выпуск для предыдущей версии 1.1.54282. Он исправляет утечки в каталоге запчастей в ZooKeeper.

### ClickHouse релиз 1.1.54282, 2017-08-23 {#clickhouse-release-1-1-54282-2017-08-23}

Этот выпуск содержит исправления ошибок для предыдущей версии 1.1.54276:

-   Исправлено `DB::Exception: Assertion violation: !_path.empty()` при вставке в распределенную таблицу.
-   Исправлен синтаксический анализ при вставке в формат RowBinary, если входные данные начинаются с';'.
-   Errors during runtime compilation of certain aggregate functions (e.g. `groupArray()`).

### Clickhouse Релиз 1.1.54276, 2017-08-16 {#clickhouse-release-1-1-54276-2017-08-16}

#### Новые средства: {#new-features-4}

-   Добавлен дополнительный раздел для запроса SELECT. Пример запроса: `WITH 1+1 AS a SELECT a, a*a`
-   Вставка может быть выполнена синхронно в распределенной таблице: OK возвращается только после того, как все данные сохранены на всех осколках. Это активируется установкой insert\_distributed\_sync=1.
-   Добавлен тип данных UUID для работы с 16-байтовыми идентификаторами.
-   Добавлены псевдонимы CHAR, FLOAT и других типов для совместимости с таблицей.
-   Добавлены функции toYYYYMM, toYYYYMMDD и toYYYYMMDDhhmmss для преобразования времени в числа.
-   Вы можете использовать IP-адреса (вместе с именем хоста) для идентификации серверов для кластеризованных запросов DDL.
-   Добавлена поддержка непостоянных аргументов и отрицательных смещений в функции `substring(str, pos, len).`
-   Добавлен параметр max\_size для `groupArray(max_size)(column)` агрегатная функция и оптимизированная ее производительность.

#### Основное изменение: {#main-changes}

-   Улучшения безопасности: все файлы сервера создаются с разрешениями 0640 (могут быть изменены с помощью <umask> параметр config).
-   Улучшены сообщения об ошибках для запросов с неверным синтаксисом.
-   Значительно сокращается потребление памяти и повышается производительность при слиянии больших разделов данных MergeTree.
-   Значительно повысилась производительность слияний данных для заменяющего движка Mergetree.
-   Улучшена производительность асинхронных вставок из распределенной таблицы за счет объединения нескольких исходных вставок. Чтобы включить эту функцию, используйте параметр distributed\_directory\_monitor\_batch\_inserts=1.

#### Назад несовместимые изменения: {#backward-incompatible-changes-1}

-   Изменен двоичный формат агрегатных состояний `groupArray(array_column)` функции для массивов.

#### Полный список изменений: {#complete-list-of-changes}

-   Добавил тот `output_format_json_quote_denormals` настройка, которая позволяет выводить значения nan и inf в формате JSON.
-   Оптимизировано распределение потока при чтении из распределенной таблицы.
-   Настройки можно настроить в режиме только для чтения, если значение не изменяется.
-   Добавлена возможность извлечения нецелочисленных гранул движка MergeTree для выполнения ограничений на размер блока, указанных в параметре preferred\_block\_size\_bytes. Цель состоит в том, чтобы уменьшить потребление оперативной памяти и увеличить локальность кэша при обработке запросов из таблиц с большими столбцами.
-   Эффективное использование индексов, содержащих такие выражения, как `toStartOfHour(x)` для таких условий, как `toStartOfHour(x) op сonstexpr.`
-   Добавлены новые настройки для движков MergeTree (раздел merge\_tree в config.XML):
    -   replicated\_deduplication\_window\_seconds задает количество секунд, разрешенных для дедуплицирующих вставок в реплицируемые таблицы.
    -   cleanup\_delay\_period устанавливает, как часто нужно запустить программу очистки, чтобы удалить устаревшие данные.
    -   replicated\_can\_become\_leader может препятствовать тому, чтобы реплика становилась лидером (и назначала слияния).
-   Ускоренная очистка для удаления устаревших данных из ZooKeeper.
-   Множество улучшений и исправлений для кластеризованных DDL-запросов. Особый интерес представляет новая настройка distributed\_ddl\_task\_timeout, которая ограничивает время ожидания ответа от серверов в кластере. Если запрос ddl не был выполнен на всех хостах, ответ будет содержать ошибку таймаута, и запрос будет выполнен в асинхронном режиме.
-   Улучшено отображение трассировок стека в журналах сервера.
-   Добавил тот «none» значение для метода сжатия.
-   Вы можете использовать несколько разделов dictionaries\_config в config.XML.
-   Можно подключиться к MySQL через сокет в файловой системе.
-   Система.в таблице деталей появился новый столбец с информацией о размере меток, в байтах.

#### Устранение ошибок: {#bug-fixes-4}

-   Распределенные таблицы, использующие таблицу слияния, теперь корректно работают для запроса SELECT с условием на `_table` поле.
-   Исправлено редкое состояние гонки в ReplicatedMergeTree при проверке частей данных.
-   Исправлена возможная заморозка на «leader election» при запуске сервера.
-   Параметр max\_replica\_delay\_for\_distributed\_queries был проигнорирован при использовании локальной реплики источника данных. Это было исправлено.
-   Исправлено некорректное поведение `ALTER TABLE CLEAR COLUMN IN PARTITION` при попытке очистить несуществующий столбец.
-   Исправлено исключение в функции multif при использовании пустых массивов или строк.
-   Исправлено чрезмерное выделение памяти при десериализации собственного формата.
-   Исправлено некорректное автоматическое обновление словарей Trie.
-   Исправлено исключение при выполнении запросов с предложением GROUP BY из таблицы слияния при использовании SAMPLE.
-   Исправлена ошибка, из группы при использовании distributed\_aggregation\_memory\_efficient=1.
-   Теперь вы можете указать базу данных.таблицы в правой стороне и присоединиться.
-   Слишком много потоков было использовано для параллельной агрегации. Это было исправлено.
-   Исправлено как то «if» функция работает с аргументами FixedString.
-   Выберите из распределенной таблицы неправильно сработавшие осколки с весом 0. Это было исправлено.
-   Бегущий `CREATE VIEW IF EXISTS no longer causes crashes.`
-   Исправлено некорректное поведение при установке input\_format\_skip\_unknown\_fields=1 и наличии отрицательных чисел.
-   Исправлен бесконечный цикл в `dictGetHierarchy()` функция, если в словаре есть какие-то недопустимые данные.
-   Исправлено `Syntax error: unexpected (...)` ошибки при выполнении распределенных запросов с вложенными запросами в предложении IN или JOIN и таблицах слияния.
-   Исправлена неправильная интерпретация запроса SELECT из таблиц справочника.
-   Исправлена ошибка «Cannot mremap» ошибка при использовании массивов в предложениях IN и JOIN с более чем 2 миллиардами элементов.
-   Исправлена ошибка отработки отказа для словарей с MySQL в качестве источника.

#### Улучшен рабочий процесс разработки и сборки ClickHouse: {#improved-workflow-for-developing-and-assembling-clickhouse-1}

-   Сборки могут быть собраны в Аркадии.
-   Вы можете использовать gcc 7 для компиляции ClickHouse.
-   Параллельные сборки с использованием ccache+distcc теперь работают быстрее.

### ClickHouse релиз 1.1.54245, 2017-07-04 {#clickhouse-release-1-1-54245-2017-07-04}

#### Новые средства: {#new-features-5}

-   Распределенный DDL (например, `CREATE TABLE ON CLUSTER`)
-   Реплицированный запрос `ALTER TABLE CLEAR COLUMN IN PARTITION.`
-   Движок для таблиц словаря (доступ к данным словаря в виде таблицы).
-   Компонент Dictionary database engine (этот тип базы данных автоматически содержит таблицы словарей, доступные для всех подключенных внешних словарей).
-   Вы можете проверить наличие обновлений в словаре, отправив запрос источнику.
-   Полные имена столбцов
-   Цитирование идентификаторов с использованием двойных кавычек.
-   Сеансы в интерфейсе HTTP.
-   Запрос оптимизации для реплицированной таблицы может выполняться не только на лидере.

#### Назад несовместимые изменения: {#backward-incompatible-changes-2}

-   Удалить набор глобальных.

#### Несущественные изменения: {#minor-changes}

-   Теперь после срабатывания предупреждения журнал печатает полную трассировку стека.
-   Ослаблена проверка количества поврежденных / лишних частей данных при запуске (было слишком много ложных срабатываний).

#### Устранение ошибок: {#bug-fixes-5}

-   Исправлена плохая связь «sticking» при вставке в распределенную таблицу.
-   GLOBAL IN теперь работает для запроса из таблицы слияния, которая смотрит на распределенную таблицу.
-   Неверное количество ядер было обнаружено на виртуальной машине Google Compute Engine. Это было исправлено.
-   Изменения в том, как работает исполняемый источник кэшированных внешних словарей.
-   Исправлено сравнение строк, содержащих нулевые символы.
-   Исправлено сравнение полей первичного ключа Float32 с константами.
-   Ранее неверная оценка размера поля могла привести к чрезмерно большим распределениям.
-   Исправлена ошибка, при отправке запроса столбец допускает значения NULL в таблицу с помощью инструкции Alter.
-   Исправлена ошибка при сортировке по нулевому столбцу, если количество строк меньше предельного.
-   Исправлен порядок по подзапросу, состоящему только из постоянных значений.
-   Ранее реплицированная таблица могла оставаться в недопустимом состоянии после неудачного удаления таблицы.
-   Псевдонимы для скалярных подзапросов с пустыми результатами больше не теряются.
-   Теперь запрос, который использовал компиляцию, не завершается ошибкой, если файл .so поврежден.
