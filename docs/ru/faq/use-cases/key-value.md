---
title: Можно ли использовать ClickHouse как хранилище вида "ключ-значение"?
toc_hidden: true
toc_priority: 101
---

# Можно ли использовать ClickHouse как хранилище вида "ключ-значение"? {#can-i-use-clickhouse-as-a-key-value-storage}

Если отвечать коротко, то **"нет"**. Причем рабочий поток, относящийся к виду "ключ-значение", занимает одну из верхних позиций в списке, когда категорически **не стоит**{.text-danger} пользоваться ClickHouse. К тому же, это ведь [OLAP](../../faq/general/olap.md)-система, в то время как есть много систем хранения вида "ключ-значение".

Тем не менее, могут быть такие ситуации, когда есть смысл пользоваться ClickHouse для запросов формата "ключ-значение". Обычно это относится к некоторым низкобюджетным продуктам, в которых основная нагрузка носит аналитический характер и неплохо совмещается с ClickHouse. Тем не менее, тут есть некоторый второстепенный процесс, которому нужен патерн "ключ-значение" с не слишком высокой проходимостью запросов и без строгих требований к задержкам. Если у вас неограниченный бюджет, вы можете установить вспомогательную базу данных "ключ-значение" для подобной дополнительной загрузки, но в действительности, это повышает расходы на поддержку еще одной системы хранения (мониторинга, бэкапов и т.д.). Подумайте, возможно, стоит избежать этого.

Если вы решите не следовать рекомендациям и выполнить некоторые запросы, похожие на "ключ-значение", вот несколько советов:

-   Главная причина, почему точечные запросы такие дорогие в ClickHouse — это его is its sparse primary index of main [MergeTree table engine family](../../engines/table-engines/mergetree-family/mergetree.md). Этот индекс не может обращаться к каждой отдельной строке данных, вместо этого он обращается к каждой N-ой и система должна сканировать промежуток от соседних строк к указанной, проходя по лишним данным по пути. В сценарии "ключ-значение" может быть полезно уменшать значение N при помощи настройки `index_granularity`.
-   ClickHouse хранит каждый столбец в отдельном наборе файлов, так чтобы собрать одну полную строку, необходимо пройти по каждому из этих файлов. Их количество растет линейно в зависимости от количества столбцов, так что по сценарию "ключ-значение", стоит избегать использования множества столбцов и поместить весь ваш поток загрузки в единичный столбец с типом `String`, запрограммированный в некоторый формат сериализации, например, как JSON, Protobuf или любой другой подходящий.
-   Существует альтернативный подход, в котором используется табличный движок [Join](../../engines/table-engines/special/join.md) вместо обычных таблиц `MergeTree` и функции [joinGet](../../sql-reference/functions/other-functions.md#joinget) для восстановления данных. В этом случае производительность по запросам может быть лучше, но при этом могут появиться проблемы в надежности и удобстве использования. Вот [пример использования](https://github.com/ClickHouse/ClickHouse/blob/master/tests/queries/0_stateless/00800_versatile_storage_join.sql#L49-L51).
