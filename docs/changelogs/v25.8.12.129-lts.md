---
sidebar_position: 1
sidebar_label: 2025
---

# 2025 Changelog

### ClickHouse release v25.8.12.129-lts (25db09bd0a0) FIXME as compared to v25.8.11.66-lts (fa393206741)

#### Performance Improvement
* Backported in [#90369](https://github.com/ClickHouse/ClickHouse/issues/90369): Enable saving marks in cache and avoid direct IO for the MergeTreeLazy reader. [#87989](https://github.com/ClickHouse/ClickHouse/pull/87989) ([Nikita Taranov](https://github.com/nickitat)).
* Backported in [#89502](https://github.com/ClickHouse/ClickHouse/issues/89502): Queries can now benefit from optimize_read_in_order and query_plan_optimize_lazy_materialization simultaneously. Resolves [#88767](https://github.com/ClickHouse/ClickHouse/issues/88767). [#88866](https://github.com/ClickHouse/ClickHouse/pull/88866) ([Manuel](https://github.com/raimannma)).

#### Improvement
* Backported in [#89421](https://github.com/ClickHouse/ClickHouse/issues/89421): Subqueries which take part inside IN expressions when querying Iceberg table will be precomputed in the right way before partition pruning analysis. [#89177](https://github.com/ClickHouse/ClickHouse/pull/89177) ([Daniil Ivanik](https://github.com/divanik)).
* Backported in [#90070](https://github.com/ClickHouse/ClickHouse/issues/90070): Fix wrong `FilesystemCacheBytes` (and others) in `system.asynchronous_metrics`. Run `SYSTEM` queries on filesystem caches only once. Atomic view for caches that points to the same path in `system.filesystem_caches`. [#89640](https://github.com/ClickHouse/ClickHouse/pull/89640) ([Azat Khuzhin](https://github.com/azat)).
* Backported in [#90169](https://github.com/ClickHouse/ClickHouse/issues/90169): Changed default of filesystem cache setting `keep_free_space_remove_batch` from 10 to 100, because it is more optimal. [#90030](https://github.com/ClickHouse/ClickHouse/pull/90030) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Backported in [#90350](https://github.com/ClickHouse/ClickHouse/issues/90350): Use lower node limit for RemoveRecursive Keeper request during S3Queue cleanup. [#90201](https://github.com/ClickHouse/ClickHouse/pull/90201) ([Antonio Andelic](https://github.com/antonio2368)).
* Backported in [#90710](https://github.com/ClickHouse/ClickHouse/issues/90710): Retry network errors when S3 library parses XML response. [#90216](https://github.com/ClickHouse/ClickHouse/pull/90216) ([Sema Checherinda](https://github.com/CheSema)).
* Backported in [#90774](https://github.com/ClickHouse/ClickHouse/issues/90774): Update warning messages when approaching guardrails limits: show current and throw values. [#90438](https://github.com/ClickHouse/ClickHouse/pull/90438) ([Nikita Fomichev](https://github.com/fm4v)).

#### Bug Fix (user-visible misbehavior in an official stable release)
* Backported in [#89991](https://github.com/ClickHouse/ClickHouse/issues/89991): Fix creating an array of empty tuples. [#87520](https://github.com/ClickHouse/ClickHouse/pull/87520) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#88690](https://github.com/ClickHouse/ClickHouse/issues/88690): Don't remove injective functions from GROUP BY if arguments types are not allowed in GROUP BY. [#87958](https://github.com/ClickHouse/ClickHouse/pull/87958) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#89574](https://github.com/ClickHouse/ClickHouse/issues/89574): Fix reading mixed array of Floats and Bools in JSON. Previously inserting such data led to an exception. [#88008](https://github.com/ClickHouse/ClickHouse/pull/88008) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#89277](https://github.com/ClickHouse/ClickHouse/issues/89277): Using shared_ptr for QueryState in TCPHandler to detect if the state is invalid in setProgressCallback, setFileProgressCallback and setBlockMarshallingCallback. [#88201](https://github.com/ClickHouse/ClickHouse/pull/88201) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Backported in [#89237](https://github.com/ClickHouse/ClickHouse/issues/89237): Fix SQL SECURITY DEFINER with *cluster functions. [#88588](https://github.com/ClickHouse/ClickHouse/pull/88588) ([Julian Maicher](https://github.com/jmaicher)).
* Backported in [#88732](https://github.com/ClickHouse/ClickHouse/issues/88732): A `Poco::TimeoutException` exception thrown from `Poco::Net::HTTPChunkedStreamBuf::readFromDevice` leads to a crash with SIGABRT. [#88668](https://github.com/ClickHouse/ClickHouse/pull/88668) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Backported in [#89442](https://github.com/ClickHouse/ClickHouse/issues/89442): Fix possible "Context has expired" with new analyzer with subqueries. [#88694](https://github.com/ClickHouse/ClickHouse/pull/88694) ([Azat Khuzhin](https://github.com/azat)).
* Backported in [#89462](https://github.com/ClickHouse/ClickHouse/issues/89462): Fix propagation of size restrictions by settings max_table_size_to_drop and max_partition_size_to_drop on DROP of inner tables. [#88812](https://github.com/ClickHouse/ClickHouse/pull/88812) ([Nikolay Degterinsky](https://github.com/evillique)).
* Backported in [#90296](https://github.com/ClickHouse/ClickHouse/issues/90296): Fixed performance degradation in analysis of skipping indexes. [#89004](https://github.com/ClickHouse/ClickHouse/pull/89004) ([Anton Popov](https://github.com/CurtizJ)).
* Backported in [#89291](https://github.com/ClickHouse/ClickHouse/issues/89291): Fix ACCESS_ENTITY_NOT_FOUND error when trying to execute clusterAllReplicas from a user with a non-existing role. Resolves [#87670](https://github.com/ClickHouse/ClickHouse/issues/87670). [#89068](https://github.com/ClickHouse/ClickHouse/pull/89068) ([pufit](https://github.com/pufit)).
* Backported in [#89322](https://github.com/ClickHouse/ClickHouse/issues/89322): Fix calculation of buffer size needed for base32/base58 encoding and decoding operations. [#89133](https://github.com/ClickHouse/ClickHouse/pull/89133) ([Antonio Andelic](https://github.com/antonio2368)).
* Backported in [#89347](https://github.com/ClickHouse/ClickHouse/issues/89347): Avoid possible data-races due to mutable exceptions while parsing Parquet. Fixes [#88385](https://github.com/ClickHouse/ClickHouse/issues/88385). [#89174](https://github.com/ClickHouse/ClickHouse/pull/89174) ([Azat Khuzhin](https://github.com/azat)).
* Backported in [#89264](https://github.com/ClickHouse/ClickHouse/issues/89264): Refreshable materialized view: fixed rare server crash if source table was fully dropped during a refresh. [#89203](https://github.com/ClickHouse/ClickHouse/pull/89203) ([Michael Kolupaev](https://github.com/al13n321)).
* Backported in [#89483](https://github.com/ClickHouse/ClickHouse/issues/89483): Fixed incorrect merge handling of TTL-emptied parts with non-empty projections when using `deduplicate_merge_projection_mode='ignore'`. Resolves [#89430](https://github.com/ClickHouse/ClickHouse/issues/89430). [#89458](https://github.com/ClickHouse/ClickHouse/pull/89458) ([Amos Bird](https://github.com/amosbird)).
* Backported in [#89566](https://github.com/ClickHouse/ClickHouse/issues/89566): Fix reading of changelogs during Keeper startup in cases a changelog was not renamed properly during rotation. [#89496](https://github.com/ClickHouse/ClickHouse/pull/89496) ([Antonio Andelic](https://github.com/antonio2368)).
* Backported in [#89629](https://github.com/ClickHouse/ClickHouse/issues/89629): Fix incorrect JOIN results when using OR conditions with unique right table keys. Resolves [#89391](https://github.com/ClickHouse/ClickHouse/issues/89391). [#89512](https://github.com/ClickHouse/ClickHouse/pull/89512) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Backported in [#89591](https://github.com/ClickHouse/ClickHouse/issues/89591): Fix possible "Context has expired" with analyzer and PK IN (subquery) (v2). Fixes [#89433](https://github.com/ClickHouse/ClickHouse/issues/89433). [#89527](https://github.com/ClickHouse/ClickHouse/pull/89527) ([Azat Khuzhin](https://github.com/azat)).
* Backported in [#89684](https://github.com/ClickHouse/ClickHouse/issues/89684): Fix a crash in case if a state of an aggregate function contains a serialized value of a column of LowCardinality(String). [#89550](https://github.com/ClickHouse/ClickHouse/pull/89550) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#90735](https://github.com/ClickHouse/ClickHouse/issues/90735): Avoid crash due to reading from remote server after disconnect in remote queries during cancellation. Resolves [#89468](https://github.com/ClickHouse/ClickHouse/issues/89468). [#89740](https://github.com/ClickHouse/ClickHouse/pull/89740) ([Azat Khuzhin](https://github.com/azat)).
* Backported in [#89857](https://github.com/ClickHouse/ClickHouse/issues/89857): Fix possible logical error during reading of paths and their subcolumns in advanced JSON shared data serialization. Closes [#89805](https://github.com/ClickHouse/ClickHouse/issues/89805). [#89819](https://github.com/ClickHouse/ClickHouse/pull/89819) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#90189](https://github.com/ClickHouse/ClickHouse/issues/90189): Fix possible stack overflow in data types binary deserialization. Closes [#88710](https://github.com/ClickHouse/ClickHouse/issues/88710). [#89822](https://github.com/ClickHouse/ClickHouse/pull/89822) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#89900](https://github.com/ClickHouse/ClickHouse/issues/89900): Fix logical error with empty tuple inside `IN` function. Closes [#88343](https://github.com/ClickHouse/ClickHouse/issues/88343). [#89850](https://github.com/ClickHouse/ClickHouse/pull/89850) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Backported in [#89890](https://github.com/ClickHouse/ClickHouse/issues/89890): Remove injective functions from `GROUP BY` regardless `optimize_injective_functions_in_group_by` in old analyzer for compatibility. Resolves [#89854](https://github.com/ClickHouse/ClickHouse/issues/89854). [#89870](https://github.com/ClickHouse/ClickHouse/pull/89870) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Backported in [#90213](https://github.com/ClickHouse/ClickHouse/issues/90213): If the merge was interrupted by, for example, a memory limit, the merge mutate background executor will call `cancel` on the merge task without a lock, but, in this case, the partially created resulting part will not be removed (since it was not finished and at this stage was not visible). After that, the merge task will be destroyed, which will trigger the destruction of the resulting part. This will revert the disk transaction and cause the data to be removed from S3. At the end, this garbage cleanup was executed under the merge mutate background executor lock. [#89875](https://github.com/ClickHouse/ClickHouse/pull/89875) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Backported in [#89933](https://github.com/ClickHouse/ClickHouse/issues/89933): Fix logical error with empty tuple inside `reverse` and `CAST` function. Closes [#89137](https://github.com/ClickHouse/ClickHouse/issues/89137). [#89908](https://github.com/ClickHouse/ClickHouse/pull/89908) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Backported in [#89961](https://github.com/ClickHouse/ClickHouse/issues/89961): Fix using native copy on GCS for backups. Because of incorrect client cloning, GCS native copy always failed and used less optimal approach of manual reading and writing the data. [#89923](https://github.com/ClickHouse/ClickHouse/pull/89923) ([Antonio Andelic](https://github.com/antonio2368)).
* Backported in [#90035](https://github.com/ClickHouse/ClickHouse/issues/90035): Fix buffer size calculation for base32Encode. Calculating base32Encode for column of strings of size smaller than 5 could lead to crashes. Resolves [#89911](https://github.com/ClickHouse/ClickHouse/issues/89911). [#89929](https://github.com/ClickHouse/ClickHouse/pull/89929) ([Antonio Andelic](https://github.com/antonio2368)).
* Backported in [#90105](https://github.com/ClickHouse/ClickHouse/issues/90105): Fix wrong escaping for `SHOW COLUMNS` and `SHOW FUNCTIONS` queries. [#89942](https://github.com/ClickHouse/ClickHouse/pull/89942) ([alesapin](https://github.com/alesapin)).
* Backported in [#90354](https://github.com/ClickHouse/ClickHouse/issues/90354): Fix URL validation in MongoDB engine when username contains '@' character. Previously, usernames with '@' would cause an error due to improper encoding. [#89970](https://github.com/ClickHouse/ClickHouse/pull/89970) ([Kai Zhu](https://github.com/nauu)).
* Backported in [#90086](https://github.com/ClickHouse/ClickHouse/issues/90086): Fix logical error caused by empty tuple column in `BSONEachRow` and `MsgPack`. Closes [#89814](https://github.com/ClickHouse/ClickHouse/issues/89814). Closes [#71536](https://github.com/ClickHouse/ClickHouse/issues/71536). [#90018](https://github.com/ClickHouse/ClickHouse/pull/90018) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Backported in [#90501](https://github.com/ClickHouse/ClickHouse/issues/90501): Do size checks when deserializing data from aggregation states and other sources. [#90031](https://github.com/ClickHouse/ClickHouse/pull/90031) ([Raúl Marín](https://github.com/Algunenano)).
* Backported in [#90181](https://github.com/ClickHouse/ClickHouse/issues/90181): Allow files starting with dots in user_files. Closes [#89662](https://github.com/ClickHouse/ClickHouse/issues/89662). [#90079](https://github.com/ClickHouse/ClickHouse/pull/90079) ([Raúl Marín](https://github.com/Algunenano)).
* Backported in [#90308](https://github.com/ClickHouse/ClickHouse/issues/90308): Fix incorrect formatting of certain skip indexes in the table definition, causing `METADATA_MISMATCH` and breaking creation of new replicas in the Replicated Database. [#90251](https://github.com/ClickHouse/ClickHouse/pull/90251) ([Nikolay Degterinsky](https://github.com/evillique)).
* Backported in [#90619](https://github.com/ClickHouse/ClickHouse/issues/90619): Fix possible logical error in prewhere on non-existing JSON path with index_granularity_bytes=0. Resolves [#86924](https://github.com/ClickHouse/ClickHouse/issues/86924). [#90375](https://github.com/ClickHouse/ClickHouse/pull/90375) ([Pavel Kruglov](https://github.com/Avogar)).
* Backported in [#90703](https://github.com/ClickHouse/ClickHouse/issues/90703): Fixed a race condition in Hive partitioning where a static `KeyValuePairExtractor` caused data corruption or crashes during concurrent file reads. [#90474](https://github.com/ClickHouse/ClickHouse/pull/90474) ([Paresh Joshi](https://github.com/pareshjoshij)).

#### Build/Testing/Packaging Improvement
* Backported in [#90330](https://github.com/ClickHouse/ClickHouse/issues/90330): Bump `icu` from `release-75.1` to `release-78.1`. [#90060](https://github.com/ClickHouse/ClickHouse/pull/90060) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Backported in [#90234](https://github.com/ClickHouse/ClickHouse/issues/90234): Bump curl from 8.15.0 to 8.17.0. [#90061](https://github.com/ClickHouse/ClickHouse/pull/90061) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Backported in [#90227](https://github.com/ClickHouse/ClickHouse/issues/90227): Bump `libarchive` from 3.8.1 to 3.8.2. [#90062](https://github.com/ClickHouse/ClickHouse/pull/90062) ([Konstantin Bogdanov](https://github.com/thevar1able)).

#### NO CL ENTRY

* NO CL ENTRY:  'Revert "Backport [#89395](https://github.com/ClickHouse/ClickHouse/issues/89395) to 25.8: Revert "Do not perform PrimaryKeyExpand step if skip index is already part of primary key""'. [#89913](https://github.com/ClickHouse/ClickHouse/pull/89913) ([Shankar Iyer](https://github.com/shankar-iyer)).

#### NOT FOR CHANGELOG / INSIGNIFICANT

* Backported in [#89708](https://github.com/ClickHouse/ClickHouse/issues/89708): Allow to start ttl drop merge for parts of any size. [#86439](https://github.com/ClickHouse/ClickHouse/pull/86439) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Backported in [#90400](https://github.com/ClickHouse/ClickHouse/issues/90400): Unrevert "Fix key condition matches continuous range". [#86574](https://github.com/ClickHouse/ClickHouse/pull/86574) ([Michael Kolupaev](https://github.com/al13n321)).
* Backported in [#90567](https://github.com/ClickHouse/ClickHouse/issues/90567): Backporting function firstNonDefault. [#88441](https://github.com/ClickHouse/ClickHouse/pull/88441) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Backported in [#89156](https://github.com/ClickHouse/ClickHouse/issues/89156): Don't use metadata cache in iceberg history table. [#89003](https://github.com/ClickHouse/ClickHouse/pull/89003) ([scanhex12](https://github.com/scanhex12)).
* Backported in [#89147](https://github.com/ClickHouse/ClickHouse/issues/89147): Replace SchedulePool with a separate thread. [#89040](https://github.com/ClickHouse/ClickHouse/pull/89040) ([Daniil Ivanik](https://github.com/divanik)).
* Backported in [#89518](https://github.com/ClickHouse/ClickHouse/issues/89518): Fix potential heap-use-after-free in projections analysis after [#72102](https://github.com/ClickHouse/ClickHouse/issues/72102). [#89139](https://github.com/ClickHouse/ClickHouse/pull/89139) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Backported in [#89968](https://github.com/ClickHouse/ClickHouse/issues/89968): Only change S3Queue metadata in Keeper on the initial replica. [#89259](https://github.com/ClickHouse/ClickHouse/pull/89259) ([Nikolay Degterinsky](https://github.com/evillique)).
* Backported in [#89467](https://github.com/ClickHouse/ClickHouse/issues/89467): Revert "Do not perform PrimaryKeyExpand step if skip index is already part of primary key". [#89395](https://github.com/ClickHouse/ClickHouse/pull/89395) ([Shankar Iyer](https://github.com/shankar-iyer)).
* CI: Stateless tests 25.8 release branch. [#89644](https://github.com/ClickHouse/ClickHouse/pull/89644) ([Max Kainov](https://github.com/maxknv)).
* Backported in [#90047](https://github.com/ClickHouse/ClickHouse/issues/90047): Prevent false positive error on empty LowCardinality indexes. [#89680](https://github.com/ClickHouse/ClickHouse/pull/89680) ([Max Kainov](https://github.com/maxknv)).
* Backported in [#89789](https://github.com/ClickHouse/ClickHouse/issues/89789): Speed up test_refreshable_mv_skip_old_temp_table_ddls. [#89692](https://github.com/ClickHouse/ClickHouse/pull/89692) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Backported in [#90041](https://github.com/ClickHouse/ClickHouse/issues/90041): Let's collect all objects that need to be removed after the disk object storage transaction revert into a single removal batch to perform a single S3 interaction. [#89877](https://github.com/ClickHouse/ClickHouse/pull/89877) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Backported in [#90531](https://github.com/ClickHouse/ClickHouse/issues/90531): Add more diagnostic to logical error in JSON. [#90286](https://github.com/ClickHouse/ClickHouse/pull/90286) ([Pavel Kruglov](https://github.com/Avogar)).

