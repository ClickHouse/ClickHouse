---
slug: /ja/sql-reference/data-types/nested-data-structures/nested
sidebar_position: 57
sidebar_label: Nested(Name1 Type1, Name2 Type2, ...)
---

# Nested

## Nested(name1 Type1, Name2 Type2, ...)

ネストしたデータ構造は、セル内のテーブルのようなものです。ネストしたデータ構造のパラメータとして、カラムの名前と型が、[CREATE TABLE](../../../sql-reference/statements/create/table.md) クエリで指定するのと同様に指定されます。各テーブルの行は、ネストしたデータ構造の任意の数の行に対応できます。

例:

``` sql
CREATE TABLE test.visits
(
    CounterID UInt32,
    StartDate Date,
    Sign Int8,
    IsNew UInt8,
    VisitID UInt64,
    UserID UInt64,
    ...
    Goals Nested
    (
        ID UInt32,
        Serial UInt32,
        EventTime DateTime,
        Price Int64,
        OrderID String,
        CurrencyID UInt32
    ),
    ...
) ENGINE = CollapsingMergeTree(StartDate, intHash32(UserID), (CounterID, StartDate, intHash32(UserID), VisitID), 8192, Sign)
```

この例では、`Goals` ネストしたデータ構造を宣言しており、コンバージョン（達成された目標）に関するデータを含んでいます。‘visits’ テーブルの各行は、0 もしくは任意の数のコンバージョンに対応可能です。

[flatten_nested](../../../operations/settings/settings.md#flatten-nested) がデフォルトではない `0` に設定されている場合、任意のネストレベルがサポートされます。

通常、ネストしたデータ構造を扱う際には、そのカラムはドットで区切られたカラム名で指定されます。これらのカラムは一致する型の配列を構成しています。単一のネストしたデータ構造のすべてのカラム配列は同じ長さを持ちます。

例:

``` sql
SELECT
    Goals.ID,
    Goals.EventTime
FROM test.visits
WHERE CounterID = 101500 AND length(Goals.ID) < 5
LIMIT 10
```

``` text
┌─Goals.ID───────────────────────┬─Goals.EventTime───────────────────────────────────────────────────────────────────────────┐
│ [1073752,591325,591325]        │ ['2014-03-17 16:38:10','2014-03-17 16:38:48','2014-03-17 16:42:27']                       │
│ [1073752]                      │ ['2014-03-17 00:28:25']                                                                   │
│ [1073752]                      │ ['2014-03-17 10:46:20']                                                                   │
│ [1073752,591325,591325,591325] │ ['2014-03-17 13:59:20','2014-03-17 22:17:55','2014-03-17 22:18:07','2014-03-17 22:18:51'] │
│ []                             │ []                                                                                        │
│ [1073752,591325,591325]        │ ['2014-03-17 11:37:06','2014-03-17 14:07:47','2014-03-17 14:36:21']                       │
│ []                             │ []                                                                                        │
│ []                             │ []                                                                                        │
│ [591325,1073752]               │ ['2014-03-17 00:46:05','2014-03-17 00:46:05']                                             │
│ [1073752,591325,591325,591325] │ ['2014-03-17 13:28:33','2014-03-17 13:30:26','2014-03-17 18:51:21','2014-03-17 18:51:45'] │
└────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────┘
```

ネストしたデータ構造は、同じ長さの複数のカラム配列の集合と考えるのが最も簡単です。

SELECT クエリで、個々のカラムではなく、ネストしたデータ構造全体の名前を指定できる唯一の場所は ARRAY JOIN 句です。詳細は、「ARRAY JOIN 句」を参照してください。例:

``` sql
SELECT
    Goal.ID,
    Goal.EventTime
FROM test.visits
ARRAY JOIN Goals AS Goal
WHERE CounterID = 101500 AND length(Goals.ID) < 5
LIMIT 10
```

``` text
┌─Goal.ID─┬──────Goal.EventTime─┐
│ 1073752 │ 2014-03-17 16:38:10 │
│  591325 │ 2014-03-17 16:38:48 │
│  591325 │ 2014-03-17 16:42:27 │
│ 1073752 │ 2014-03-17 00:28:25 │
│ 1073752 │ 2014-03-17 10:46:20 │
│ 1073752 │ 2014-03-17 13:59:20 │
│  591325 │ 2014-03-17 22:17:55 │
│  591325 │ 2014-03-17 22:18:07 │
│  591325 │ 2014-03-17 22:18:51 │
│ 1073752 │ 2014-03-17 11:37:06 │
└─────────┴─────────────────────┘
```

ネストしたデータ構造全体に対して SELECT を実行することはできません。これに含まれる個々のカラムを明示的にリストすることしかできません。

INSERT クエリの場合、ネストしたデータ構造の構成要素カラム配列を個別に（まるで個々のカラム配列であるかのように）渡す必要があります。挿入時に、システムはこれらが同じ長さであることをチェックします。

DESCRIBE クエリでは、ネストしたデータ構造内のカラムは同様に個別にリストされます。

ネストしたデータ構造内の要素に対する ALTER クエリには制限があります。
