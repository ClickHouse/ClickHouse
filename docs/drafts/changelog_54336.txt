Новые возможности.

Добавлена поддержка хранения многомерных массивов и кортежей (тип данных `Tuple`) в таблицах.

Поддержка табличных функций для запросов `DESCRIBE` и `INSERT`. Поддержка подзапроса в запросе `DESCRIBE`. Примеры: `DESC TABLE remote('host', default.hits)`; `DESC TABLE (SELECT 1)`; `INSERT INTO TABLE FUNCTION remote('host', default.hits)`. Возможность писать `INSERT INTO TABLE` вместо `INSERT INTO`.

Улучшена поддержка часовых поясов. В типе `DateTime` может быть указана таймзона, которая используется для парсинга и отображения данных в текстовом виде. Пример: `DateTime('Europe/Moscow')`. При указании таймзоны в функциях работы с `DateTime`, тип возвращаемого значения будет запоминать таймзону, для того, чтобы значение отображалось ожидаемым образом.

Добавлены функции `toTimeZone`, `timeDiff`, `toQuarter`, `toRelativeQuarterNum`, `toStartOfFifteenMinutes`. В функцию `toRelativeHour`/`Minute`/`Second` можно передать аргумент типа `Date`. Имя функции `now` воспринимается без учёта регистра.

Добавлена программа `clickhouse format` для переформатирования запросов.

Добавлен конфигурационный параметр `format_schema_path`. Он используется для задания схемы для формата `Cap'n'Proto`. Файлы со схемой могут использоваться только из указанной директории.

Добавлена поддержка `incl` и `conf.d` подстановок для конфигурации словарей и моделей.

В таблице `system.settings` появилось описание большинства настроек.

Добавлена таблица `system.parts_columns`, содержащая информацию о размерах столбцов в каждом куске данных `MergeTree` таблиц.

Добавлена таблица `system.models`, содержащая информацию о загруженных моделях `CatBoost`.

Добавлены табличные функции `mysql` и `odbc` и соответствующие движки таблиц `MySQL`, `ODBC` для обращения к удалённым базам данных. Функциональность в состоянии "бета".

Для функции `groupArray` разрешено использование аргументов типа `AggregateFunction` (можно создать массив из состояний агрегатных функций).

Удалены ограничения на использование разных комбинаций комбинаторов агрегатных функций. Для примера, вы можете использовать как функцию `avgForEachIf`, так и `avgIfForEach`, которые имеют разный смысл.

Комбинатор агрегатных функций `-ForEach` расширен для случая агрегатных функций с более чем одним аргументом.

Добавлена поддержка агрегатных функций от `Nullable` аргументов, для случаев, когда функция всегда возвращает не `Nullable` результат. Пример: `groupArray`, `groupUniqArray`, `topK`.

Добавлен параметр командной строки `max_client_network_bandwidth` для `clickhouse-client`.

Пользователям с доступом `readonly = 2` разрешено работать с временными таблицами (CREATE, DROP, INSERT...)

Добавлена возможность указания количества consumers для `Kafka`.

Добавлены функции `intExp2`, `intExp10`.

Добавлена агрегатная функция `sumKahan`.

Увеличена производительность агрегатных функций `varSamp`, `varPop`, `stddevSamp`, `stddevPop`, `covarSamp`, `covarPop`, `corr` за счёт уменьшения стойкости к вычислительной погрешности. Старые версии функций добавлены под именами `varSampStable`, `varPopStable`, `stddevSampStable`, `stddevPopStable`, `covarSampStable`, `covarPopStable`, `corrStable`.

Добавлены функции to*Number*OrNull, где *Number* - числовой тип. 

Добавлена поддержка секции `WITH` для запроса `INSERT SELECT`.

Добавлены настройки `http_connection_timeout`, `http_send_timeout`, `http_receive_timeout`. Настройки используются, в том числе, при скачивании кусков для репликации. Изменение этих настроек позволяет сделать более быстрый failover в случае перегруженной сети.

Добавлена поддержка `ALTER` для таблиц типа `Null`.

Функция `reinterpretAsString` расширена на все типы данных, значения которых хранятся в памяти непрерывно.

Для программы `clickhouse-local` добавлена опция `--silent` для подавления вывода информации о выполнении запроса в stderr.

Добавлена поддержка чтения `Date` в текстовом виде в формате, где месяц и год могут быть указаны одной цифрой.


Увеличение производительности.

Увеличена производительность агрегатных функций `min`, `max`, `any`, `anyLast`, `anyHeavy`, `argMin`, `argMax` от строковых аргументов.
Увеличена производительность функций `isInfinite`, `isFinite`, `isNaN`, `roundToExp2`.
Увеличена производительность форматирования в текстовом виде и парсинга из текста значений типа `Date` и `DateTime`.
Увеличена производительность и точность парсинга чисел с плавающей запятой.
Уменьшено потребление памяти при `JOIN`, если левая и правая часть содержали столбцы с одинаковым именем, не входящие в `USING`.



Исправления ошибок.

Исправлена работа дедупликации блоков после `DROP PARTITION`. Раньше удаление партиции и вставка тех же самых данных заново не работала, так как вставленные заново блоки считались дубликатами.
Исправлена ошибка, в связи с которой может неправильно обрабатываться `WHERE` для запросов на создание `MATERIALIZED VIEW` с указанием `POPULATE`.
Исправлена ошибка в работе параметра `root_path` в конфигурации `zookeeper_servers`.
Исправлен неожиданный результат при передаче аргумента типа `Date` в функцию `toStartOfDay`.
Исправлена работа функции `addMonths`, `subtractMonths`, арифметика с `INTERVAL n MONTH`, если в результате получается предыдущий год.
Добавлена недостающая поддержка типа данных `UUID` для `DISTINCT`, `JOIN`, в агрегатных функциях `uniq` и во внешних словарях. Поддержка `UUID` всё ещё остаётся не полной.
Исправлено поведение `SummingMergeTree` для строк, в которых все значения после суммирования равны нулю.
Многочисленные доработки для движка таблиц `Kafka`.
Исправлена некорректная работа движка таблиц `Join`.
Исправлена работа аллокатора под FreeBSD и OS X.
Функция `extractAll` теперь может доставать пустые вхождения #1493
Исправлена ошибка, не позволяющая подключить при сборке `libressl` вместо `openssl` #1466
Исправлена работа `CREATE TABLE AS SELECT` из временной таблицы.
Исправлена неатомарность обновления очереди репликации. Эта проблема могла приводить к рассинхронизации реплик и чинилась при перезапуске.
Исправлено переполнение в функциях `gcd`, `lcm`, `modulo` (оператор `%`).
Файлы `-preprocessed` теперь создаются после изменения `umask` (`umask` может быть задан в конфигурационном файле).
Исправлена ошибка фоновой проверки кусков (`MergeTreePartChecker`) при использовании партиционирования по произвольному ключу.
Исправлен парсинг кортежей (значений типа `Tuple`) в текстовых форматах.
Исправлены сообщения о неподходящих типах аргументов для функций `multiIf`, `array` и некоторых других.
Переработана поддержка `Nullable` типов. Исправлены ошибки, которые могут приводить к падению сервера. Исправлено подавляющее большинство других ошибок, связанных с поддержкой `NULL`: неправильное приведение типов при INSERT SELECT, недостаточная поддержка Nullable в HAVING и в PREWHERE, режим `join_use_nulls`, Nullable типы в операторе `OR` и т. п.
Исправлена работа с внутренними свойствами типов данных, что позволило исправить проблемы следующего вида: ошибочное суммирование полей типа `Enum` в `SummingMergeTree`; значения типа `Enum` ошибочно выводятся с выравниванием по правому краю в таблицах в `Pretty` форматах, и т. п.
Более строгие проверки для допустимых комбинаций составных столбцов - это позволило исправить ошибки, которые могли приводить к падениям.
Исправлено переполнение при задании очень большого значения параметра для типа `FixedString`.
Исправлена работа агрегатной функции `topK` для generic случая.
Добавлена отсутствующая проверка на совпадение размеров массивов для n-арных вариантов агрегатных функций с комбинатором `-Array`.
Исправлена работа `--pager` для `clickhouse-client`.
Исправлена точность работы функции `exp10`.
Исправлено поведение функции `visitParamExtract` согласно документации.
Исправлено падение при объявлении некорректных типов данных.
Исправлена работа `DISTINCT` при условии, что все столбцы константные.
Исправлено форматирование запроса в случае наличия функции `tupleElement` со сложным константным выражением в качестве номера элемента.
Исправлена работа `Dictionary` таблиц для словарей типа `range_hashed`.
Исправлена ошибка, приводящая к появлению лишних строк при `FULL` и `RIGHT JOIN`.
Исправлено падение сервера в случае создания и удаления временных файлов в `config.d` директориях в момент перечитывания конфигурации.
Исправлена работа запроса `SYSTEM DROP DNS CACHE`: ранее сброс DNS кэша не приводил к повторному резолвингу имён хостов кластера.
Исправлено поведение `MATERIALIZED VIEW` после `DETACH TABLE` таблицы, на которую он смотрит.


Улучшения сборки.

Для сборки используется `pbuilder`. Сборка максимально независима от окружения на сборочной машине.
Для разных версий систем выкладывается один и тот же пакет, который совместим с широким диапазоном Linux систем.
Добавлен пакет `clickhouse-test`, который может быть использован для запуска функциональных тестов.
Добавлена выкладка в репозиторий архива с исходниками. Этот архив может быть использован для воспроизведения сборки без использования GitHub.
Добавлена частичная интеграция с Travis CI. В связи с ограничениями на время сборки в Travis, запускается только ограниченный набор тестов на Debug сборке.
Добавлена поддержка `Cap'n'Proto` в сборку по-умолчанию.
Документация переведена с `Restructured Text` на `Markdown`.
Добавлена поддержка `systemd`. В связи с несовместимостью с некоторыми образами, она выключена по-умолчанию и может быть включена вручную.
Для динамической компиляции запросов, `clang` и `lld` встроены внутрь `clickhouse`. Они также могут быть вызваны с помощью `clickhouse clang` и `clickhouse lld`.
Удалено использование расширений GNU из кода и включена опция `-Wextra`. При сборке с помощью `clang` по-умолчанию используется `libc++` вместо `libstdc++`.
Выделены библиотеки `clickhouse_parsers` и `clickhouse_common_io` для более быстрой сборки утилит.


Обратно несовместимые изменения.

Формат засечек (marks) для таблиц типа `Log`, содержащих `Nullable` столбцы, изменён обратно-несовместимым образом. В случае наличия таких таблиц, вы можете преобразовать их в `TinyLog` до запуска новой версии сервера. Для этого в соответствующем таблице файле `.sql` в директории `metadata`, замените `ENGINE = Log` на `ENGINE = TinyLog`. Если в таблице нет `Nullable` столбцов или тип таблицы не `Log`, то ничего делать не нужно.

Удалена настройка `experimental_allow_extended_storage_definition_syntax`. Соответствующая функциональность включена по-умолчанию.

Функция `runningIncome` переименована в `runningDifferenceStartingWithFirstValue` во избежание путаницы.

Удалена возможность написания `FROM ARRAY JOIN arr` без указания таблицы после FROM.

Удалён формат `BlockTabSeparated`, использовавшийся лишь для демонстрационных целей.

Изменён формат состояния агрегатных функций `varSamp`, `varPop`, `stddevSamp`, `stddevPop`, `covarSamp`, `covarPop`, `corr`. Если вы использовали эти состояния для хранения в таблицах (тип данных `AggregateFunction` от этих функций), напишите на clickhouse-feedback@yandex-team.com.
