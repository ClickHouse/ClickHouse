sudo: required
dist: trusty

os: linux

cache:
  directories:
  - /var/cache/pbuilder
before_cache:
  - rm -rf /var/cache/pbuilder/build

addons:
  apt:
    packages: [ pbuilder, fakeroot, debhelper ]

script:
  # Minimizing compile time.
  - env TEST_RUN=1 PBUILDER_OPT="--timeout 30m" CMAKE_FLAGS="-DUNBUNDLED=1 -DENABLE_CAPNP=0 -DUSE_EMBEDDED_COMPILER=0" EXTRAPACKAGES="libboost-dev zlib1g-dev liblz4-dev libdouble-conversion-dev libzookeeper-mt-dev libsparsehash-dev librdkafka-dev libpoco-dev libsparsehash-dev libgoogle-perftools-dev libzstd-dev libre2-dev libunwind-dev" ./release --pbuilder
# libcapnp-dev - system is too old for us
