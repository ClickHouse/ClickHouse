set (CLICKHOUSE_CLIENT_SOURCES
    Client.cpp
    ConnectionParameters.cpp
    QueryFuzzer.cpp
    Suggest.cpp
)

if (WITH_COVERAGE)
    # During coverage testing client is invoked > n times, where n is tests_count.
    # We don't need every resulting profile.
    # Instrumenting client slows down testing substantially.
    set_source_files_properties(
        Client.cpp
        ConnectionParameters.cpp
        QueryFuzzer.cpp
        Suggest.cpp
        PROPERTIES COMPILE_FLAGS "${WITHOUT_COVERAGE}")
endif()

set (CLICKHOUSE_CLIENT_LINK
    PRIVATE
        boost::program_options
        clickhouse_aggregate_functions
        clickhouse_common_config
        clickhouse_common_io
        clickhouse_functions
        clickhouse_parsers
        string_utils
)

# Always use internal readpassphrase
list(APPEND CLICKHOUSE_CLIENT_LINK PRIVATE readpassphrase)

clickhouse_program_add(client)

install (FILES clickhouse-client.xml DESTINATION "${CLICKHOUSE_ETC_DIR}/clickhouse-client" COMPONENT clickhouse-client RENAME config.xml)
